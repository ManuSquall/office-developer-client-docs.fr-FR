---
title: Fonctions asynchrones définies par l’utilisateur
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 142eb27e-fb6f-4da3-bfb7-a88115bbb5d5
description: 'S�applique �: Excel 2013�| Office 2013�| Visual Studio'
ms.openlocfilehash: 5b64dfd4308da4efb5e94010fe1dc9d758a1199c
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/11/2018
ms.locfileid: "19782001"
---
# <a name="asynchronous-user-defined-functions"></a><span data-ttu-id="1a9ca-103">Fonctions asynchrones définies par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="1a9ca-103">Asynchronous user-defined functions</span></span>

<span data-ttu-id="1a9ca-104">**S’applique à**: Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="1a9ca-104">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="1a9ca-105">Microsoft Excel 2013 peuvent appeler des fonctions définies par l’utilisateur en mode asynchrone.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-105">Microsoft Excel 2013 can call user-defined functions asynchronously.</span></span> <span data-ttu-id="1a9ca-106">Appeler des fonctions de manière asynchrone peut améliorer les performances en autorisant plusieurs calculs à exécuter en même temps.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-106">Calling functions asynchronously can improve performance by allowing several calculations to run at the same time.</span></span> <span data-ttu-id="1a9ca-107">Lorsque vous exécutez des fonctions définies par l’utilisateur sur un cluster de calcul, appeler des fonctions de manière asynchrone permet à plusieurs ordinateurs à utiliser pour effectuer les calculs.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-107">When you run user-defined functions on a compute cluster, calling functions asynchronously enables several computers to be used to complete the calculations.</span></span>
  
## <a name="when-to-use-asynchronous-user-defined-functions"></a><span data-ttu-id="1a9ca-108">Quand utiliser des fonctions asynchrones définies par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="1a9ca-108">When to use asynchronous user-defined functions</span></span>

<span data-ttu-id="1a9ca-109">Certaines fonctions définies par l’utilisateur doivent attendre des ressources externes.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-109">Some user-defined functions must wait for external resources.</span></span> <span data-ttu-id="1a9ca-110">Pendant qu’ils attendent, le thread de calcul Excel est bloqué.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-110">While they wait, the Excel calculation thread is blocked.</span></span> <span data-ttu-id="1a9ca-111">Dans Excel 2013, les fonctions définies par l’utilisateur peuvent exécuter de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-111">In Excel 2013, user-defined functions can run asynchronously.</span></span> <span data-ttu-id="1a9ca-112">Cela libère le thread de calcul pour exécuter d’autres calculs pendant que la fonction définie par l’utilisateur en attente.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-112">This frees the calculation thread to run other calculations while the user-defined function waits.</span></span>
  
<span data-ttu-id="1a9ca-113">Dans Excel 2007, les programmeurs peuvent exécuter plusieurs fonctions définies par l’utilisateur en même temps en augmentant le nombre de threads utilisés dans plusieurs threads recalculs.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-113">In Excel 2007, programmers could run multiple user-defined functions at the same time by increasing the number of threads used in multiple-thread recalculations.</span></span> <span data-ttu-id="1a9ca-114">Cette méthode présente les inconvénients principalement parce que le nombre de threads est un paramètre étendu à une application et ne peut pas être contrôlé au niveau d’une seule fonction ou une macro complémentaire.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-114">This method has drawbacks primarily because the number of threads is a setting scoped to an application and cannot be controlled at the level of a single function or an add-in.</span></span>
  
<span data-ttu-id="1a9ca-115">Programmeurs doivent utiliser des appels asynchrones de fonction définie par l’utilisateur lors de la fonction doit attendre des ressources externes.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-115">Programmers should use asynchronous user-defined function calls when the function must wait for external resources.</span></span> <span data-ttu-id="1a9ca-116">Par exemple, une fonction qui envoie une demande SOAP via Internet doit attendre le réseau fournir la demande, le serveur distant pour effectuer la demande et du réseau pour renvoyer le résultat.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-116">For example, a function that sends a SOAP request over the Internet must wait for the network to deliver the request, the remote server to complete the request, and the network to return the result.</span></span> <span data-ttu-id="1a9ca-117">Dans ce cas, il n’existe aucun produit informatique significative et Excel peut continuer à d’autres calculs.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-117">In this case, there is no significant computing occurring and Excel can continue with other calculations.</span></span>
  
<span data-ttu-id="1a9ca-118">Ils peuvent également utiliser des fonctions asynchrones définies par l’utilisateur lorsqu’une fonction envoie des demandes à un cluster de calcul.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-118">Programmers can also use asynchronous user-defined functions when a function is sending requests to a compute cluster.</span></span> <span data-ttu-id="1a9ca-119">Dans ce cas, il n’est pas uniquement latence du réseau d’attendre, mais le cluster peut exécuter des appels séparés sur des serveurs distincts.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-119">In this case, there is not only network latency to wait for, but the cluster can execute separate calls on separate servers.</span></span> <span data-ttu-id="1a9ca-120">Sans attendre que chaque appel à la fin, les appels peuvent être superposés pour améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-120">By not waiting for each call to finish, the calls can be overlapped to improve performance.</span></span> <span data-ttu-id="1a9ca-121">Dans certains cas, cette amélioration est importante.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-121">In some cases this improvement is significant.</span></span>
  
> [!NOTE]
> <span data-ttu-id="1a9ca-122">Fonctions définies par l’utilisateur ne peut pas être enregistrées en tant que les deux asynchrone et sans échec du cluster.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-122">User-defined functions cannot be registered as both asynchronous and cluster safe.</span></span> 
  
## <a name="writing-an-asynchronous-user-defined-function"></a><span data-ttu-id="1a9ca-123">Écrire une fonction asynchrone définie par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="1a9ca-123">Writing an asynchronous user-defined function</span></span>

<span data-ttu-id="1a9ca-124">Des fonctions asynchrones définies par l’utilisateur doivent suivre une poignée et utilisez ce handle en informant Excel que l’appel de fonction est terminée.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-124">Asynchronous user-defined functions must keep track of a handle and use that handle when informing Excel that the function call is finished.</span></span> <span data-ttu-id="1a9ca-125">Une fonction définie par l’utilisateur asynchrone est divisée en deux.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-125">An asynchronous user-defined function is split into two pieces.</span></span> <span data-ttu-id="1a9ca-126">La première partie est le point d’entrée UDF standard, qui lance une opération asynchrone de deuxième et distincte.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-126">The first piece is the standard UDF entry point, which will launch a second, separate asynchronous operation.</span></span> <span data-ttu-id="1a9ca-127">Rappels dans Excel doivent être effectuées pendant le point d’entrée UDF.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-127">Callbacks into Excel should be made during the UDF entry point.</span></span> <span data-ttu-id="1a9ca-128">La première partie de lancement de la fonction retournera puis contrôle de son thread de calcul dans Excel, qui continue de calcul.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-128">The first launching portion of the function will then return control of its calculation thread to Excel, which will continue calculation.</span></span> <span data-ttu-id="1a9ca-129">Lors de la deuxième opération asynchrone est terminée, il doit rappeler dans Excel et fournir Excel par son résultat.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-129">When the second asynchronous operation is complete, it must call back into Excel and provide Excel with its result.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="1a9ca-130">Tous les arguments transmis dans le fichier UDF sont requis par la partie asynchrone la fonction doit être approfondie copiés car Excel libère de ces arguments retourne le point d’entrée UDF.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-130">Any arguments passed into the UDF that are needed by the asynchronous portion the function must be deep copied because Excel frees these arguments when the UDF entry point returns.</span></span> 
  
<span data-ttu-id="1a9ca-131">Excel propose un ensemble d’événements qu’un complément XLL permettre utiliser pour gérer le cycle de vie d’appels UDF asynchrones.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-131">Excel provides a set of events that an XLL add-in can use in order to manage the life cycle of asynchronous UDF calls.</span></span> <span data-ttu-id="1a9ca-132">Ces événements indiquent que Excel est terminé avec calculs ou que le calcul a été annulé.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-132">These events indicate that Excel is finished with calculations or that the calculation was canceled.</span></span>
  
### <a name="declaring-an-asynchronous-function"></a><span data-ttu-id="1a9ca-133">Déclaration d’une fonction asynchrone</span><span class="sxs-lookup"><span data-stu-id="1a9ca-133">Declaring an asynchronous function</span></span>

<span data-ttu-id="1a9ca-134">Vous devez déclarer des fonctions asynchrones définies par l’utilisateur comme asynchrone lorsqu’ils sont enregistrés.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-134">You must declare asynchronous user-defined functions as asynchronous when they are registered.</span></span> <span data-ttu-id="1a9ca-135">Cette opération est effectuée en ajoutant un paramètre qui pointe vers une structure XLOPER12, représenté par « X » dans la chaîne de type d’enregistrement, n’importe où dans la liste des paramètres UDF.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-135">This is performed by adding a parameter that points to a XLOPER12 structure, represented by "X" in the registration type string, anywhere in the list of UDF parameters.</span></span> <span data-ttu-id="1a9ca-136">Excel utilise ce paramètre pour transmettre le handle de l’appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-136">Excel uses this parameter to pass the asynchronous call handle.</span></span> <span data-ttu-id="1a9ca-137">Le complément XLL doit transmettre le descripteur d’appel asynchrone et le résultat de la fonction dans Excel lorsque le résultat est prêt.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-137">The XLL add-in must pass the asynchronous call handle and the result of the function back to Excel when the result is ready.</span></span> <span data-ttu-id="1a9ca-138">En outre, le type de retour de l’UDF doit être **void**, désigné par « > » en tant que le premier caractère de la chaîne du type.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-138">In addition, the return type of the UDF should be **void**, designated by ">" as the first character in the type string.</span></span> <span data-ttu-id="1a9ca-139">Le type de retour est void, car la partie synchrone de l’UDF ne retourne pas une valeur pour Excel.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-139">The return type is void because the synchronous part of the UDF does not return a value to Excel.</span></span> <span data-ttu-id="1a9ca-140">Au lieu de cela, le complément XLL renvoie une valeur de manière asynchrone par le biais d’un rappel.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-140">Instead, the XLL add-in returns a value asynchronously through a callback.</span></span> 
  
<span data-ttu-id="1a9ca-141">Vous pouvez déclarer des fonctions asynchrones en tant que thread-safe et, le composant de l’UDF synchrone est utilisé dans un recalcul multi-thread.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-141">You can declare asynchronous functions as thread-safe and then the synchronous part of the UDF is used in a multi-threaded recalculation.</span></span> 
  
<span data-ttu-id="1a9ca-142">L’exemple de code suivant montre une fonction asynchrone définie par l’utilisateur inscrite à l’aide de «\>QX » en tant que la chaîne du type d’enregistrement :</span><span class="sxs-lookup"><span data-stu-id="1a9ca-142">The following code example shows an asynchronous user-defined function registered by using "\>QX" as the registration type string:</span></span>
  
```cpp
void MyAsyncUDF(LPXLOPER12 arg1, LPXLOPER12 pxAsyncHandle)
{
…
}
```

### <a name="returning-values"></a><span data-ttu-id="1a9ca-143">Renvoi de valeurs</span><span class="sxs-lookup"><span data-stu-id="1a9ca-143">Returning values</span></span>

<span data-ttu-id="1a9ca-144">Lorsque le résultat de l’appel asynchrone est prêt, le complément XLL renvoie le résultat dans Excel en effectuant un rappel de type [xlAsyncReturn](xlasyncreturn.md).</span><span class="sxs-lookup"><span data-stu-id="1a9ca-144">When the result of the asynchronous call is ready, the XLL add-in returns the result to Excel by performing a callback of type [xlAsyncReturn](xlasyncreturn.md).</span></span>
  
<span data-ttu-id="1a9ca-145">**xlAsyncReturn** est le rappel seulement que vous pouvez utiliser sur des threads non calcul pendant le recalcul.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-145">**xlAsyncReturn** is the only callback you can use on non-calculation threads during recalculation.</span></span> <span data-ttu-id="1a9ca-146">Par conséquent, la partie d’une fichier UDF asynchrone asynchrone ne doit pas effectuer tous les rappels.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-146">Therefore, the asynchronous part of an asynchronous UDF should not perform any other callbacks.</span></span> 
  
### <a name="handling-events"></a><span data-ttu-id="1a9ca-147">Gestion d'événements</span><span class="sxs-lookup"><span data-stu-id="1a9ca-147">Handling events</span></span>

<span data-ttu-id="1a9ca-148">À compter d’Excel 2010, XLL peuvent recevoir des événements conçus pour gérer le cycle de vie de fonction asynchrone.</span><span class="sxs-lookup"><span data-stu-id="1a9ca-148">Starting in Excel 2010, XLLs can receive events designed to manage the asynchronous function life cycle.</span></span> <span data-ttu-id="1a9ca-149">Pour plus d’informations, voir [Gestion des événements](handling-events.md).</span><span class="sxs-lookup"><span data-stu-id="1a9ca-149">For more information, see [Handling Events](handling-events.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="1a9ca-150">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="1a9ca-150">See also</span></span>

- [<span data-ttu-id="1a9ca-151">D�veloppement de XLL de Excel 2013</span><span class="sxs-lookup"><span data-stu-id="1a9ca-151">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

