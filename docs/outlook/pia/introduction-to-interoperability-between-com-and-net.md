---
title: Introduction à l'interopérabilité entre COM et .NET
TOCTitle: Introduction to interoperability between COM and .NET
ms:assetid: 6b2d099a-ec6f-4099-aaf6-e61003fe5a32
ms:mtpsurl: https://msdn.microsoft.com/library/office/bb610378(v=office.15)
ms:contentKeyID: 55119776
ms.date: 07/24/2014
mtps_version: v=office.15
localization_priority: Normal
ms.openlocfilehash: 3b19135900974c3fa379aa9f4acb18ee98a2f8c5
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32360604"
---
# <a name="introduction-to-interoperability-between-com-and-net"></a><span data-ttu-id="17a26-102">Introduction à l'interopérabilité entre COM et .NET</span><span class="sxs-lookup"><span data-stu-id="17a26-102">Introduction to interoperability between COM and .NET</span></span>

<span data-ttu-id="17a26-103">Le modèle COM (Component Object Model) et la plateforme .NET utilisent des systèmes et des mécanismes de types extrêmement différents pour la gestion de la durée de vie des objets, ainsi que pour la création et l'héritage d'interfaces.</span><span class="sxs-lookup"><span data-stu-id="17a26-103">The Component Object Model (COM) and .NET development have vastly different type systems and mechanisms for object lifetime management, interface creation, and interface inheritance.</span></span> 

<span data-ttu-id="17a26-104">Par exemple, un type de **variante** dans COM est un type de données **System.Object** dans l’infrastructure .NET.</span><span class="sxs-lookup"><span data-stu-id="17a26-104">For example, a **Variant** type in COM is a **System.Object** data type in the .NET Framework.</span></span> <span data-ttu-id="17a26-105">Pour créer un objet, un client COM appelle [CoCreateInstance](https://docs.microsoft.com/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), alors qu'un client managé peut utiliser des mots clés comme new ou New qui sont intégrés à un langage de programmation managée.</span><span class="sxs-lookup"><span data-stu-id="17a26-105">To create an object, a COM client calls [CoCreateInstance](https://docs.microsoft.com/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), whereas a managed client can use keywords such as new or New that are built in to a managed programming language.</span></span> 

<span data-ttu-id="17a26-106">Alors que le modèle COM ne prend pas en charge l'héritage classique et qu'un client COM gère un décompte de références interne fourni par [IUnknown (éventuellement en anglais)](https://docs.microsoft.com/windows/desktop/api/unknwn/nn-unknwn-iunknown) pour libérer une coclasse, un client managé utilise le récupérateur de mémoire du CLR fourni par .NET Framework pour libérer un objet.</span><span class="sxs-lookup"><span data-stu-id="17a26-106">While COM does not support classical inheritance and a COM client manages an internal reference count provided by [IUnknown](https://docs.microsoft.com/windows/desktop/api/unknwn/nn-unknwn-iunknown) to free a coclass, a managed client relies on the common language runtime (CLR) garbage collector provided by the .NET Framework to free an object.</span></span> 

<span data-ttu-id="17a26-107">Étant donné ces différences entre COM et .NET, le développement d'un client managé sur un modèle objet COM requiert un mécanisme pour résoudre ces différences.</span><span class="sxs-lookup"><span data-stu-id="17a26-107">Given such differences between COM and .NET development, developing a managed client on a COM object model requires a mechanism that resolves these differences.</span></span> <span data-ttu-id="17a26-108">Le wrapper RCW (Runtime Callable Wrapper) est un mécanisme qui favorise la communication transparente entre COM et le modèle de programmation managée.</span><span class="sxs-lookup"><span data-stu-id="17a26-108">The Runtime Callable Wrapper (RCW) is a mechanism that promotes transparent communication between COM and the managed programming model.</span></span>

<span data-ttu-id="17a26-109">Cette rubrique fournit une description détaillée de la manière dont le RCW facilite la communication entre COM et le modèle de programmation géré.</span><span class="sxs-lookup"><span data-stu-id="17a26-109">This topic gives a high-level description of how the RCW facilitates communication between COM and the managed programming model.</span></span> <span data-ttu-id="17a26-110">Notez que même si Microsoft Visual Studio est utilisé dans cette rubrique pour illustrer le mécanisme RCW, vous pouvez utiliser une assemblée d'interopérabilité en dehors de Visual Studio pour développer un client managé.</span><span class="sxs-lookup"><span data-stu-id="17a26-110">Note that even though this topic uses Visual Studio to illustrate the RCW mechanism, you can use an interop assembly outside of Visual Studio to develop a managed client.</span></span>

## <a name="facilitating-interoperability-the-interop-assembly-and-rcw"></a><span data-ttu-id="17a26-111">Faciliter l'interopérabilité : assemblée d'interopérabilité et wrapper RCW</span><span class="sxs-lookup"><span data-stu-id="17a26-111">Facilitating interoperability: the Interop Assembly and RCW</span></span>

### <a name="compile-time"></a><span data-ttu-id="17a26-112">Temps de compilation</span><span class="sxs-lookup"><span data-stu-id="17a26-112">Compile time</span></span>

<span data-ttu-id="17a26-113">Une assemblée d’interopérabilité définit les interfaces gérées qui correspondent à une bibliothèque de types de base COM et avec lesquelles un client géré peut interagir.</span><span class="sxs-lookup"><span data-stu-id="17a26-113">An interop assembly defines managed interfaces that map to a COM-based type library and that a managed client can interact with.</span></span> <span data-ttu-id="17a26-114">Pour utiliser une assemblée d’interopérabilité dans Visual Studio, commencer par ajouter une référence au composant COM correspondant.</span><span class="sxs-lookup"><span data-stu-id="17a26-114">To use an interop assembly in Visual Studio, first add a reference to the corresponding COM component.</span></span> <span data-ttu-id="17a26-115">Visual Studio génère automatiquement une copie locale de l’assemblée d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="17a26-115">Visual Studio will automatically generate a local copy of the interop assembly.</span></span> <span data-ttu-id="17a26-116">L’assemblée d’interopérabilité contient un espace de noms, sous lequel figure une interface équivalente gérée de chaque objet COM dans le modèle objet COM.</span><span class="sxs-lookup"><span data-stu-id="17a26-116">The interop assembly contains one namespace, under which there is a managed equivalent interface of each COM object in the COM object model.</span></span> 

<span data-ttu-id="17a26-117">Figure 1 illustre un client géré qui veut utiliser une bibliothèque de type COM qui définit la coclasse X. Le client géré appelle la classe X, qui est l’interface équivalente gérée pour la coclasse X, comme défini dans l’assemblée d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="17a26-117">Figure 1 illustrates a managed client that wants to use a COM type library that defines coclass X. The managed client calls class X, which is the managed equivalent interface for coclass X, as defined in the interop assembly.</span></span> <span data-ttu-id="17a26-118">Au moment de la compilation, le projet géré est compilé avec des informations sur la classe X à partir de l’assemblée d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="17a26-118">At compile time, the managed project is compiled with information about class X from the interop assembly.</span></span>

<span data-ttu-id="17a26-119">**Figure 1. Une application gérée compilée avec une assemblée d’interopérabilité qui interagit avec une bibliothèque de type non gérée**</span><span class="sxs-lookup"><span data-stu-id="17a26-119">**Figure 1. A managed application compiled with an interop assembly that interoperates with an unmanaged type library**</span></span>

![Une application gérée compilée avec une assemblée d’interopérabilité qui interagit avec une bibliothèque de type non gérée](media/pia-unmanaged-type-library.gif)
  
<span data-ttu-id="17a26-p106">D'une manière générale, dès que vous définissez une référence à une bibliothèque de types, Visual Studio génère une copie d'un assembly d'interopérabilité pour cette bibliothèque. Il peut exister un nombre quelconque d'assemblys d'interopérabilité pour décrire le même type COM. Toutefois, une bibliothèque de types ne peut avoir qu'un seul assembly PIA qui est l'assembly d'interopérabilité publié par elle-même. À la différence des autres assemblys d'interopérabilité, l'assembly PIA n'est pas généré à chaque ajout d'une référence dans Visual Studio. En effet, vous installez l'assembly PIA dans le Global Assembly Cache (GAC) une seule fois sur un ordinateur. Lorsque vous ajoutez une référence à la bibliothèque de types, Visual Studio charge automatiquement l'assembly PIA.</span><span class="sxs-lookup"><span data-stu-id="17a26-p106">In general, as long as you set a reference to a type library, Visual Studio generates a copy of an interop assembly for that type library. Any number of interop assemblies can exist to describe the same COM type. However, a type library can have only one Primary Interop Assembly (PIA), which is the interop assembly published by the type library. Unlike other interop assemblies, the PIA is not generated every time you add a reference in Visual Studio. Instead, you install the PIA to the global assembly cache (GAC) just once on a computer. When you add a reference to the type library, Visual Studio automatically loads the PIA.</span></span>

<span data-ttu-id="17a26-127">Pour programmer une solution gérée pour Outlook, vous devez utiliser le PIA d’Outlook.</span><span class="sxs-lookup"><span data-stu-id="17a26-127">To program a managed solution for Outlook, you should use the Outlook PIA.</span></span> <span data-ttu-id="17a26-128">Pour incorporer des informations provenant de l'assembly PIA Outlook dans un complément managé, vous devez commencer par installer l'assembly PIA Outlook dans le GAC.</span><span class="sxs-lookup"><span data-stu-id="17a26-128">To incorporate information from the Outlook PIA into a managed add-in, first you must install the Outlook PIA in the GAC.</span></span> <span data-ttu-id="17a26-129">Si vous utilisez Visual Studio pour créer le projet managé, après avoir ajouté une référence à la bibliothèque de types Outlook, Visual Studio charge l'assembly PIA.</span><span class="sxs-lookup"><span data-stu-id="17a26-129">If you are using Visual Studio to create the managed project, after adding a reference to the Outlook type library, Visual Studio loads the PIA.</span></span> <span data-ttu-id="17a26-130">Dans l'Explorateur d'objets, sous l'espace de noms Microsoft.Office.Interop.Outlook, sont affichées les interfaces managées dont les noms correspondent à des objets dans le modèle objet Outlook.</span><span class="sxs-lookup"><span data-stu-id="17a26-130">In the object browser, under the namespace Microsoft.Office.Interop.Outlook, you can see managed interfaces that have names corresponding to objects in the Outlook object model.</span></span> <span data-ttu-id="17a26-131">Par exemple, l’interface compte correspond à l’objet **compte** dans le modèle objet Outlook.</span><span class="sxs-lookup"><span data-stu-id="17a26-131">For example, the Account interface corresponds to the **Account** object in the Outlook object model.</span></span> <span data-ttu-id="17a26-132">Lorsque vous compilez le projet géré, cette information est incorporée dans votre fichier exécutable.</span><span class="sxs-lookup"><span data-stu-id="17a26-132">When you compile the managed project, this information is incorporated in your executable.</span></span>

### <a name="run-time"></a><span data-ttu-id="17a26-133">Temps d’exécution</span><span class="sxs-lookup"><span data-stu-id="17a26-133">Run time</span></span>

<span data-ttu-id="17a26-p108">Au moment de l'exécution, à partir des informations fournies par un assembly d'interopérabilité, le CLR .NET Framework crée un wrapper RCW pour chaque coclasse avec laquelle le client managé interagit. Notez que le runtime crée un seul wrapper RCW pour chaque coclasse, quel que soit le nombre d'interfaces obtenues par le client à partir de la coclasse. Le wrapper RCW est un type de classe .NET Framework qui enveloppe la coclasse COM. Le wrapper RCW garde une trace des instances de la coclasse et libère les références à celles-ci lorsque le client n'a plus besoin du wrapper RCW. De cette manière, un client managé n'a pas besoin de gérer la durée de vie d'un objet comme le devrait un client non managé sous COM.</span><span class="sxs-lookup"><span data-stu-id="17a26-p108">At run time, with the information provided by an interop assembly, the .NET Framework CLR creates an RCW for each coclass the managed client interacts with. Note that the runtime creates only one RCW for each coclass, regardless of how many interfaces the client has obtained from the coclass. The RCW is a .NET Framework class type that wraps around the COM coclass. The RCW keeps track of the instances of the coclass and releases references to them only when the client no longer needs the RCW. This way, a managed client does not have to manage the lifetime of an object the way an unmanaged client would under COM.</span></span>

<span data-ttu-id="17a26-p109">La figure 2 illustre un wrapper RCW qui, au moment de l'exécution, intercepte un appel d'API provenant d'un client managé et, à partir des informations de l'assembly d'interopérabilité, mappe de manière transparente l'appel à l'API correspondante dans la coclasse COM. Le processus est décrit ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="17a26-p109">Figure 2 illustrates an RCW intercepting an API call from a managed client at run time, and using information from the interop assembly, transparently mapping the call to the corresponding API in the COM coclass. The following process describes how this happens:</span></span>

1.  <span data-ttu-id="17a26-141">Le client managé appelle la méthode A' de la X', comme définie dans l'assembly d'interopérabilité d'une bibliothèque de types COM.</span><span class="sxs-lookup"><span data-stu-id="17a26-141">The managed client calls method A' of class X' as defined in the interop assembly for a COM type library.</span></span>

2.  <span data-ttu-id="17a26-142">Si un wrapper RCW n'existe pas encore pour la classe X', le runtime .NET Framework utilise les informations de l'assembly d'interopérabilité et crée un wrapper RCW pour la classe X'.</span><span class="sxs-lookup"><span data-stu-id="17a26-142">If an RCW does not yet exist for class X', the .NET Framework runtime uses information from the interop assembly and creates an RCW for class X'.</span></span>

3.  <span data-ttu-id="17a26-143">Le wrapper RCW intercepte l'appel à la méthode A', traduit les arguments en types COM correspondants et appelle la méthode A de la coclasse X, comme défini dans la bibliothèque de types COM.</span><span class="sxs-lookup"><span data-stu-id="17a26-143">The RCW intercepts the call to method A', translates the arguments into corresponding COM types, and invokes method A of coclass X as defined in the COM type library.</span></span>

<span data-ttu-id="17a26-144">**Figure 2. Un RCW intercepte un appel provenant d'un exécutable managé et le mappe à une coclasse dans une bibliothèque de types non managée**</span><span class="sxs-lookup"><span data-stu-id="17a26-144">**Figure 2. An RCW intercepts a call from a managed executable and maps it to a coclass in an unmanaged type library**</span></span>

![Un RCW intercepte un appel provenant d'un exécutable managé et le mappe à une coclasse dans une bibliothèque de types non managée](media/pia-unmanaged-type-library-2.gif)
  

## <a name="see-also"></a><span data-ttu-id="17a26-146">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="17a26-146">See also</span></span>

- [<span data-ttu-id="17a26-147">Pourquoi utiliser le PIA d’Outlook</span><span class="sxs-lookup"><span data-stu-id="17a26-147">Why use the Outlook PIA</span></span>](why-use-the-outlook-pia.md)
- [<span data-ttu-id="17a26-148">Installation et référencement le PIA Outlook</span><span class="sxs-lookup"><span data-stu-id="17a26-148">Installing and referencing the Outlook PIA</span></span>](installing-and-referencing-the-outlook-pia.md)

