---
title: Identification de l’historique de téléchargement de message pour un compte POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 90a51150-5c2c-4d5b-8717-5dacc8532744
description: Cette rubrique décrit comment un client de messagerie peut accéder à la propriété PidTagAttachDataBinary pour obtenir l'historique de téléchargement des messages pour un compte POP3.
ms.openlocfilehash: ae12a044098aa4f42e1c2e5936e82da3d7a128dd
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321874"
---
# <a name="locating-the-message-download-history-for-a-pop3-account"></a><span data-ttu-id="c925c-103">Identification de l’historique de téléchargement de message pour un compte POP3</span><span class="sxs-lookup"><span data-stu-id="c925c-103">Locating the message download history for a POP3 account</span></span>

<span data-ttu-id="c925c-104">Cette rubrique décrit comment un client de messagerie peut accéder à la propriété [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) pour obtenir l'historique de téléchargement des messages pour un compte POP3.</span><span class="sxs-lookup"><span data-stu-id="c925c-104">This topic describes how a mail client can access the [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) property to get the message download history for a POP3 account.</span></span> 

<span data-ttu-id="c925c-105"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_WhyGetUIDLHistory"> </a></span><span class="sxs-lookup"><span data-stu-id="c925c-105"></span></span>

## <a name="why-get-the-message-download-history"></a><span data-ttu-id="c925c-106">Pourquoi obtenir l'historique de téléchargement des messages?</span><span class="sxs-lookup"><span data-stu-id="c925c-106">Why get the message download history?</span></span>

<span data-ttu-id="c925c-107">Le fournisseur POP (Post Office Protocol) pour Outlook permet aux utilisateurs de récupérer et de télécharger de nouveaux messages électroniques sur leur appareil local, puis de laisser ou de supprimer ces messages électroniques sur le serveur de messagerie.</span><span class="sxs-lookup"><span data-stu-id="c925c-107">The Post Office Protocol (POP) provider for Outlook allows users to retrieve and download new email messages on their local device, and subsequently to leave or delete these email messages on the mail server.</span></span> <span data-ttu-id="c925c-108">Lorsque le client de messagerie recherche les nouveaux messages à télécharger, il doit être en mesure d'identifier et de télécharger uniquement les nouveaux messages pour cette boîte de réception.</span><span class="sxs-lookup"><span data-stu-id="c925c-108">When the mail client checks for new messages to download, it has to be able to identify and download only the new messages for that Inbox.</span></span> <span data-ttu-id="c925c-109">Le client de messagerie effectue cette opération à l'aide de la commande UIDL (ID unique), qui obtient une carte de chaque message qui a déjà été remis à une identification unique (UID) dans cette boîte de réception.</span><span class="sxs-lookup"><span data-stu-id="c925c-109">The mail client does this by first using the UIDL (Unique ID Listing) command, which obtains a map of each message that has ever been delivered to that Inbox to a unique identifier (UID).</span></span> <span data-ttu-id="c925c-110">Le client obtient également l'historique de téléchargement des messages pour les messages qui ont été téléchargés ou supprimés pour la boîte de réception sur ce client.</span><span class="sxs-lookup"><span data-stu-id="c925c-110">The client also gets the message download history for messages that have been downloaded or deleted for the Inbox on that client.</span></span> <span data-ttu-id="c925c-111">À l'aide de la carte UID de message et de l'historique de téléchargement, le client peut ensuite identifier les messages absents de l'historique comme étant nouveaux et doit donc être téléchargé.</span><span class="sxs-lookup"><span data-stu-id="c925c-111">Using the message UID map and download history, the client can then identify those messages that are absent in the history as new and, hence, should be downloaded.</span></span>
  
<span data-ttu-id="c925c-112">Pour obtenir l'historique de téléchargement des messages d'une boîte de réception:</span><span class="sxs-lookup"><span data-stu-id="c925c-112">To get the message download history for an Inbox:</span></span>
  
- <span data-ttu-id="c925c-113">Suivez les étapes de cette rubrique pour trouver la propriété **PidTagAttachDataBinary** , qui contient l'historique dans un objet BLOB (Binary Large Object) qui suit un format spécifique.</span><span class="sxs-lookup"><span data-stu-id="c925c-113">Follow the steps in this topic to find the **PidTagAttachDataBinary** property, which contains the history in a binary large object (BLOB) that follows a specific format.</span></span> 
    
- <span data-ttu-id="c925c-114">Poursuivez [l'analyse de l'historique de téléchargement des messages pour un compte POP3](parsing-the-message-download-history-for-a-pop3-account.md), qui décrit comment analyser cet objet BLOB pour identifier les messages qui ont été téléchargés ou supprimés pour cette boîte de réception.</span><span class="sxs-lookup"><span data-stu-id="c925c-114">Continue with [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md), which describes how to parse this BLOB to identify messages that have been downloaded or deleted for that Inbox.</span></span>
    
## <a name="core-concepts-to-know-for-locating-the-message-download-history"></a><span data-ttu-id="c925c-115">Concepts de base à prendre en compte pour localiser l'historique de téléchargement des messages</span><span class="sxs-lookup"><span data-stu-id="c925c-115">Core concepts to know for locating the message download history</span></span>

<span data-ttu-id="c925c-116">L'historique de téléchargement des messages d'une boîte de réception est stocké dans une propriété MAPI Binary, **PidTagAttachDataBinary**, sur une pièce jointe d'un message masqué dans la boîte de réception.</span><span class="sxs-lookup"><span data-stu-id="c925c-116">The message download history for an Inbox is stored in a binary MAPI property, **PidTagAttachDataBinary**, on an attachment of a hidden message in the Inbox.</span></span> <span data-ttu-id="c925c-117">Le tableau 1 présente les ressources pour les concepts qui vous aident à comprendre comment trouver l'historique de téléchargement des messages.</span><span class="sxs-lookup"><span data-stu-id="c925c-117">Table 1 shows resources for concepts that help you understand how to locate the message download history.</span></span>
  
<span data-ttu-id="c925c-118">**Tableau 1. Concepts de base**</span><span class="sxs-lookup"><span data-stu-id="c925c-118">**Table 1. Core concepts**</span></span>

|<span data-ttu-id="c925c-119">**Titre d’article**</span><span class="sxs-lookup"><span data-stu-id="c925c-119">**Article title**</span></span>|<span data-ttu-id="c925c-120">**Description**</span><span class="sxs-lookup"><span data-stu-id="c925c-120">**Description**</span></span>|
|:-----|:-----|
|[<span data-ttu-id="c925c-121">Dossiers cachés MAPI</span><span class="sxs-lookup"><span data-stu-id="c925c-121">MAPI Hidden Folders</span></span>](https://msdn.microsoft.com/library/8b3b9c80-f7f4-4f37-bd6b-323469d020f1%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-122">MAPI permet aux clients de messagerie de stocker des informations dans des dossiers et des messages masqués masqués.</span><span class="sxs-lookup"><span data-stu-id="c925c-122">MAPI allows mail clients to store information in hidden folders and hidden messages.</span></span> <span data-ttu-id="c925c-123">Les dossiers cachés se trouvent dans le composant associé de dossiers MAPI et contiennent généralement des informations qui ne sont pas visibles par les utilisateurs et ne peuvent pas être manipulées.</span><span class="sxs-lookup"><span data-stu-id="c925c-123">Hidden folders are in the associated part of MAPI folders and typically contain information that is not visible to and not to be manipulated by users.</span></span> <span data-ttu-id="c925c-124">Les clients déterminent le format et le contenu à stocker dans les messages masqués dans les dossiers cachés.</span><span class="sxs-lookup"><span data-stu-id="c925c-124">Clients decide the format and contents to store in hidden messages in hidden folders.</span></span>  <br/> |
|[<span data-ttu-id="c925c-125">Messages MAPI</span><span class="sxs-lookup"><span data-stu-id="c925c-125">MAPI Messages</span></span>](https://msdn.microsoft.com/library/417c113f-bd98-4515-85d1-09db7fc3a227%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-126">MAPI stocke les messages dans des dossiers, soit dans la sous-arborescence IPM standard visible par les utilisateurs d'un client, soit en dehors de la sous-arborescence et invisible pour les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="c925c-126">MAPI stores messages in folders, either in the standard IPM subtree that is visible to users of a client, or outside of the subtree and invisible to users.</span></span> <span data-ttu-id="c925c-127">Les messages peuvent contenir des données supplémentaires stockées dans une pièce jointe, qui peut se présenter sous la forme d'un fichier, d'un autre message ou d'un objet OLE.</span><span class="sxs-lookup"><span data-stu-id="c925c-127">Messages can have additional data stored in an attachment, which can be in the form of a file, another message, or an OLE object.</span></span> <span data-ttu-id="c925c-128">Dans le cas de l'historique de téléchargement des messages, l'historique est stocké dans une propriété d'un message joint à un autre message masqué.</span><span class="sxs-lookup"><span data-stu-id="c925c-128">In the case of the message download history, the history is stored in a property of a message that is attached to another hidden message.</span></span>  <br/> |
|[<span data-ttu-id="c925c-129">Vue d'ensemble des propriétés de message</span><span class="sxs-lookup"><span data-stu-id="c925c-129">Message Properties Overview</span></span>](https://msdn.microsoft.com/library/447f54de-9f0d-4f73-89b6-bed9cfea9c15%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-130">Lorsqu'un client stocke des informations dans un message, il stocke en fait les informations dans une propriété du message.</span><span class="sxs-lookup"><span data-stu-id="c925c-130">When a client stores information in a message, it actually stores the information in a property of the message.</span></span> <span data-ttu-id="c925c-131">MAPI prend en charge de nombreuses propriétés, certaines toujours existent et peuvent être définies par les clients, d'autres sont facultatives, et les clients ne peuvent pas s'attendre à être disponibles ou définir des valeurs valides.</span><span class="sxs-lookup"><span data-stu-id="c925c-131">MAPI supports many properties—some always exist and can be set by clients, others are optional—and clients cannot expect them to be available or set to valid values.</span></span> <span data-ttu-id="c925c-132">L'historique de téléchargement des messages est stocké dans la propriété **PidTagAttachDataBinary** d'une pièce jointe à un message masqué.</span><span class="sxs-lookup"><span data-stu-id="c925c-132">The message download history is stored in the **PidTagAttachDataBinary** property of an attachment to a hidden message.</span></span>  <br/> |
|[<span data-ttu-id="c925c-133">Profils MAPI</span><span class="sxs-lookup"><span data-stu-id="c925c-133">MAPI Profiles</span></span>](https://msdn.microsoft.com/library/493c87a4-317d-47ec-850b-342cac59594b%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-134">Au moment de la connexion dans une session, le client de messagerie sélectionne un profil qui décrit les fournisseurs et les services à utiliser.</span><span class="sxs-lookup"><span data-stu-id="c925c-134">At logon time in a session, the mail client selects a profile that describes the providers and services to be used.</span></span> <span data-ttu-id="c925c-135">Un profil est divisé en sections qui contiennent des propriétés.</span><span class="sxs-lookup"><span data-stu-id="c925c-135">A profile is divided into sections that contain properties.</span></span> <span data-ttu-id="c925c-136">En particulier, les propriétés [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) et [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) existent toujours.</span><span class="sxs-lookup"><span data-stu-id="c925c-136">In particular, the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) and [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) properties always exist.</span></span> <span data-ttu-id="c925c-137">La clé de recherche d'un profil est unique parmi tous les profils et est stockée dans la section de profil identifiée par **MUID_PROFILE_INSTANCE** (qui est défini dans MAPIGUID. H).</span><span class="sxs-lookup"><span data-stu-id="c925c-137">A profile's search key is unique among all profiles, and is stored in the profile section that is identified by **MUID_PROFILE_INSTANCE** (which is defined in MAPIGUID.H).</span></span> <span data-ttu-id="c925c-138">Utilisez [IMAPISession:: OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) pour ouvrir la section et utilisez [IMAPIProp:: GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) pour obtenir les valeurs de propriété.</span><span class="sxs-lookup"><span data-stu-id="c925c-138">Use [IMAPISession::OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) to open the section, and use [IMAPIProp::GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) to get the property values.</span></span>  <br/> |
|[<span data-ttu-id="c925c-139">Tables des matières</span><span class="sxs-lookup"><span data-stu-id="c925c-139">Contents Tables</span></span>](https://msdn.microsoft.com/library/7b8efb4e-b5be-41b8-81bb-9aa1da421433%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-140">Les fournisseurs de banque de messages implémentent les tables de contenu pour leurs dossiers.</span><span class="sxs-lookup"><span data-stu-id="c925c-140">Message store providers implement contents tables for their folders.</span></span> <span data-ttu-id="c925c-141">Pour les messages masqués dans la partie associée d'un dossier, les fournisseurs de banques de messages prennent en charge les tables de contenu associées et les clients peuvent utiliser la méthode [IMAPIContainer:: GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) pour renvoyer un pointeur vers le tableau de contenu associé.</span><span class="sxs-lookup"><span data-stu-id="c925c-141">For hidden messages in the associated part of a folder, message store providers support associated contents tables, and clients can use the [IMAPIContainer::GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) method to return a pointer to the associated contents table.</span></span>  <br/> |
|[<span data-ttu-id="c925c-142">À propos des restrictions</span><span class="sxs-lookup"><span data-stu-id="c925c-142">About Restrictions</span></span>](https://msdn.microsoft.com/library/e119fa20-08b8-4c8d-93fc-56037220890d%28Office.15%29.aspx) <br/> [<span data-ttu-id="c925c-143">Types de restrictions</span><span class="sxs-lookup"><span data-stu-id="c925c-143">Types of Restrictions</span></span>](https://msdn.microsoft.com/library/0d3bd58b-7100-4117-91ac-27139715c85b%28Office.15%29.aspx) <br/> [<span data-ttu-id="c925c-144">Création d'une restriction</span><span class="sxs-lookup"><span data-stu-id="c925c-144">Building a Restriction</span></span>](https://msdn.microsoft.com/library/12abbd8c-f825-493e-af42-344371d9658e%28Office.15%29.aspx) <br/> [<span data-ttu-id="c925c-145">Exemple de code de restriction</span><span class="sxs-lookup"><span data-stu-id="c925c-145">Sample Restriction Code</span></span>](https://msdn.microsoft.com/library/9b82097c-dbd6-4ba0-a6cb-292301f9402b%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-146">Dans MAPI, les clients peuvent utiliser des restrictions pour filtrer les tables de contenu, pour rechercher des lignes qui représentent des messages dont la propriété est définie sur une valeur spécifique.</span><span class="sxs-lookup"><span data-stu-id="c925c-146">In MAPI, clients can use restrictions to filter contents tables, to search for rows that represent messages that have a certain property set to a specific value.</span></span> <span data-ttu-id="c925c-147">Les restrictions sont définies à l'aide de la structure de données [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) , qui peut contenir une Union de structures de restriction plus spécialisées.</span><span class="sxs-lookup"><span data-stu-id="c925c-147">Restrictions are defined by using the [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) data structure, which can contain a union of more specialized restriction structures.</span></span> <span data-ttu-id="c925c-148">La méthode [IMAPITable:: FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) applique une restriction et extrait la première ligne d'une table qui correspond aux critères de restriction.</span><span class="sxs-lookup"><span data-stu-id="c925c-148">The [IMAPITable::FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) method applies a restriction and retrieves the first row in a table that matches the restriction criteria.</span></span>  <br/> |
|[<span data-ttu-id="c925c-149">À propos de l'enregistrement des magasins pour l'indexation</span><span class="sxs-lookup"><span data-stu-id="c925c-149">About Registering Stores for Indexing</span></span>](https://msdn.microsoft.com/library/dd2aa06a-96e8-1291-18b5-fc3c40b74e4d%28Office.15%29.aspx) <br/> |<span data-ttu-id="c925c-150">Utilisez la propriété [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) pour vérifier le type de fournisseur de banque d'aide.</span><span class="sxs-lookup"><span data-stu-id="c925c-150">Use the [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) property to verify the type of store provider.</span></span> <span data-ttu-id="c925c-151">Par exemple, pour vérifier si un magasin est une banque d'information Exchange, la propriété **PidTagStoreProvider** doit renvoyer une valeur représentée par la constante **pbExchangeProviderPrimaryUserGuid**, qui est définie dans le fichier d'en-tête public edkmdb. h.</span><span class="sxs-lookup"><span data-stu-id="c925c-151">For example, to verify whether a store is an Exchange store, the **PidTagStoreProvider** property should return a value represented by the constant **pbExchangeProviderPrimaryUserGuid**, which is defined in the public header file edkmdb.h.</span></span>  <br/> |
   
## <a name="locating-the-appropriate-hidden-message-and-attachment"></a><span data-ttu-id="c925c-152">Recherche du message et de la pièce jointe masqués appropriés</span><span class="sxs-lookup"><span data-stu-id="c925c-152">Locating the appropriate hidden message and attachment</span></span>

<span data-ttu-id="c925c-153">Maintenant que nous connaissons l'historique de téléchargement des messages pour une boîte de réception qui se trouve dans la propriété **PidTagAttachDataBinary** d'une pièce jointe à un message masqué, la procédure permettant de localiser la pièce jointe appropriée du message caché approprié implique ce qui suit: adjudication</span><span class="sxs-lookup"><span data-stu-id="c925c-153">Now that we know the message download history for an Inbox is in the **PidTagAttachDataBinary** property of an attachment to a hidden message, the procedure to locate the appropriate attachment of the appropriate hidden message involves the following procedures:</span></span> 
  
1. [<span data-ttu-id="c925c-154">Rechercher le message masqué approprié</span><span class="sxs-lookup"><span data-stu-id="c925c-154">Find the appropriate hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg)
    
2. [<span data-ttu-id="c925c-155">Trouver la pièce jointe appropriée du message masqué</span><span class="sxs-lookup"><span data-stu-id="c925c-155">Find the appropriate attachment of the hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment)
    
3. [<span data-ttu-id="c925c-156">Accéder à la propriété PidTagAttachDataBinary de la pièce jointe du message</span><span class="sxs-lookup"><span data-stu-id="c925c-156">Access the PidTagAttachDataBinary property of the message attachment</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp)

<span data-ttu-id="c925c-157"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg"> </a></span><span class="sxs-lookup"><span data-stu-id="c925c-157"></span></span>

### <a name="find-the-appropriate-hidden-message"></a><span data-ttu-id="c925c-158">Rechercher le message masqué approprié</span><span class="sxs-lookup"><span data-stu-id="c925c-158">Find the appropriate hidden message</span></span>

1. <span data-ttu-id="c925c-159">Obtenez la propriété [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) à partir du profil, dans la section de profil spécifiée par **MUID_PROFILE_INSTANCE**.</span><span class="sxs-lookup"><span data-stu-id="c925c-159">Get the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) property from the profile, in the profile section specified by **MUID_PROFILE_INSTANCE**.</span></span>
    
2. <span data-ttu-id="c925c-160">Ouvrez le contenu associé pour le dossier boîte de réception en appelant **IMAPIContainer:: GetContentsTable**.</span><span class="sxs-lookup"><span data-stu-id="c925c-160">Open the Associated Contents for the Inbox folder by calling **IMAPIContainer::GetContentsTable**.</span></span>
    
3. <span data-ttu-id="c925c-161">Créer une restriction basée sur les propriétés [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**) **, PidTagSearchKey** (**PR_SEARCH_KEY**) et [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) pour obtenir une table qui contient tous les messages masqués dans le contenu associé de la boîte de réception.</span><span class="sxs-lookup"><span data-stu-id="c925c-161">Create a restriction based on the [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**), **PidTagSearchKey** (**PR_SEARCH_KEY**), and [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) properties to get a table that contains all the hidden messages in the Associated Contents of the Inbox.</span></span> <span data-ttu-id="c925c-162">Voici un exemple de restriction extraite de [la localisation de l'historique de la commande UIDL POP3](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span><span class="sxs-lookup"><span data-stu-id="c925c-162">The following is an example of a restriction extracted from [Locating the POP3 UIDL History](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span></span>
    
   ```cpp
      SRestriction rgRes[3]; 
      SPropValue rgProps[3]; 
      rgRes[0].rt = RES_AND; 
      rgRes[0].res.resAnd.cRes = 2; 
      rgRes[0].res.resAnd.lpRes = &amp;rgRes[1]; 
      rgRes[1].rt = RES_PROPERTY; 
      rgRes[1].res.resProperty.relop = RELOP_EQ; 
      rgRes[1].res.resProperty.ulPropTag = PR_CONVERSATION_KEY; 
      rgRes[1].res.resProperty.lpProp = &amp;rgProps[0]; 
      rgRes[2].rt = RES_PROPERTY; 
      rgRes[2].res.resProperty.relop = RELOP_EQ; 
      rgRes[2].res.resProperty.ulPropTag = PR_MESSAGE_CLASS; 
      rgRes[2].res.resProperty.lpProp = &amp;rgProps[1]; 
      rgProps[0].ulPropTag = PR_CONVERSATION_KEY; 
      rgProps[0].Value.bin = pVals[iSearchKey].Value.bin; // PR_SEARCH_KEY from the profile 
      rgProps[1].ulPropTag = PR_MESSAGE_CLASS; 
      rgProps[1].Value.LPSZ = (LPTSTR)"IPM.MessageManager";
   ```

4. <span data-ttu-id="c925c-163">Dans le tableau, recherchez le message masqué à l'aide de l'utilisation de l'attribut **IMAPITable:: FindRow**.</span><span class="sxs-lookup"><span data-stu-id="c925c-163">From the table, find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
5. <span data-ttu-id="c925c-164">Si l'étape 4 ne parvient pas à trouver un message masqué, modifiez la restriction de manière à utiliser **PidTagSearchKey** (**PR_SEARCH_KEY**) au lieu de **PidTagConversationKey**, comme indiqué ci-dessous:</span><span class="sxs-lookup"><span data-stu-id="c925c-164">If step 4 fails to find a hidden message, change the restriction to use **PidTagSearchKey** (**PR_SEARCH_KEY**) instead of **PidTagConversationKey**, as shown below:</span></span>
    
   ```cpp
    rgRes[1].res.resProperty.ulPropTag = rgProps[0].ulPropTag = PR_SEARCH_KEY;
   ```

6. <span data-ttu-id="c925c-165">Recherchez le message masqué à l'aide de **IMAPITable:: FindRow**.</span><span class="sxs-lookup"><span data-stu-id="c925c-165">Find the hidden message using **IMAPITable::FindRow**.</span></span> 
    
7. <span data-ttu-id="c925c-166">En cas d'échec de l'étape 6, modifiez la restriction de façon à utiliser [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) en étant égal à `printf` la valeur suivante (illustrée ci-dessous à l'aide de la substitution de style pour concision).</span><span class="sxs-lookup"><span data-stu-id="c925c-166">If Step 6 fails, change the restriction to use [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) being equal to the following value (shown below using  `printf` style substitution for brevity).</span></span> 
    
   ```cpp
    "Outlook Message Manager (%s) (KEY: %s)", PR_PROFILE_NAME, HexFromBin(PR_SEARCH_KEY)
   ```

8. <span data-ttu-id="c925c-167">Recherchez le message masqué à l'aide de **IMAPITable:: FindRow**.</span><span class="sxs-lookup"><span data-stu-id="c925c-167">Find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
9. <span data-ttu-id="c925c-168">Si vous exécutez Outlook 2010 ou une version ultérieure, utilisez les valeurs suivantes pour **PidTagProfileName** (**PR_PROFILE_NAME**) et **PidTagSearchKey** (**PR_SEARCH_KEY**), respectivement.</span><span class="sxs-lookup"><span data-stu-id="c925c-168">If you are running Outlook 2010 or a later version, use the following values for **PidTagProfileName** (**PR_PROFILE_NAME**) and **PidTagSearchKey** (**PR_SEARCH_KEY**), respectively.</span></span>
    
   ```cpp
    CHAR g_szGeneralKey[] = "General Key"; 
    const SBinary g_binGeneralKey = {sizeof(g_szGeneralKey), (LPBYTE)g_szGeneralKey};
   ```

   <span data-ttu-id="c925c-169">Exécutez les étapes 3 à 8.</span><span class="sxs-lookup"><span data-stu-id="c925c-169">Run through Steps 3 through 8.</span></span> <span data-ttu-id="c925c-170">Si cela ne parvient pas à trouver un message, revenez aux étapes 3 à 8 d'origine.</span><span class="sxs-lookup"><span data-stu-id="c925c-170">If this fails to find a message, fall back to the original steps 3 through 8.</span></span>
    
10. <span data-ttu-id="c925c-171">Ouvrez le message masqué trouvé à l'étape 4, 6 ou 8.</span><span class="sxs-lookup"><span data-stu-id="c925c-171">Open the hidden message found in Step 4, 6, or 8.</span></span>

<span data-ttu-id="c925c-172"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment"> </a></span><span class="sxs-lookup"><span data-stu-id="c925c-172"></span></span>

### <a name="find-the-appropriate-attachment-of-the-hidden-message"></a><span data-ttu-id="c925c-173">Trouver la pièce jointe appropriée du message masqué</span><span class="sxs-lookup"><span data-stu-id="c925c-173">Find the appropriate attachment of the hidden message</span></span>

<span data-ttu-id="c925c-174">Étant donné que le message masqué peut contenir plusieurs pièces jointes, recherchez la pièce jointe appropriée dans l'ordre suivant.</span><span class="sxs-lookup"><span data-stu-id="c925c-174">Because the hidden message may have more than one attachment, look for the appropriate attachment in the following order.</span></span>
  
> [!NOTE]
> <span data-ttu-id="c925c-175">Cette procédure utilise de nouveau `printf` la substitution de style à des fins de concision.</span><span class="sxs-lookup"><span data-stu-id="c925c-175">This procedure again uses the  `printf` style substitution for brevity.</span></span> 

1. <span data-ttu-id="c925c-176">Recherchez une pièce jointe dont [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) correspond à la chaîne suivante `szEmailAddress` , où correspond à l'adresse SMTP de l'utilisateur, tel qu'il est spécifié dans le profil de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c925c-176">Look for an attachment whose [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) matches the following string, where  `szEmailAddress` is the user's SMTP address, as specified in the user's profile.</span></span> <span data-ttu-id="c925c-177">.</span><span class="sxs-lookup"><span data-stu-id="c925c-177"></span></span> 
    
   ```cpp
    "BlobPOP%s", szEmailAddress
   ```

2. <span data-ttu-id="c925c-178">Recherchez une pièce jointe dont la [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) correspond à «BlobPOP% `szEmailAddress`s»,.</span><span class="sxs-lookup"><span data-stu-id="c925c-178">Look for an attachment whose [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
3. <span data-ttu-id="c925c-179">Recherchez une pièce jointe dont la [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) correspond à «BlobPOP% `szEmailAddress`s»,.</span><span class="sxs-lookup"><span data-stu-id="c925c-179">Look for an attachment whose [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
4. <span data-ttu-id="c925c-180">Recherchez une pièce jointe dont la **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) correspond à «BLOB%. `dwAcctUID`8x» `dwAcctUID` , où provient de [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span><span class="sxs-lookup"><span data-stu-id="c925c-180">Look for an attachment whose **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) matches "Blob%.8x",  `dwAcctUID`, where  `dwAcctUID` comes from [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span></span> <span data-ttu-id="c925c-181">Vous pouvez utiliser la méthode [IOlkAccount:: getprop](iolkaccount-getprop.md) pour accéder à la propriété **PROP_ACCT_MINI_UID** .</span><span class="sxs-lookup"><span data-stu-id="c925c-181">You can use the [IOlkAccount::GetProp](iolkaccount-getprop.md) method to access the **PROP_ACCT_MINI_UID** property.</span></span> 

<span data-ttu-id="c925c-182"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp"> </a></span><span class="sxs-lookup"><span data-stu-id="c925c-182"></span></span>

### <a name="access-the-pidtagattachdatabinary-property-of-the-message-attachment"></a><span data-ttu-id="c925c-183">Accéder à la propriété PidTagAttachDataBinary de la pièce jointe du message</span><span class="sxs-lookup"><span data-stu-id="c925c-183">Access the PidTagAttachDataBinary property of the message attachment</span></span>

<span data-ttu-id="c925c-184">Après avoir localisé la pièce jointe appropriée du message masqué, utilisez **IMAPIProp:: GetProps** pour lire la propriété **PidTagAttachDataBinary** de la pièce jointe.</span><span class="sxs-lookup"><span data-stu-id="c925c-184">After locating the appropriate message attachment of the hidden message, use **IMAPIProp::GetProps** to read the **PidTagAttachDataBinary** property of the attachment.</span></span> 

<span data-ttu-id="c925c-185"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_NextSteps"> </a></span><span class="sxs-lookup"><span data-stu-id="c925c-185"></span></span>

## <a name="next-steps"></a><span data-ttu-id="c925c-186">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="c925c-186">Next steps</span></span>

<span data-ttu-id="c925c-187">Cette rubrique explique comment trouver l'historique de téléchargement des messages pour la boîte de réception d'un client de messagerie POP3.</span><span class="sxs-lookup"><span data-stu-id="c925c-187">You have learned from this topic how to locate the message download history for the Inbox of a POP3 mail client.</span></span> <span data-ttu-id="c925c-188">Voir [analyse de l'historique de téléchargement des messages pour un compte POP3](parsing-the-message-download-history-for-a-pop3-account.md) pour découvrir comment analyser cet historique afin d'identifier les messages qui ont été téléchargés ou supprimés pour la boîte de réception.</span><span class="sxs-lookup"><span data-stu-id="c925c-188">See [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md) to learn how to parse this history to identify messages that have been downloaded or deleted for the Inbox.</span></span> 

<span data-ttu-id="c925c-189"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AdditionalRsc"> </a></span><span class="sxs-lookup"><span data-stu-id="c925c-189"></span></span>

## <a name="see-also"></a><span data-ttu-id="c925c-190">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c925c-190">See also</span></span>

- [<span data-ttu-id="c925c-191">Gestion des téléchargements de messages pour les comptes POP3</span><span class="sxs-lookup"><span data-stu-id="c925c-191">Managing message downloads for POP3 accounts</span></span>](managing-message-downloads-for-pop3-accounts.md)   
- [<span data-ttu-id="c925c-192">L'analyse de l'historique de téléchargement des messages pour un compte POP3</span><span class="sxs-lookup"><span data-stu-id="c925c-192">Parsing the message download history for a POP3 account</span></span>](parsing-the-message-download-history-for-a-pop3-account.md)
- [<span data-ttu-id="c925c-193">Localisation de l'historique de la commande UIDL POP3</span><span class="sxs-lookup"><span data-stu-id="c925c-193">Locating the POP3 UIDL History</span></span>](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx)
    

