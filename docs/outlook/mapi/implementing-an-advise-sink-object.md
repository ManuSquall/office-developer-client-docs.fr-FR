---
title: L’implémentation d’un objet de réception de notifications
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: 'Derni�re modification�: lundi 9 mars 2015'
ms.openlocfilehash: a95222f8ec75c519558636cf54111f28cbe14066
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/11/2018
ms.locfileid: "19784174"
---
# <a name="implementing-an-advise-sink-object"></a><span data-ttu-id="c44f9-103">L’implémentation d’un objet de réception de notifications</span><span class="sxs-lookup"><span data-stu-id="c44f9-103">Implementing an Advise Sink Object</span></span>

  
  
<span data-ttu-id="c44f9-104">**S’applique à**: Outlook</span><span class="sxs-lookup"><span data-stu-id="c44f9-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="c44f9-105">Un client peut implémenter ses propres objets du récepteur advise ou utiliser une fonction utilitaire, [HrAllocAdviseSink](hrallocadvisesink.md).</span><span class="sxs-lookup"><span data-stu-id="c44f9-105">A client can either implement its own advise sink objects or use a utility function, [HrAllocAdviseSink](hrallocadvisesink.md).</span></span> <span data-ttu-id="c44f9-106">**HrAllocAdviseSink** crée un objet de récepteur advise avec une implémentation **OnNotify** qui appelle une fonction de rappel.</span><span class="sxs-lookup"><span data-stu-id="c44f9-106">**HrAllocAdviseSink** creates an advise sink object with an implementation of **OnNotify** that invokes a callback function.</span></span> 
  
<span data-ttu-id="c44f9-107">Il existe des avantages et inconvénients **HrAllocAdviseSink**.</span><span class="sxs-lookup"><span data-stu-id="c44f9-107">There are advantages and disadvantages to using **HrAllocAdviseSink**.</span></span> <span data-ttu-id="c44f9-108">Il peut enregistrer le travail, mais il ne permet de contrôler aucun décompte de l’objet récepteur advise qu’il crée.</span><span class="sxs-lookup"><span data-stu-id="c44f9-108">It can save work, but it provides no control over reference counting the advise sink object that it creates.</span></span> <span data-ttu-id="c44f9-109">Par conséquent, les clients qui ont besoin de contrôler avec soin version du récepteur de leurs notifications ou qui ont des interdépendances entre leur récepteur de notifications et un autre objet client doivent créer leur propre implémentation **IMAPIAdviseSink** et éviter d’utiliser ** HrAllocAdviseSink** complètement.</span><span class="sxs-lookup"><span data-stu-id="c44f9-109">Therefore, clients that need to carefully control their advise sink's release or that have interdependencies between their advise sink and another client object should construct their own **IMAPIAdviseSink** implementation and avoid using **HrAllocAdviseSink** altogether.</span></span> 
  
<span data-ttu-id="c44f9-110">Un client de mise en œuvre son propre récepteur de notifications doit rendre un objet indépendant non liés aux ou dépendent d’autres objets afin d’éliminer les problèmes potentiels de version de comptage et l’objet de référence.</span><span class="sxs-lookup"><span data-stu-id="c44f9-110">A client implementing its own advise sink should make it an independent object not related to or dependent upon any other objects so as to eliminate potential complications in reference counting and object release.</span></span> <span data-ttu-id="c44f9-111">Toutefois, si vous devez implémenter votre récepteur de notifications dans le cadre d’un autre objet ou inclure un pointeur vers un autre objet en tant que membre de données arrière, il est recommandé que deux le nombre de référence séparée est mis à jour : un pour l’objet référencé par le récepteur de notifications et un pour le récepteur de notification.</span><span class="sxs-lookup"><span data-stu-id="c44f9-111">However, if you must implement your advise sink as part of another object or include a back pointer to another object as a data member, it is recommended that two separate reference counts be maintained: one for the object referenced by the advise sink and one for the advise sink.</span></span> 
  
<span data-ttu-id="c44f9-112">Lorsque le décompte de références de l’objet référencé tombe à zéro, tous ses méthodes peuvent échouer et ses vtable peut être détruit, mais la mémoire pour le récepteur de notifications doit conservés jusqu'à après que son décompte de références également descend à zéro.</span><span class="sxs-lookup"><span data-stu-id="c44f9-112">When the reference count of the referenced object falls to zero, all of its methods can fail and its vtable can be destroyed, but the memory for the advise sink must remain intact until after its reference count also falls to zero.</span></span> <span data-ttu-id="c44f9-113">Cela signifie que méthode de **publication** du récepteur advise doit décrémente le décompte de références et terminer la destruction de l’objet lorsque ce décompte atteint zéro.</span><span class="sxs-lookup"><span data-stu-id="c44f9-113">This means that the advise sink's **Release** method must decrement its reference count and finish destroying the object when that count reaches zero.</span></span> <span data-ttu-id="c44f9-114">Si les deux comptes de référence distincts ne sont pas conservées, il est facile de détruire accidentellement le récepteur de notifications dans le cadre du processus de **publication** de l’objet de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="c44f9-114">If two separate reference counts are not maintained, it would be easy to inadvertently destroy the advise sink as part of the encompassing object's **Release** process.</span></span> 
  
<span data-ttu-id="c44f9-115">Clients à l’aide de **HrAllocAdviseSink** pour implémenter un récepteur de notifications doivent être également veiller à ne pas inclure de leur fonction de rappel en tant que méthode dans un autre objet récepteur de notifications.</span><span class="sxs-lookup"><span data-stu-id="c44f9-115">Clients using **HrAllocAdviseSink** to implement an advise sink must be equally careful not to include their callback function as a method in another advise sink object.</span></span> <span data-ttu-id="c44f9-116">Pour les clients C++, il est tentant de faire passer le pointeur _this_ comme paramètre.</span><span class="sxs-lookup"><span data-stu-id="c44f9-116">For C++ clients, it is tempting to do this and pass the  _this_ pointer as a parameter.</span></span> <span data-ttu-id="c44f9-117">Il s’agit d’une stratégie dangereuse parce que les clients libèrent généralement un objet lorsque son décompte de références atteint zéro.</span><span class="sxs-lookup"><span data-stu-id="c44f9-117">This is a dangerous strategy because clients typically free an object when its reference count reaches zero.</span></span> <span data-ttu-id="c44f9-118">Libérer de la mémoire pour l’objet de récepteur advise se rendre le pointeur _this_ non valide.</span><span class="sxs-lookup"><span data-stu-id="c44f9-118">Freeing the memory for the advise sink object would render the  _this_ pointer invalid.</span></span> 
  
<span data-ttu-id="c44f9-119">Selon le type d’événement et la source de notifications, votre méthode **OnNotify** peut gérer les événements de différentes manières.</span><span class="sxs-lookup"><span data-stu-id="c44f9-119">Depending on the type of event and the advise source, your **OnNotify** method can handle events in various ways.</span></span> <span data-ttu-id="c44f9-120">Le tableau suivant propose des suggestions sur la façon de gérer certains événements standards.</span><span class="sxs-lookup"><span data-stu-id="c44f9-120">The following table offers suggestions in how to handle some of the standard events.</span></span> 
  
|<span data-ttu-id="c44f9-121">**Type d’événement**</span><span class="sxs-lookup"><span data-stu-id="c44f9-121">**Type of event**</span></span>|<span data-ttu-id="c44f9-122">**Gestion de OnNotify**</span><span class="sxs-lookup"><span data-stu-id="c44f9-122">**Handling in OnNotify**</span></span>|
|:-----|:-----|
|<span data-ttu-id="c44f9-123">Objet déplacé</span><span class="sxs-lookup"><span data-stu-id="c44f9-123">Object moved</span></span>  <br/> |<span data-ttu-id="c44f9-124">Si le parent d’origine de l’objet déplacé est lié au nouveau parent, mettre à jour le début de l’affichage du dossier ou du conteneur de carnet d’adresses la plus élevée dans la hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="c44f9-124">If the moved object's original parent is related to the new parent, update the view beginning with the folder or address book container highest in the hierarchy.</span></span> <span data-ttu-id="c44f9-125">Si les conteneurs deux parents ne sont pas liés, mettre à jour de leur point de vue.</span><span class="sxs-lookup"><span data-stu-id="c44f9-125">If the two parent containers are unrelated, update both of their views.</span></span>  <br/> |
|<span data-ttu-id="c44f9-126">Nouveau message</span><span class="sxs-lookup"><span data-stu-id="c44f9-126">New message</span></span>  <br/> |<span data-ttu-id="c44f9-127">Modifier l’interface utilisateur pour informer l’utilisateur de l’arrivée d’un ou plusieurs nouveaux messages.</span><span class="sxs-lookup"><span data-stu-id="c44f9-127">Change the user interface to inform the user of the arrival of one or more new messages.</span></span> <span data-ttu-id="c44f9-128">Placez le dossier de réception dans l’affichage actuel.</span><span class="sxs-lookup"><span data-stu-id="c44f9-128">Place the receive folder in the current view.</span></span>  <br/> |
|<span data-ttu-id="c44f9-129">Erreur</span><span class="sxs-lookup"><span data-stu-id="c44f9-129">Error</span></span>  <br/> |<span data-ttu-id="c44f9-130">Pour tous les objets à l’exception de la session, ouvrez une session l’erreur si nécessaire et de retour.</span><span class="sxs-lookup"><span data-stu-id="c44f9-130">For all objects except the session, log the error if necessary and return.</span></span> <span data-ttu-id="c44f9-131">Pour l’objet session, fermez la session, si possible.</span><span class="sxs-lookup"><span data-stu-id="c44f9-131">For the session object, log off if possible.</span></span>  <br/> |
|<span data-ttu-id="c44f9-132">Recherche terminée</span><span class="sxs-lookup"><span data-stu-id="c44f9-132">Search complete</span></span>  <br/> |<span data-ttu-id="c44f9-133">Aucun traitement n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="c44f9-133">No processing necessary.</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="c44f9-134">Gestionnaires de notification doivent être réentrants.</span><span class="sxs-lookup"><span data-stu-id="c44f9-134">Notification handlers should be reentrant.</span></span> 
  

