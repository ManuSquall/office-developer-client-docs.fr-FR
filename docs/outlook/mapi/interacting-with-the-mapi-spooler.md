---
title: Interaction avec le spouleur MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: c8032172ef19fbb01af68058b2e0255e269183a8
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/23/2018
ms.locfileid: "22587893"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="83949-103">Interaction avec le spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="83949-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="83949-104">**S’applique à**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="83949-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="83949-105">Les méthodes dans le [IXPLogon : IUnknown](ixplogoniunknown.md) interface utilisés par le spouleur MAPI lors de l’appel du fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="83949-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="83949-106">Il doit être possible, pour la plupart des types de fournisseurs de transport pour implémenter la plupart de ces méthodes pour qu’elles retournent rapidement.</span><span class="sxs-lookup"><span data-stu-id="83949-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="83949-107">Il est souhaitable, car si une méthode prend beaucoup de temps à retourner puis il doit être divisée avec appelle de nouveau le spouleur MAPI pour libérer de l’UC pour d’autres tâches.</span><span class="sxs-lookup"><span data-stu-id="83949-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="83949-108">Le spouleur MAPI s’exécute et effectue ses appels aux fournisseurs de transport lorsque les applications de premier plan sont inactifs.</span><span class="sxs-lookup"><span data-stu-id="83949-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="83949-109">Après affichage éventuellement les boîtes de dialogue lorsque le fournisseur de transport est tout d’abord connecté (régi par les indicateurs passés à partir de MAPI pour le fournisseur de transport), les fournisseurs de transport fonctionnent en arrière-plan, sauf si appelée par le client à vider envoyer et recevoir des files d’attente.</span><span class="sxs-lookup"><span data-stu-id="83949-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="83949-110">Files d’attente de vidage est la seule fois qu’un fournisseur de transport libère pas forcément l’UC, puis uniquement si l’utilisateur est informé qu’une action peut être longue est en cours.</span><span class="sxs-lookup"><span data-stu-id="83949-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="83949-111">Le spouleur MAPI demande généralement qu’un fournisseur de transport purger ses files d’attente en réponse à une action de l’utilisateur, afin que le fournisseur de transport ne doit généralement pas rien à faire pour vous assurer que l’utilisateur est informé.</span><span class="sxs-lookup"><span data-stu-id="83949-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="83949-112">Un fournisseur de transport peut décider de manière indépendante vider une file d’attente et les bits STATUS_INBOUND_FLUSH et STATUS_OUTBOUND_FLUSH dans la propriété **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) de la ligne d’état pour informer le spouleur MAPI qu’elle a besoin Attention afin qu’elle peut faire le travail.</span><span class="sxs-lookup"><span data-stu-id="83949-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="83949-113">La ligne d’état est mis à jour à l’aide de la méthode [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="83949-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="83949-114">Dans ce cas le fournisseur de transport doit probablement afficher un indicateur de progression ou une autre interface pour informer l’utilisateur qu’une action de type longue qui se produit.</span><span class="sxs-lookup"><span data-stu-id="83949-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="83949-115">Étant donné que l’activité réseau prend souvent plus de 0,2 secondes, fournisseurs de transport doivent, si possible, utilisez demandes réseau asynchrones.</span><span class="sxs-lookup"><span data-stu-id="83949-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="83949-116">Cela leur permet de lancer une requête, la version de l’UC en effectuant un rappel pour le spouleur MAPI et le spouleur MAPI leur confère à nouveau contrôle, pour vérifier si leur demande réseau a terminé.</span><span class="sxs-lookup"><span data-stu-id="83949-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="83949-117">Si elle n’est pas encore terminée, ils release à nouveau l’UC en effectuant un rappel pour le spouleur MAPI avec la méthode [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) .</span><span class="sxs-lookup"><span data-stu-id="83949-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="83949-118">Au cours de traitement des messages, entre [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) et [IXPLogon::EndMessage](ixplogon-endmessage.md) et pendant [IXPLogon::StartMessage](ixplogon-startmessage.md), le fournisseur de transport effectue généralement de nombreux appels sur les objets exposés à celui-ci par le spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="83949-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="83949-119">Dans le cadre de la gestion de ces objets, le spouleur MAPI permet le fournisseur de transport se comportent correctement en arrière-plan grâce à la production sur son propre le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="83949-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="83949-120">Un fournisseur de transport nécessitant un traitement serré peut déclarer une section critique au spouleur MAPI à l’aide de la méthode [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) prise en charge de l’objet.</span><span class="sxs-lookup"><span data-stu-id="83949-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="83949-121">Dans ce cas, l’UC est publié uniquement des appels explicites **SpoolerYield** par le fournisseur de transport jusqu'à ce que le fournisseur de transport termine avec un autre appel à **SpoolerNotify**de traitement de section critique.</span><span class="sxs-lookup"><span data-stu-id="83949-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="83949-122">Il n’est pas identique à une section critique Win32.</span><span class="sxs-lookup"><span data-stu-id="83949-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="83949-123">Il doit être effectuée uniquement lorsque le fournisseur de transport a besoin en temps réel de contrôle des ressources externes, telles que la lecture de données entrantes à partir d’une ligne de télécopie.</span><span class="sxs-lookup"><span data-stu-id="83949-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="83949-124">Étant donné que cela entraîne la priorité du processus de spouleur MAPI et peut entraîner la station de travail à ne répond pas pendant la durée de l’opération, il est judicieux de signaler à l’utilisateur qu’une action peut être longue est en cours d’exécution et fournir un indicateur de progression dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="83949-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

