---
title: Notification d'événement de prise en charge
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: 'Dernière modification : 23 juillet 2011'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327425"
---
# <a name="supporting-event-notification"></a><span data-ttu-id="f758e-103">Notification d'événement de prise en charge</span><span class="sxs-lookup"><span data-stu-id="f758e-103">Supporting Event Notification</span></span>

  
  
<span data-ttu-id="f758e-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="f758e-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="f758e-105">Étant donné que la notification d'événement de prise en charge peut être compliquée, MAPI fournit trois méthodes d'objet de prise en charge qui implémentent les composants les plus difficiles du processus.</span><span class="sxs-lookup"><span data-stu-id="f758e-105">Because supporting event notification can be complicated, MAPI supplies three support object methods that implement the most difficult parts of the process.</span></span> <span data-ttu-id="f758e-106">Ces méthodes fonctionnent comme une unité, et un fournisseur doit utiliser les trois ou aucun d'entre eux.</span><span class="sxs-lookup"><span data-stu-id="f758e-106">These methods work as a unit, and a provider must use all three or none of them.</span></span>
  
<span data-ttu-id="f758e-107">Les méthodes de prise en charge MAPI utilisent des clés de notification pour gérer les connexions entre les récepteurs de notification et les objets qui génèrent les notifications.</span><span class="sxs-lookup"><span data-stu-id="f758e-107">The MAPI support methods use notification keys to manage the connections between the advise sinks and the objects that generate the notifications.</span></span> <span data-ttu-id="f758e-108">Une clé de notification est une structure [NOTIFKEY](notifkey.md) qui contient des données binaires qui identifient un objet parmi les processus.</span><span class="sxs-lookup"><span data-stu-id="f758e-108">A notification key is a [NOTIFKEY](notifkey.md) structure that contains binary data that identifies an object across processes.</span></span> <span data-ttu-id="f758e-109">Une clé de notification est généralement copiée à partir de l'identificateur d'entrée à long terme de l'objet de source Advise.</span><span class="sxs-lookup"><span data-stu-id="f758e-109">A notification key is typically copied from the long-term entry identifier of the advise source object.</span></span> <span data-ttu-id="f758e-110">Si le client a fourni un identificateur d'entrée dans l'appel à **conseiller**, vous pouvez l'utiliser pour la clé de notification.</span><span class="sxs-lookup"><span data-stu-id="f758e-110">If the client has supplied an entry identifier in the call to **Advise**, you can use it for the notification key.</span></span> <span data-ttu-id="f758e-111">Si le paramètre _lpEntryID_ à **conseiller** a la valeur null, utilisez l'identificateur d'entrée de l'objet conteneur éventuellement le plus à l'extérieur, comme la Banque de messages.</span><span class="sxs-lookup"><span data-stu-id="f758e-111">If the  _lpEntryID_ parameter to **Advise** is NULL, use the entry identifier of the outermost possible container object, such as the message store.</span></span> 
  
<span data-ttu-id="f758e-112">Pour utiliser les méthodes de prise en charge, appelez [IMAPISupport:: subscribe](imapisupport-subscribe.md) chaque fois \*\*\*\* qu'un client appelle votre méthode Advise pour s'inscrire pour une notification.</span><span class="sxs-lookup"><span data-stu-id="f758e-112">To use the support methods, call [IMAPISupport::Subscribe](imapisupport-subscribe.md) whenever a client calls your **Advise** method to register for a notification.</span></span> <span data-ttu-id="f758e-113">AlLouez une structure [NOTIFKEY](notifkey.md) et créez une clé de notification unique pour votre objet de source de notification.</span><span class="sxs-lookup"><span data-stu-id="f758e-113">Allocate a [NOTIFKEY](notifkey.md) structure and create a unique notification key for your advise source object.</span></span> <span data-ttu-id="f758e-114">Par exemple, un fournisseur de banque de messages qui est invité à informer un client lors de la réception d'un message dans un dossier particulier crée une clé de notification pour ce dossier.</span><span class="sxs-lookup"><span data-stu-id="f758e-114">For example, a message store provider that is prompted to notify a client when a message is received into a particular folder creates a notification key for that folder.</span></span> <span data-ttu-id="f758e-115">TransMettez un pointeur vers la structure **NOTIFKEY** dans l'appel pour **s'abonner** , ainsi qu'un pointeur vers le récepteur de notification du client.</span><span class="sxs-lookup"><span data-stu-id="f758e-115">Pass a pointer to the **NOTIFKEY** structure in the call to **Subscribe** along with a pointer to the client's advise sink.</span></span> <span data-ttu-id="f758e-116">**Subscribe** appelle la méthode [IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) du récepteur de notification pour incrémenter son décompte de référence et MAPI conserve le pointeur jusqu'à l'annulation de l'inscription.</span><span class="sxs-lookup"><span data-stu-id="f758e-116">**Subscribe** calls the advise sink's [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) method to increment its reference count and MAPI retains the pointer until the registration is canceled.</span></span> 
  
<span data-ttu-id="f758e-117">Vous pouvez transmettre l'indicateur NOTIFY_SYNC pour **vous abonner** afin \*\*\*\* de demander que les notifications se comportent de manière synchrone et ne soient pas renvoyées jusqu'à ce qu'il ait effectué tous les appels aux méthodes [IMAPIAdviseSink:: OnNotify](imapiadvisesink-onnotify.md) des récepteurs de notifications enregistrés.</span><span class="sxs-lookup"><span data-stu-id="f758e-117">You can pass the NOTIFY_SYNC flag to **Subscribe** to request that **Notify** behave synchronously and not return until it has made all calls to the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) methods of registered advise sinks.</span></span> <span data-ttu-id="f758e-118">Définissez cet indicateur uniquement pour votre usage interne.</span><span class="sxs-lookup"><span data-stu-id="f758e-118">Set this flag only for your own internal use.</span></span> <span data-ttu-id="f758e-119">Ne la définissez pas lorsque vous répondez à un appel de **Conseil** client.</span><span class="sxs-lookup"><span data-stu-id="f758e-119">Do not set it when you respond to a client **Advise** call.</span></span> <span data-ttu-id="f758e-120">La notification d'événement entre les clients et les fournisseurs est toujours asynchrone.</span><span class="sxs-lookup"><span data-stu-id="f758e-120">Event notification between clients and providers is always asynchronous.</span></span> <span data-ttu-id="f758e-121">En d'autres conditions, MAPI garantit que l'appel pendant lequel un événement se produit renverra au client avant d'effectuer les appels **OnNotify** .</span><span class="sxs-lookup"><span data-stu-id="f758e-121">That is, MAPI guarantees that the call during which an event happens will return to the client before any of the **OnNotify** calls are made.</span></span> 
  
<span data-ttu-id="f758e-122">Si vous définissez l'indicateur NOTIFY_SYNC, n'effectuez aucune modification dans les objets de récepteur de notifications et ne transmettez pas de récepteur de notification de wrapper créé par [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) pour **s'abonner**.</span><span class="sxs-lookup"><span data-stu-id="f758e-122">If you set the NOTIFY_SYNC flag, do not make any changes to any of the advise sink objects, and do not pass a wrapper advise sink created by [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) to **Subscribe**.</span></span> <span data-ttu-id="f758e-123">**HrThisThreadAdviseSink** crée une version thread-safe d'un récepteur de notifications à utiliser uniquement avec la notification asynchrone.</span><span class="sxs-lookup"><span data-stu-id="f758e-123">**HrThisThreadAdviseSink** creates a thread-safe version of an advise sink to be used with asynchronous notification only.</span></span> 
  
<span data-ttu-id="f758e-124">Si un récepteur de notifications inscrit pour une notification synchrone est renvoyé à partir de **OnNotify** avec l'indicateur CALLBACK_DISCONTINUE défini, [IMAPISupport:: Notify](imapisupport-notify.md) définit l'indicateur NOTIFY_CANCELED et retourne sans effectuer d'appels à **OnNotify**.</span><span class="sxs-lookup"><span data-stu-id="f758e-124">If an advise sink registered for synchronous notification returns from **OnNotify** with the CALLBACK_DISCONTINUE flag set, [IMAPISupport::Notify](imapisupport-notify.md) sets the NOTIFY_CANCELED flag and returns without making any calls to **OnNotify**.</span></span> 
  
<span data-ttu-id="f758e-125">Une fois que **subscribe** a été renvoyé, vous n'avez plus besoin de conserver votre copie du récepteur de notification du client.</span><span class="sxs-lookup"><span data-stu-id="f758e-125">Once **Subscribe** has returned, you will no longer have any need to hold onto your copy of the client's advise sink.</span></span> <span data-ttu-id="f758e-126">Appelez sa méthode [IUnknown:: Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) pour le libérer.</span><span class="sxs-lookup"><span data-stu-id="f758e-126">Call its [IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) method to release it.</span></span> <span data-ttu-id="f758e-127">**Subscribe** renvoie un numéro de connexion différent de zéro que vous devez retourner au client.</span><span class="sxs-lookup"><span data-stu-id="f758e-127">**Subscribe** returns a nonzero connection number that you should return to the client.</span></span> <span data-ttu-id="f758e-128">Le numéro de connexion représente le lien entre la source de notification et le récepteur de notifications.</span><span class="sxs-lookup"><span data-stu-id="f758e-128">The connection number represents the link between the advise source and the advise sink.</span></span> <span data-ttu-id="f758e-129">Il reste valide jusqu'à ce que le client ait réussi \*\*\*\* à déconseiller.</span><span class="sxs-lookup"><span data-stu-id="f758e-129">It remains valid until the client makes a successful call to **Unadvise**.</span></span> 
  
<span data-ttu-id="f758e-130">Lorsque le client est prêt à annuler une inscription, il appelle votre \*\*\*\* méthode Unadvise.</span><span class="sxs-lookup"><span data-stu-id="f758e-130">When the client is ready to cancel a registration, it calls your **Unadvise** method.</span></span> <span data-ttu-id="f758e-131">TransMettez le numéro de connexion \*\*\*\* de l'appel Unadvise à [IMAPISupport:: unsubscribe](imapisupport-unsubscribe.md).</span><span class="sxs-lookup"><span data-stu-id="f758e-131">Pass the connection number from the **Unadvise** call to [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span></span> <span data-ttu-id="f758e-132">**Unsubscribe** appelle la méthode **IUnknown:: Release** du récepteur de notification.</span><span class="sxs-lookup"><span data-stu-id="f758e-132">**Unsubscribe** calls the advise sink's **IUnknown::Release** method.</span></span> <span data-ttu-id="f758e-133">Comme avec **Advise** et Unadvise, les appels à **subscribe** et unsubscribe doivent être couplés. \*\*\*\* \*\*\*\*</span><span class="sxs-lookup"><span data-stu-id="f758e-133">As with **Advise** and **Unadvise**, calls to **Subscribe** and **Unsubscribe** must be paired.</span></span> <span data-ttu-id="f758e-134">Vous devez passer un appel pour annuler l' **abonnement** pour chaque appel effectué pour **s'abonner**.</span><span class="sxs-lookup"><span data-stu-id="f758e-134">You must make one call to **Unsubscribe** for every call that is made to **Subscribe**.</span></span> <span data-ttu-id="f758e-135">Toutefois, vous n'avez pas besoin d'appeler **subscribe** à chaque appel de la méthode Advise. \*\*\*\*</span><span class="sxs-lookup"><span data-stu-id="f758e-135">However, you do not have to call **Subscribe** every time your **Advise** method is called.</span></span> <span data-ttu-id="f758e-136">À l'inverse, vous pouvez l'appeler pour configurer des notifications internes.</span><span class="sxs-lookup"><span data-stu-id="f758e-136">Conversely, you can call it for setting up internal notifications.</span></span> 
  
<span data-ttu-id="f758e-137">Lorsqu'un événement se produit, allouez une ou plusieurs structures de [notification](notification.md) du type approprié pour l'événement et appelez [IMAPISupport:: Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="f758e-137">When an event occurs, allocate one or more [NOTIFICATION](notification.md) structures of the type appropriate for the event and call [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="f758e-138">**Notify** génère une notification pour chaque récepteur d'avis enregistré.</span><span class="sxs-lookup"><span data-stu-id="f758e-138">**Notify** generates a notification for each registered advise sink.</span></span> <span data-ttu-id="f758e-139">Vous devez affecter la valeur zéro à tous les membres inutilisés de la structure de [notification](notification.md) .</span><span class="sxs-lookup"><span data-stu-id="f758e-139">You should set all the unused members of the [NOTIFICATION](notification.md) structure to zero.</span></span> <span data-ttu-id="f758e-140">Cette technique d'initialisation de la structure de **notification** peut aider les clients à créer des implémentations **OnNotify** plus petites, plus rapides et moins sujettes aux erreurs.</span><span class="sxs-lookup"><span data-stu-id="f758e-140">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="f758e-141">Notez qu'une structure de **notification** distincte est nécessaire pour chaque événement, même pour plusieurs événements du même type.</span><span class="sxs-lookup"><span data-stu-id="f758e-141">Note that a separate **NOTIFICATION** structure is necessary for each event, even for multiple events of the same type.</span></span> <span data-ttu-id="f758e-142">Par exemple, si trois clients sont inscrits pour la notification de table sur une table particulière et que cinq lignes sont ajoutées à la table, vous devez créer cinq structures **OBJECT_NOTIFICATION** pour votre appel **Notify** .</span><span class="sxs-lookup"><span data-stu-id="f758e-142">For example, if three clients are registered for table notification on a particular table and five rows are added to the table, you must create five **OBJECT_NOTIFICATION** structures for your **Notify** call.</span></span> <span data-ttu-id="f758e-143">Une notification par lots telle que celle-ci génère de meilleures performances que l'appel de **notification** cinq fois.</span><span class="sxs-lookup"><span data-stu-id="f758e-143">A batch notification such as this results in better performance than calling **Notify** five times.</span></span> <span data-ttu-id="f758e-144">Pour chaque appel **Notify** , MAPI appelle la méthode [IMAPIAdviseSink:: OnNotify](imapiadvisesink-onnotify.md) de chaque récepteur de notifications enregistrées.</span><span class="sxs-lookup"><span data-stu-id="f758e-144">For each **Notify** call, MAPI calls the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method of every registered advise sink.</span></span> <span data-ttu-id="f758e-145">Si aucun récepteur de notification n'est enregistré, MAPI ignore l'appel.</span><span class="sxs-lookup"><span data-stu-id="f758e-145">If there are no registered advise sinks, MAPI ignores the call.</span></span> 
  
<span data-ttu-id="f758e-146">Les fournisseurs de services qui envoient des notifications par lots doivent les ordonner afin qu'ils puissent être interprétés de la première notification au dernier.</span><span class="sxs-lookup"><span data-stu-id="f758e-146">Service providers that send batched notifications must order them so that they can be interpreted from the first notification to the last.</span></span> <span data-ttu-id="f758e-147">Ce classement est particulièrement nécessaire lorsqu'un lot de notifications contient une série d'événements, tels que TABLE_ROW_ADDED, avec un événement qui fait référence à une ligne précédente ajoutée à un autre événement dans le même lot.</span><span class="sxs-lookup"><span data-stu-id="f758e-147">This ordering is especially necessary when a notification batch contains a series of events, such as TABLE_ROW_ADDED with one event that refers to a prior row that was added in another event in the same batch.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="f758e-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f758e-148">See also</span></span>



[<span data-ttu-id="f758e-149">Fournisseurs de services MAPI</span><span class="sxs-lookup"><span data-stu-id="f758e-149">MAPI Service Providers</span></span>](mapi-service-providers.md)

