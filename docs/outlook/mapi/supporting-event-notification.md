---
title: Prise en charge de la Notification d’événement
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: 'Derni�re modification�: samedi 23 juillet 2011'
ms.openlocfilehash: 45bfe9f9314a154bd5f096ac20f76f6bf4f259c3
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/11/2018
ms.locfileid: "19787266"
---
# <a name="supporting-event-notification"></a><span data-ttu-id="9597b-103">Prise en charge de la Notification d’événement</span><span class="sxs-lookup"><span data-stu-id="9597b-103">Supporting Event Notification</span></span>

  
  
<span data-ttu-id="9597b-104">**S’applique à**: Outlook</span><span class="sxs-lookup"><span data-stu-id="9597b-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="9597b-105">Prise en charge de la notification d’événement pouvant être complexe, MAPI fournit trois méthodes d’objet prise en charge qui implémentent la partie la plus difficile du processus.</span><span class="sxs-lookup"><span data-stu-id="9597b-105">Because supporting event notification can be complicated, MAPI supplies three support object methods that implement the most difficult parts of the process.</span></span> <span data-ttu-id="9597b-106">Ces méthodes fonctionnent comme une unité, et un fournisseur doit utiliser tous les trois ou aucun d'entre eux.</span><span class="sxs-lookup"><span data-stu-id="9597b-106">These methods work as a unit, and a provider must use all three or none of them.</span></span>
  
<span data-ttu-id="9597b-107">Les méthodes de prise en charge MAPI utilisent des clés de notification pour gérer les connexions entre les récepteurs de notifications et les objets qui génèrent des notifications.</span><span class="sxs-lookup"><span data-stu-id="9597b-107">The MAPI support methods use notification keys to manage the connections between the advise sinks and the objects that generate the notifications.</span></span> <span data-ttu-id="9597b-108">Une clé de notification est une structure [NOTIFKEY](notifkey.md) qui contient des données binaires qui identifie un objet entre les processus.</span><span class="sxs-lookup"><span data-stu-id="9597b-108">A notification key is a [NOTIFKEY](notifkey.md) structure that contains binary data that identifies an object across processes.</span></span> <span data-ttu-id="9597b-109">Une clé de notification est généralement copiée à partir de l’identificateur d’entrée à long terme de l’objet source de notification.</span><span class="sxs-lookup"><span data-stu-id="9597b-109">A notification key is typically copied from the long-term entry identifier of the advise source object.</span></span> <span data-ttu-id="9597b-110">Si le client a fourni un identificateur d’entrée dans l’appel à **Advise**, vous pouvez l’utiliser pour la clé de notification.</span><span class="sxs-lookup"><span data-stu-id="9597b-110">If the client has supplied an entry identifier in the call to **Advise**, you can use it for the notification key.</span></span> <span data-ttu-id="9597b-111">Si le paramètre _lpEntryID_ **Advise** est NULL, utilisez l’identificateur d’entrée de l’objet conteneur le plus éloigné possibles, telles que la banque de messages.</span><span class="sxs-lookup"><span data-stu-id="9597b-111">If the  _lpEntryID_ parameter to **Advise** is NULL, use the entry identifier of the outermost possible container object, such as the message store.</span></span> 
  
<span data-ttu-id="9597b-112">Pour utiliser les méthodes de prise en charge, appelez [IMAPISupport::Subscribe](imapisupport-subscribe.md) chaque fois qu’un client appelle votre méthode **Advise** pour vous inscrire à une notification.</span><span class="sxs-lookup"><span data-stu-id="9597b-112">To use the support methods, call [IMAPISupport::Subscribe](imapisupport-subscribe.md) whenever a client calls your **Advise** method to register for a notification.</span></span> <span data-ttu-id="9597b-113">Allouer une structure [NOTIFKEY](notifkey.md) et créer une clé de notification unique pour votre objet de source advise.</span><span class="sxs-lookup"><span data-stu-id="9597b-113">Allocate a [NOTIFKEY](notifkey.md) structure and create a unique notification key for your advise source object.</span></span> <span data-ttu-id="9597b-114">Par exemple, un fournisseur de magasins de message est invité à informer un client lorsqu’un message est reçu dans un dossier spécifique crée une clé de notification pour ce dossier.</span><span class="sxs-lookup"><span data-stu-id="9597b-114">For example, a message store provider that is prompted to notify a client when a message is received into a particular folder creates a notification key for that folder.</span></span> <span data-ttu-id="9597b-115">Passez un pointeur vers la structure **NOTIFKEY** dans l’appel de **s’abonner** avec un pointeur vers du client récepteur de notification.</span><span class="sxs-lookup"><span data-stu-id="9597b-115">Pass a pointer to the **NOTIFKEY** structure in the call to **Subscribe** along with a pointer to the client's advise sink.</span></span> <span data-ttu-id="9597b-116">**S’abonner** appelle [IUnknown::AddRef](http://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) méthode du récepteur advise pour incrémenter son décompte de références et MAPI conserve le pointeur jusqu'à ce que l’enregistrement est annulée.</span><span class="sxs-lookup"><span data-stu-id="9597b-116">**Subscribe** calls the advise sink's [IUnknown::AddRef](http://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) method to increment its reference count and MAPI retains the pointer until the registration is canceled.</span></span> 
  
<span data-ttu-id="9597b-117">Vous pouvez passer l’indicateur NOTIFY_SYNC à **s’abonner** à demander que **Notify** se comportent de façon synchrone et pas retour jusqu'à ce qu’il a apportées à tous les appels vers les méthodes [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) d’inscrit récepteurs de notifications.</span><span class="sxs-lookup"><span data-stu-id="9597b-117">You can pass the NOTIFY_SYNC flag to **Subscribe** to request that **Notify** behave synchronously and not return until it has made all calls to the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) methods of registered advise sinks.</span></span> <span data-ttu-id="9597b-118">Définissez cet indicateur uniquement à votre propre usage interne.</span><span class="sxs-lookup"><span data-stu-id="9597b-118">Set this flag only for your own internal use.</span></span> <span data-ttu-id="9597b-119">Ne le définissez pas lorsque vous répondez à un appel **Advise** client.</span><span class="sxs-lookup"><span data-stu-id="9597b-119">Do not set it when you respond to a client **Advise** call.</span></span> <span data-ttu-id="9597b-120">Notification d’événement entre les clients et fournisseurs est toujours asynchrone.</span><span class="sxs-lookup"><span data-stu-id="9597b-120">Event notification between clients and providers is always asynchronous.</span></span> <span data-ttu-id="9597b-121">Autrement dit, MAPI garantit que l’appel pendant laquelle un événement se produit renverra au client avant qu’un des appels **OnNotify** soient effectué.</span><span class="sxs-lookup"><span data-stu-id="9597b-121">That is, MAPI guarantees that the call during which an event happens will return to the client before any of the **OnNotify** calls are made.</span></span> 
  
<span data-ttu-id="9597b-122">Si vous définissez l’indicateur NOTIFY_SYNC, n’apportez aucune modification à tous les objets de récepteur advise et ne passent pas d’un récepteur de notifications wrapper créé par [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) **s’abonner**.</span><span class="sxs-lookup"><span data-stu-id="9597b-122">If you set the NOTIFY_SYNC flag, do not make any changes to any of the advise sink objects, and do not pass a wrapper advise sink created by [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) to **Subscribe**.</span></span> <span data-ttu-id="9597b-123">**HrThisThreadAdviseSink** crée une version thread-safe d’un récepteur de notifications à utiliser avec la notification asynchrone.</span><span class="sxs-lookup"><span data-stu-id="9597b-123">**HrThisThreadAdviseSink** creates a thread-safe version of an advise sink to be used with asynchronous notification only.</span></span> 
  
<span data-ttu-id="9597b-124">Si un récepteur de notifications enregistré pour une notification synchrone renvoie de **OnNotify** avec l’indicateur CALLBACK_DISCONTINUE, [IMAPISupport::Notify](imapisupport-notify.md) définit l’indicateur NOTIFY_CANCELED et renvoie sans apporter de tous les appels à **OnNotify**.</span><span class="sxs-lookup"><span data-stu-id="9597b-124">If an advise sink registered for synchronous notification returns from **OnNotify** with the CALLBACK_DISCONTINUE flag set, [IMAPISupport::Notify](imapisupport-notify.md) sets the NOTIFY_CANCELED flag and returns without making any calls to **OnNotify**.</span></span> 
  
<span data-ttu-id="9597b-125">Une fois que **l’abonnement** a renvoyé, vous n’aura plus nécessaire de conserver votre copie du récepteur de notification du client.</span><span class="sxs-lookup"><span data-stu-id="9597b-125">Once **Subscribe** has returned, you will no longer have any need to hold onto your copy of the client's advise sink.</span></span> <span data-ttu-id="9597b-126">Appelez la méthode [IUnknown::Release](http://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) pour libérer.</span><span class="sxs-lookup"><span data-stu-id="9597b-126">Call its [IUnknown::Release](http://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) method to release it.</span></span> <span data-ttu-id="9597b-127">**S’abonner** renvoie un nombre différent de zéro connexion vous devez retourner au client.</span><span class="sxs-lookup"><span data-stu-id="9597b-127">**Subscribe** returns a nonzero connection number that you should return to the client.</span></span> <span data-ttu-id="9597b-128">Le numéro de connexion représente la liaison entre la source des notifications et le récepteur de notifications.</span><span class="sxs-lookup"><span data-stu-id="9597b-128">The connection number represents the link between the advise source and the advise sink.</span></span> <span data-ttu-id="9597b-129">Il reste valide jusqu'à ce que le client effectue un appel réussi **Unadvise**.</span><span class="sxs-lookup"><span data-stu-id="9597b-129">It remains valid until the client makes a successful call to **Unadvise**.</span></span> 
  
<span data-ttu-id="9597b-130">Lorsque le client est prêt à annuler un enregistrement, il appelle la méthode **Unadvise** .</span><span class="sxs-lookup"><span data-stu-id="9597b-130">When the client is ready to cancel a registration, it calls your **Unadvise** method.</span></span> <span data-ttu-id="9597b-131">Passez le numéro de connexion de l’appel de **Unadvise** à [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span><span class="sxs-lookup"><span data-stu-id="9597b-131">Pass the connection number from the **Unadvise** call to [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span></span> <span data-ttu-id="9597b-132">**Annuler l’abonnement** appelle la méthode de **IUnknown::Release** de notification du récepteur.</span><span class="sxs-lookup"><span data-stu-id="9597b-132">**Unsubscribe** calls the advise sink's **IUnknown::Release** method.</span></span> <span data-ttu-id="9597b-133">Comme avec **Advise** et **Unadvise**, appels **s’abonner** et **Annuler l’abonnement** doivent être associés.</span><span class="sxs-lookup"><span data-stu-id="9597b-133">As with **Advise** and **Unadvise**, calls to **Subscribe** and **Unsubscribe** must be paired.</span></span> <span data-ttu-id="9597b-134">Vous devez apporter un appel pour **Annuler l’abonnement** pour chaque appel effectué **s’abonner**.</span><span class="sxs-lookup"><span data-stu-id="9597b-134">You must make one call to **Unsubscribe** for every call that is made to **Subscribe**.</span></span> <span data-ttu-id="9597b-135">Toutefois, vous n’êtes pas obligé d’appelé la méthode **Subscribe** chaque fois que votre méthode **Advise** est appelée.</span><span class="sxs-lookup"><span data-stu-id="9597b-135">However, you do not have to call **Subscribe** every time your **Advise** method is called.</span></span> <span data-ttu-id="9597b-136">Inversement, vous pouvez l’appeler à la configuration de notifications internes.</span><span class="sxs-lookup"><span data-stu-id="9597b-136">Conversely, you can call it for setting up internal notifications.</span></span> 
  
<span data-ttu-id="9597b-137">Lorsqu’un événement se produit, allouer une ou plusieurs des structures [NOTIFICATION](notification.md) du type approprié pour l’événement et appelez [IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="9597b-137">When an event occurs, allocate one or more [NOTIFICATION](notification.md) structures of the type appropriate for the event and call [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="9597b-138">**Notifier** génère une notification pour chaque récepteur de notifications enregistrés.</span><span class="sxs-lookup"><span data-stu-id="9597b-138">**Notify** generates a notification for each registered advise sink.</span></span> <span data-ttu-id="9597b-139">Vous devez définir tous les membres inutilisées de la structure de [NOTIFICATION](notification.md) à zéro.</span><span class="sxs-lookup"><span data-stu-id="9597b-139">You should set all the unused members of the [NOTIFICATION](notification.md) structure to zero.</span></span> <span data-ttu-id="9597b-140">Cette technique pour l’initialisation de la structure **NOTIFICATION** peut aider les clients à créer plus petit, plus rapide et moins sujet aux erreurs **OnNotify** implémentations.</span><span class="sxs-lookup"><span data-stu-id="9597b-140">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="9597b-141">Notez qu’une structure **NOTIFICATION** distincte est nécessaire pour chaque événement, même pour plusieurs événements du même type.</span><span class="sxs-lookup"><span data-stu-id="9597b-141">Note that a separate **NOTIFICATION** structure is necessary for each event, even for multiple events of the same type.</span></span> <span data-ttu-id="9597b-142">Par exemple, si trois clients sont enregistrés pour la notification de table sur une table spécifique et cinq lignes sont ajoutées à la table, vous devez créer cinq structures **OBJECT_NOTIFICATION** pour votre appel **Notify** .</span><span class="sxs-lookup"><span data-stu-id="9597b-142">For example, if three clients are registered for table notification on a particular table and five rows are added to the table, you must create five **OBJECT_NOTIFICATION** structures for your **Notify** call.</span></span> <span data-ttu-id="9597b-143">Une notification de lot tel que cela entraîne de meilleures performances que l’appel **notifier** à cinq reprises.</span><span class="sxs-lookup"><span data-stu-id="9597b-143">A batch notification such as this results in better performance than calling **Notify** five times.</span></span> <span data-ttu-id="9597b-144">Pour chaque appel **Notify** , MAPI appelle la méthode de [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) de chaque récepteur de notifications enregistrés.</span><span class="sxs-lookup"><span data-stu-id="9597b-144">For each **Notify** call, MAPI calls the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method of every registered advise sink.</span></span> <span data-ttu-id="9597b-145">S’il y a non enregistré récepteurs, de notifications MAPI ignore l’appel.</span><span class="sxs-lookup"><span data-stu-id="9597b-145">If there are no registered advise sinks, MAPI ignores the call.</span></span> 
  
<span data-ttu-id="9597b-146">Fournisseurs de services d’envoi des notifications par lot doivent leur ordre afin qu’ils peuvent être interprétés de la première notification à la dernière.</span><span class="sxs-lookup"><span data-stu-id="9597b-146">Service providers that send batched notifications must order them so that they can be interpreted from the first notification to the last.</span></span> <span data-ttu-id="9597b-147">Cette commande est particulièrement nécessaire lorsqu’un lot de notifications contient une série d’événements, tel que TABLE_ROW_ADDED avec un événement qui fait référence à une ligne précédente a été ajoutée à un autre événement dans le même lot.</span><span class="sxs-lookup"><span data-stu-id="9597b-147">This ordering is especially necessary when a notification batch contains a series of events, such as TABLE_ROW_ADDED with one event that refers to a prior row that was added in another event in the same batch.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="9597b-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="9597b-148">See also</span></span>



[<span data-ttu-id="9597b-149">Fournisseurs de services MAPI</span><span class="sxs-lookup"><span data-stu-id="9597b-149">MAPI Service Providers</span></span>](mapi-service-providers.md)

