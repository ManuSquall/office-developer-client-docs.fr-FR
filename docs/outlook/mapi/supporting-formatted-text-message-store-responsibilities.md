---
title: Prise en charge des responsabilités de magasin de messages au format texte
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Derni�re modification�: lundi 9 mars 2015'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32350679"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a><span data-ttu-id="58e68-103">Prise en charge du texte mis en forme: responsabilités de la Banque de messages</span><span class="sxs-lookup"><span data-stu-id="58e68-103">Supporting Formatted Text: Message Store Responsibilities</span></span>

  
  
<span data-ttu-id="58e68-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="58e68-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="58e68-105">Les fournisseurs de banques de messages utilisent la propriété **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) pour publier s'ils peuvent gérer le format RTF (Rich Text Format), le texte HTML et, s'ils sont compatibles avec le format RTF, s'ils stockent le texte mis en forme dans une balise format compressé ou non compressé.</span><span class="sxs-lookup"><span data-stu-id="58e68-105">Message store providers use the **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property to publish whether or not they can handle Rich Text Format (RTF), HTML text and, if they are RTF-aware, whether they store the formatted text in a compressed or uncompressed format.</span></span> <span data-ttu-id="58e68-106">Les fournisseurs de banques de messages indiquent qu'ils peuvent prendre en charge le format RTF en définissant le bit STORE_RTF_OK et qu'ils stockent le texte mis en forme dans un formulaire non compressé en définissant le bit STORE_UNCOMPRESSED_RTF.</span><span class="sxs-lookup"><span data-stu-id="58e68-106">Message store providers indicate that they are RTF-aware by setting the STORE_RTF_OK bit and that they store the formatted text in an uncompressed form by setting the STORE_UNCOMPRESSED_RTF bit.</span></span> <span data-ttu-id="58e68-107">Les fournisseurs de banques de messages indiquent qu'ils prennent en charge le langage HTML en définissant le bit STORE_HTML_OK.</span><span class="sxs-lookup"><span data-stu-id="58e68-107">Message store providers indicate they are HTML-aware by setting the STORE_HTML_OK bit.</span></span>
  
<span data-ttu-id="58e68-108">Bien qu'il soit important pour un client compatible RTF de vérifier le bit STORE_RTF_OK pour déterminer si un magasin de messages prend en charge le format RTF, il n'est pas nécessaire qu'un client soit concerné par le format du texte mis en forme du magasin RTF.</span><span class="sxs-lookup"><span data-stu-id="58e68-108">While it is important for an RTF-aware client to check for the STORE_RTF_OK bit to determine whether or not a message store supports RTF, it is not necessary for a client to be concerned with the format of an RTF-aware store's formatted text.</span></span> 
  
<span data-ttu-id="58e68-109">Tous les magasins de messages doivent prendre en charge les clients qui ne sont pas compatibles avec le format RTF.</span><span class="sxs-lookup"><span data-stu-id="58e68-109">All message stores must support non-RTF-aware clients.</span></span> <span data-ttu-id="58e68-110">Un magasin de messages non compatible avec le format RTF doit supprimer la propriété **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) pendant un appel à la méthode [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) du message si un client a modifié **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) sans mise à jour de **PR_RTF_IN_SYNC** ou de **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="58e68-110">A non-RTF-aware message store must delete the **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) property during a call to the message's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method if a client has changed **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) without updating either **PR_RTF_IN_SYNC** or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span></span> <span data-ttu-id="58e68-111">La suppression de **PR_RTF_IN_SYNC** entraîne le recalcul de la propriété **PR_RTF_COMPRESSED** à partir de la propriété **PR_BODY** la prochaine fois qu'un client compatible avec le format RTF appelle [RTFSync](rtfsync.md).</span><span class="sxs-lookup"><span data-stu-id="58e68-111">Deleting **PR_RTF_IN_SYNC** causes the **PR_RTF_COMPRESSED** property to be recomputed from the **PR_BODY** property the next time an RTF-aware client calls [RTFSync](rtfsync.md).</span></span> 
  
<span data-ttu-id="58e68-112">La plupart des magasins de messages prenant en charge le format RTF ne reçoivent pas le texte du message par les clients; elle doit être calculée sur demande.</span><span class="sxs-lookup"><span data-stu-id="58e68-112">Most RTF-aware message stores are not given the message text by clients; it must be computed on request.</span></span> <span data-ttu-id="58e68-113">Étant donné que ce calcul est onéreux et coûteux, les clients doivent utiliser **PR_RTF_COMPRESSED** chaque fois que cela est possible.</span><span class="sxs-lookup"><span data-stu-id="58e68-113">Because this computation is time consuming and expensive, clients should use **PR_RTF_COMPRESSED** whenever possible.</span></span> <span data-ttu-id="58e68-114">Pour calculer la propriété **PR_BODY** , le fournisseur de banque de messages doit décompresser le contenu de la propriété **PR_RTF_COMPRESSED** et supprimer la mise en forme de texte enrichi.</span><span class="sxs-lookup"><span data-stu-id="58e68-114">To compute the **PR_BODY** property, the message store provider must uncompress the contents of the **PR_RTF_COMPRESSED** property and remove the rich text formatting.</span></span> <span data-ttu-id="58e68-115">Les clients qui ne prennent pas en charge la propriété **PR_RTF_COMPRESSED** nécessitent que ce calcul ait lieu pour chaque message.</span><span class="sxs-lookup"><span data-stu-id="58e68-115">Clients that do not support the **PR_RTF_COMPRESSED** property require this computation to take place for every message.</span></span> 
  
<span data-ttu-id="58e68-116">Lors de la copie de messages, les fournisseurs de banques de messages qui n'utilisent pas les **IMAPISupport::D ocopyprops** ou **IMAPISupport::D ocopyto** méthodes exécutent le risque de créer un message sans contenu si leur implémentation exclut le **PR_BODY** propriété et s'appuie sur **PR_RTF_COMPRESSED**.</span><span class="sxs-lookup"><span data-stu-id="58e68-116">When copying messages, message store providers that do not use the **IMAPISupport::DoCopyProps** or **IMAPISupport::DoCopyTo** methods run the risk of creating a message with no content if their implementation excludes the **PR_BODY** property and relies on **PR_RTF_COMPRESSED**.</span></span> <span data-ttu-id="58e68-117">Il est possible que les données de la propriété **PR_RTF_COMPRESSED** soient endommagées.</span><span class="sxs-lookup"><span data-stu-id="58e68-117">It is possible for the data in the **PR_RTF_COMPRESSED** property to be corrupt.</span></span> <span data-ttu-id="58e68-118">Avant d'exclure l'une de ces propriétés de contenu de message dans l'opération de copie, vérifiez la corruption comme suit:</span><span class="sxs-lookup"><span data-stu-id="58e68-118">Before excluding either of these message content properties in the copy operation, check for corruption as follows:</span></span> 
  
1. <span data-ttu-id="58e68-119">Si la valeur de **PR_RTF_COMPRESSED** n'est pas supérieure au format RTF compressé, la propriété est endommagée.</span><span class="sxs-lookup"><span data-stu-id="58e68-119">If the value of **PR_RTF_COMPRESSED** is not larger than the compressed RTF, the property is corrupt.</span></span> 
    
2. <span data-ttu-id="58e68-120">Si la valeur Magic de l'en-tête RTF n'est pas _dwMagicCompressedRTF_ ou _dwMagicUncompressedRTF_, la propriété est endommagée.</span><span class="sxs-lookup"><span data-stu-id="58e68-120">If the magic value in the RTF header is not  _dwMagicCompressedRTF_ or  _dwMagicUncompressedRTF_, the property is corrupt.</span></span>
    
<span data-ttu-id="58e68-121">Les fournisseurs de banque de messages utilisant les méthodes de prise en charge n'ont pas besoin d'implémenter une vérification de l'endommagement **PR_RTF_COMPRESSED** ; MAPI garantit que les propriétés appropriées existent et sont valides.</span><span class="sxs-lookup"><span data-stu-id="58e68-121">Message store providers using the support methods need not be concerned with implementing a check for **PR_RTF_COMPRESSED** corruption; MAPI ensures that the appropriate properties exist and are valid.</span></span> 
  
<span data-ttu-id="58e68-122">Il existe trois niveaux de prise en charge du format RTF que les fournisseurs de banques de messages peuvent implémenter; MAPI recommande que les fournisseurs de banques de messages prenant en charge le format RTF implémentent leur prise en charge au niveau le plus élevé ou au milieu.</span><span class="sxs-lookup"><span data-stu-id="58e68-122">There are three different levels of RTF support that message store providers can implement; MAPI recommends that RTF-aware message store providers implement their support at the middle or highest level.</span></span> <span data-ttu-id="58e68-123">Tous les fournisseurs de banques de messages prenant en charge le format RTF sont en charge de la génération de **PR_BODY** à partir des données incluses dans **PR_RTF_COMPRESSED** sur les messages sortants et d'un appel à **RTFSync** pour synchroniser le texte et la mise en forme sur les messages entrants.</span><span class="sxs-lookup"><span data-stu-id="58e68-123">All RTF-aware message store providers take care of generating **PR_BODY** from the data included in **PR_RTF_COMPRESSED** on outgoing messages and make a call to **RTFSync** to synchronize text and formatting on incoming messages.</span></span> 
  
<span data-ttu-id="58e68-124">Les différences entre ces trois niveaux sont décrites dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="58e68-124">The differences between these three levels are described in the following table.</span></span> 
  
|<span data-ttu-id="58e68-125">**Niveau de prise en charge**</span><span class="sxs-lookup"><span data-stu-id="58e68-125">**Level of support**</span></span>|<span data-ttu-id="58e68-126">**Description**</span><span class="sxs-lookup"><span data-stu-id="58e68-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="58e68-127">Faible</span><span class="sxs-lookup"><span data-stu-id="58e68-127">Low</span></span>  <br/> |<span data-ttu-id="58e68-128">Le fournisseur de banque de messages appelle **RTFSync** chaque fois que des modifications sont enregistrées dans un message et extrait les données de la propriété **PR_BODY** à partir de **PR_RTF_COMPRESSED** au lieu de demander aux clients de le définir.</span><span class="sxs-lookup"><span data-stu-id="58e68-128">Message store provider calls **RTFSync** whenever changes are saved to a message and extracts the data for the **PR_BODY** property from **PR_RTF_COMPRESSED** rather than requiring clients to set it.</span></span> <span data-ttu-id="58e68-129">**PR_BODY** et **PR_RTF_COMPRESSED** sont stockés.</span><span class="sxs-lookup"><span data-stu-id="58e68-129">Both **PR_BODY** and **PR_RTF_COMPRESSED** are stored.</span></span>  <br/> |
|<span data-ttu-id="58e68-130">Centre</span><span class="sxs-lookup"><span data-stu-id="58e68-130">Middle</span></span>  <br/> |<span data-ttu-id="58e68-131">Le fournisseur de banque de messages stocke uniquement la propriété **PR_RTF_COMPRESSED** , Computing **PR_BODY** si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="58e68-131">Message store provider stores only the **PR_RTF_COMPRESSED** property, computing **PR_BODY** when necessary.</span></span>  <br/> |
|<span data-ttu-id="58e68-132">Importante</span><span class="sxs-lookup"><span data-stu-id="58e68-132">High</span></span>  <br/> |<span data-ttu-id="58e68-133">Le fournisseur de banque de messages ne stocke ni **PR_BODY** ni les propriétés RTF auxiliaires.</span><span class="sxs-lookup"><span data-stu-id="58e68-133">Message store provider stores neither **PR_BODY** or the auxiliary RTF properties.</span></span> <span data-ttu-id="58e68-134">**RTFSync** est appelé lorsque le texte du message a changé et que la mise en forme reste inchangée ou lorsqu'un nouveau message est téléchargé par un fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="58e68-134">**RTFSync** is called when the message text has changed and the formatting remains unchanged or when a new message is downloaded by a transport provider.</span></span>  <br/> |
   

