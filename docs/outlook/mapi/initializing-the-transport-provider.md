---
title: Initialisation du fournisseur de transport
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 977c18ce-ece5-4ad1-ac97-5a680846ab83
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 474a8085ca8b82d11efd68c9fd4d8719fe239207
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416600"
---
# <a name="initializing-the-transport-provider"></a><span data-ttu-id="d0d1e-103">Initialisation du fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="d0d1e-103">Initializing the Transport Provider</span></span>

  
  
<span data-ttu-id="d0d1e-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="d0d1e-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="d0d1e-105">L’interface de transport-spooler définit les appels que lepooler MAPI effectue à un fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-105">The transport-spooler interface defines calls the MAPI spooler makes to a transport provider.</span></span> <span data-ttu-id="d0d1e-106">Les fournisseurs de transport implémentent ces routines dans une bibliothèque de liens dynamiques (DLL).</span><span class="sxs-lookup"><span data-stu-id="d0d1e-106">Transport providers implement these routines in a dynamic-link library (DLL).</span></span> <span data-ttu-id="d0d1e-107">Le premier point d’entrée direct dans la DLL utilisée par lepooler MAPI doit être la fonction d’initialisation du fournisseur de transport [XPProviderInit](xpproviderinit.md).</span><span class="sxs-lookup"><span data-stu-id="d0d1e-107">The first direct entry point into the DLL used by the MAPI spooler must be the transport provider initialization function [XPProviderInit](xpproviderinit.md).</span></span>
  
<span data-ttu-id="d0d1e-108">MAPI utilise la routine **GetProcAddress** pour obtenir l’adresse de la routine d’initialisation du fournisseur de services, puis appelle cette routine.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-108">MAPI uses the routine **GetProcAddress** to get the address of the service provider's initialization routine and then calls that routine.</span></span> <span data-ttu-id="d0d1e-109">Le nom de la routine d’initialisation est **XPProviderInit** pour les fournisseurs de transport.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-109">The name of the initialization routine is **XPProviderInit** for transport providers.</span></span> <span data-ttu-id="d0d1e-110">Il est différent pour les autres types de fournisseurs de services MAPI afin qu’une DLL puisse contenir n’importe quelle combinaison de types de fournisseurs de services, mais un seul fournisseur de services d’un type particulier.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-110">It is different for other types of MAPI service providers so that one DLL can contain any combination of service provider types, but only one service provider of a particular type.</span></span> <span data-ttu-id="d0d1e-111">Toutefois, un fournisseur de services d’un type donné peut implémenter plusieurs services de ce type.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-111">However, one service provider of a given type can implement multiple services of its type.</span></span> <span data-ttu-id="d0d1e-112">Par exemple, un fournisseur de transport peut implémenter la fonctionnalité de transport de messages à plusieurs services de messagerie.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-112">For example, one transport provider can implement message transport functionality to multiple message services.</span></span> 
  
<span data-ttu-id="d0d1e-113">Le fichier d’en-tête mapispi.h possède une définition de type pour le prototype de fonction de la fonction d’initialisation du fournisseur de transport et un nom de procédure prédéféré pour celui-ci.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-113">The mapispi.h header file has a type definition for the function prototype of the transport provider initialization function, and a predefined procedure name for it.</span></span> <span data-ttu-id="d0d1e-114">En nommant les routines d’initialisation dans vos fichiers C et C++ avec les mêmes noms que **getProcAddress** et en utilisant une déclaration d’exportation simple dans votre fichier DLL.DEF, vous obtenez automatiquement la vérification du type des paramètres de votre routine d’initialisation.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-114">By naming the initialization routines in your C and C++ files with the same names used by **GetProcAddress** and by using a straightforward export declaration in your DLL.DEF file, you automatically get type checking of the parameters on your initialization routine.</span></span> <span data-ttu-id="d0d1e-115">Consultez l’exemple de code source du fournisseur de transport pour obtenir des exemples.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-115">See the sample transport provider source code for examples.</span></span> <span data-ttu-id="d0d1e-116">Pour plus d’informations, [consultez l’exemple de fournisseur de transport.](transport-provider-sample.md)</span><span class="sxs-lookup"><span data-stu-id="d0d1e-116">For more information, see [Transport Provider Sample](transport-provider-sample.md).</span></span>
  
<span data-ttu-id="d0d1e-117">Si l’appel d’initialisation d’un fournisseur de services réussit mais renvoie un numéro de version de l’interface de fournisseur de services trop petit pour que MAPI gère, MAPI appelle immédiatement la méthode **Release** de l’objet fournisseur de services et continue comme si l’appel d’initialisation avait échoué avec MAPI_E_VERSION.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-117">If a service provider's initialization call succeeds but returns a service provider interface version number too small for MAPI to handle, MAPI immediately calls the **Release** method of the service provider object and proceeds as if the initialization call had failed with MAPI_E_VERSION.</span></span> <span data-ttu-id="d0d1e-118">De cette façon, MAPI et le fournisseur de services définissent conjointement la plage de numéros de version de l’interface du fournisseur de services qu’ils peuvent gérer, et si rien ne correspond, le chargement du fournisseur de services échoue avec une valeur MAPI_E_VERSION de retour.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-118">This way MAPI and the service provider jointly define the range of service provider interface version numbers they can handle, and if nothing matches then service provider loading fails with a MAPI_E_VERSION return value.</span></span> 
  
<span data-ttu-id="d0d1e-119">La dernière étape pour lepooler MAPI lors de l’accès aux ressources du fournisseur de services consiste à se connecter au fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-119">The last step for the MAPI spooler in getting access to service provider resources is to log on to the transport provider.</span></span> <span data-ttu-id="d0d1e-120">Lepooler MAPI appelle la méthode [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) de l’objet [IXPProvider : IUnknown](ixpprovideriunknown.md) renvoyé par **XPProviderInit**.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-120">The MAPI spooler calls the [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) method of the [IXPProvider : IUnknown](ixpprovideriunknown.md) object returned from **XPProviderInit**.</span></span> <span data-ttu-id="d0d1e-121">Il s’agit de l’appel dans lequel les informations d’identification, si elles sont utilisées, sont cochées et les boîtes de dialogue peuvent être autorisées.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-121">This is the call where credentials, if used, are checked and dialog boxes can be allowed.</span></span>
  
<span data-ttu-id="d0d1e-122">Si un processus ouvre une deuxième session de transport sur le même fournisseur de transport et la même session MAPI, le fournisseur de transport DLL ne doit pas créer un deuxième objet fournisseur.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-122">If a process opens a second transport session on the same transport provider and MAPI session, the transport provider DLL should not create a second provider object.</span></span> <span data-ttu-id="d0d1e-123">Le premier objet fournisseur doit être utilisé pour se connecter à la deuxième session de transport.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-123">The first provider object should be used to log on to the second transport session.</span></span> <span data-ttu-id="d0d1e-124">Un fournisseur de transport doit être programmé pour prendre en charge plusieurs sessions de transport dans un seul objet fournisseur.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-124">A transport provider should be programmed to support multiple transport sessions in a single provider object.</span></span> <span data-ttu-id="d0d1e-125">Un deuxième objet fournisseur ne doit être créé que si différentes sessions MAPI sont utilisées dans le même processus.</span><span class="sxs-lookup"><span data-stu-id="d0d1e-125">A second provider object should only be created if different MAPI sessions are used in the same process.</span></span>
  

