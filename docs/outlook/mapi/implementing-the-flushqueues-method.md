---
title: Implémentation de la méthode FlushQueues
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8719f8aa-a537-4253-b67d-c4d38c40472b
description: 'Derni�re modification�: lundi 9 mars 2015'
ms.openlocfilehash: 1e5c78c71f7fddb04d3517aca0a34efa151ece08
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32310114"
---
# <a name="implementing-the-flushqueues-method"></a><span data-ttu-id="4b7da-103">Implémentation de la méthode FlushQueues</span><span class="sxs-lookup"><span data-stu-id="4b7da-103">Implementing the FlushQueues Method</span></span>

  
  
<span data-ttu-id="4b7da-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="4b7da-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="4b7da-105">Le spouleur MAPI utilise la méthode [IXPLogon:: FlushQueues](ixplogon-flushqueues.md) pour télécharger et télécharger les messages en attente vers et à partir d'un fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="4b7da-105">The MAPI spooler uses the [IXPLogon::FlushQueues](ixplogon-flushqueues.md) method to download and upload any pending messages to and from a transport provider.</span></span> <span data-ttu-id="4b7da-106">En règle générale, le spouleur MAPI vide les files d'attente de tous les fournisseurs de transport qui sont connectés à la session, en commençant par le premier fournisseur de transport défini dans la section ordre de transport du profil de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4b7da-106">Typically, the MAPI spooler will flush the queues for all transport providers that are logged on to the session, starting with the first transport provider as set in the transport order section of the user's profile.</span></span> <span data-ttu-id="4b7da-107">Le vidage des files d'attente est presque toujours le résultat d'une demande directe de l'utilisateur, de sorte que l'envoi et la réception de messages pendant le vidage des files d'attente sont synchrones pour le spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="4b7da-107">Flushing queues is almost always the result of a direct request by the user, so the sending and receiving of messages while queues are flushing is synchronous to the MAPI spooler.</span></span> <span data-ttu-id="4b7da-108">Étant donné que ces appels sont synchrones, le fournisseur de transport doit les traiter aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="4b7da-108">Because these calls are synchronous, the transport provider should process them as quickly as possible.</span></span> 
  
<span data-ttu-id="4b7da-109">Les fournisseurs de transport doivent gérer l'appel **FlushQueues** comme décrit dans la séquence d'étapes suivante pour activer le traitement des messages correct et permettre à d'autres fournisseurs de transport d'utiliser des ressources externes telles que des modems dans le cadre du SPOULEur MAPI. Opération **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="4b7da-109">Transport providers must handle the **FlushQueues** call as described in the following sequence of steps to enable proper message processing and to enable external resources such as modems to be used by other transport providers as part of the MAPI spooler's **FlushQueues** operation.</span></span> 
  
|<span data-ttu-id="4b7da-110">**Étape**</span><span class="sxs-lookup"><span data-stu-id="4b7da-110">**Step**</span></span>|<span data-ttu-id="4b7da-111">**Composant**</span><span class="sxs-lookup"><span data-stu-id="4b7da-111">**Component**</span></span>|<span data-ttu-id="4b7da-112">**Mise en œuvre**</span><span class="sxs-lookup"><span data-stu-id="4b7da-112">**Implementation**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="4b7da-113">1.</span><span class="sxs-lookup"><span data-stu-id="4b7da-113">1.</span></span>  <br/> |<span data-ttu-id="4b7da-114">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-114">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-115">Appelle la méthode **FlushQueues** pour le premier fournisseur de transport figurant dans l'ordre de transport du profil de l'utilisateur, en transmettant les indicateurs demandés dans le paramètre _ulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="4b7da-115">Calls the **FlushQueues** method for the first transport provider listed in the transport order of the user's profile, passing the requested flags in the  _ulFlags_ parameter.</span></span> <span data-ttu-id="4b7da-116">**FlushQueues** est appelé une seule fois avec tous les indicateurs définis pour l'intégralité de l'opération de téléchargement et de téléchargement.</span><span class="sxs-lookup"><span data-stu-id="4b7da-116">**FlushQueues** is called once with all flags set for the entire upload and download operation.</span></span>  <br/> |
|<span data-ttu-id="4b7da-117">2.</span><span class="sxs-lookup"><span data-stu-id="4b7da-117">2.</span></span>  <br/> |<span data-ttu-id="4b7da-118">Fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-118">Transport Provider</span></span>  <br/> |<span data-ttu-id="4b7da-119">Doit effectuer un certain nombre d'opérations avant le renvoi de l'appel **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="4b7da-119">Needs to do a number of things before returning from the **FlushQueues** call.</span></span> <span data-ttu-id="4b7da-120">Si les messages soumis précédemment sont différés, la méthode [IMAPISupport:: SpoolerNotify](imapisupport-spoolernotify.md) doit être appelée avec l'indicateur NOTIFY_SENT_DEFERRED défini.</span><span class="sxs-lookup"><span data-stu-id="4b7da-120">If previously submitted messages are being deferred, the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method should be called with the NOTIFY_SENT_DEFERRED flag set.</span></span> <span data-ttu-id="4b7da-121">Notez que le spouleur MAPI peut annuler un message qui a été différé avant que le fournisseur de transport ait pu terminer le traitement du message.</span><span class="sxs-lookup"><span data-stu-id="4b7da-121">Note that it is possible for the MAPI spooler to cancel a message that has been deferred before the transport provider has a chance to finish processing the message.</span></span>  <br/> <span data-ttu-id="4b7da-122">Si le fournisseur de transport utilise une ressource externe telle qu'un modem, la connexion à la ressource externe doit être établie.</span><span class="sxs-lookup"><span data-stu-id="4b7da-122">If the transport provider uses an external resource such as a modem, the connection to the external resource should be established.</span></span>  <br/> <span data-ttu-id="4b7da-123">Le bit STATUS_OUTBOUND_FLUSH de la propriété **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) de la ligne d'État du fournisseur de transport doit être défini à l'aide de la méthode [IMAPISupport:: ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="4b7da-123">The STATUS_OUTBOUND_FLUSH bit in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of the transport provider's status row must be set using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span>  <br/> <span data-ttu-id="4b7da-124">Le fournisseur de transport doit ensuite renvoyer S_OK pour l'appel **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="4b7da-124">The transport provider should then return S_OK for the **FlushQueues** call.</span></span>  <br/> |
|<span data-ttu-id="4b7da-125">3.</span><span class="sxs-lookup"><span data-stu-id="4b7da-125">3.</span></span>  <br/> |<span data-ttu-id="4b7da-126">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-126">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-127">Vérifie la ligne d'État du fournisseur de transport pour le bit STATUS_OUTBOUND_FLUSH et appelle [IXPLogon:: SubmitMessage](ixplogon-submitmessage.md) pour le premier message de la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="4b7da-127">Checks the transport provider's status row for the STATUS_OUTBOUND_FLUSH bit and calls [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) for the first message in the queue.</span></span>  <br/> |
|<span data-ttu-id="4b7da-128">4.</span><span class="sxs-lookup"><span data-stu-id="4b7da-128">4.</span></span>  <br/> |<span data-ttu-id="4b7da-129">Fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-129">Transport provider</span></span>  <br/> |<span data-ttu-id="4b7da-130">Gère le message et renvoie à partir de l'appel **SubmitMessage** .</span><span class="sxs-lookup"><span data-stu-id="4b7da-130">Handles the message and returns from the **SubmitMessage** call.</span></span>  <br/> |
|<span data-ttu-id="4b7da-131">5.</span><span class="sxs-lookup"><span data-stu-id="4b7da-131">5.</span></span>  <br/> |<span data-ttu-id="4b7da-132">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-132">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-133">Si le fournisseur de transport renvoie S_OK depuis **SubmitMessage**, le spouleur MAPI appelle [IXPLogon:: EndMessage](ixplogon-endmessage.md) pour le message comme il le fait avec l'envoi de messages classiques.</span><span class="sxs-lookup"><span data-stu-id="4b7da-133">If the transport provider returns S_OK from **SubmitMessage**, the MAPI spooler calls [IXPLogon::EndMessage](ixplogon-endmessage.md) for the message as it does with regular message sending.</span></span>  <br/> <span data-ttu-id="4b7da-134">Si le fournisseur de transport renvoie une valeur autre que S_OK à partir de **SubmitMessage**, le spouleur MAPI gère la valeur de manière appropriée avant d'appeler **EndMessage**ou avant d'appeler de nouveau **SubmitMessage** .</span><span class="sxs-lookup"><span data-stu-id="4b7da-134">If the transport provider returns a value other than S_OK from **SubmitMessage**, the MAPI spooler handles the value appropriately before calling **EndMessage**, or before calling **SubmitMessage** again.</span></span>  <br/> |
|<span data-ttu-id="4b7da-135">6.</span><span class="sxs-lookup"><span data-stu-id="4b7da-135">6.</span></span>  <br/> |<span data-ttu-id="4b7da-136">Fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-136">Transport provider</span></span>  <br/> |<span data-ttu-id="4b7da-137">Renvoie de **EndMessage** avec son état de traitement de message dans le paramètre _lpulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="4b7da-137">Returns from **EndMessage** with its message processing status in the  _lpulFlags_ parameter.</span></span>  <br/> |
|<span data-ttu-id="4b7da-138">7.</span><span class="sxs-lookup"><span data-stu-id="4b7da-138">7.</span></span>  <br/> |<span data-ttu-id="4b7da-139">Spouleur MAPI et fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-139">MAPI spooler and transport provider</span></span>  <br/> |<span data-ttu-id="4b7da-140">La boucle **SubmitMessage**- **EndMessage** continue jusqu'à ce que tous les messages de la file d'attente aient été téléchargés.</span><span class="sxs-lookup"><span data-stu-id="4b7da-140">The **SubmitMessage**- **EndMessage** loop continues until all messages in the queue have been downloaded.</span></span>  <br/> |
|<span data-ttu-id="4b7da-141">8.</span><span class="sxs-lookup"><span data-stu-id="4b7da-141">8.</span></span>  <br/> |<span data-ttu-id="4b7da-142">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-142">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-143">Avertit le fournisseur de transport qu'il a terminé de télécharger les messages en appelant la méthode [IXPLogon:: TransportNotify](ixplogon-transportnotify.md) du fournisseur de transport avec l'indicateur NOTIFY_END_OUTBOUND_FLUSH défini.</span><span class="sxs-lookup"><span data-stu-id="4b7da-143">Notifies the transport provider that it has finished downloading messages by calling the transport provider's [IXPLogon::TransportNotify](ixplogon-transportnotify.md) method with the NOTIFY_END_OUTBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="4b7da-144">9.</span><span class="sxs-lookup"><span data-stu-id="4b7da-144">9.</span></span>  <br/> |<span data-ttu-id="4b7da-145">Fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-145">Transport provider</span></span>  <br/> |<span data-ttu-id="4b7da-146">Libère toutes les ressources externes utilisées lors de l'envoi de messages sortants afin qu'ils puissent être utilisés par d'autres fournisseurs de transport pour vider leurs files d'attente.</span><span class="sxs-lookup"><span data-stu-id="4b7da-146">Frees any external resources used in sending outbound messages so they can be used by other transport providers to flush their queues.</span></span>  <br/> <span data-ttu-id="4b7da-147">Le bit STATUS_INBOUND_FLUSH de la propriété **PR_STATUS_CODE** de la ligne d'État du fournisseur de transport doit être défini à l'aide de **ModifyStatusRow**.</span><span class="sxs-lookup"><span data-stu-id="4b7da-147">The STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of the transport provider's status row must be set using **ModifyStatusRow**.</span></span>  <br/> |
|<span data-ttu-id="4b7da-148">10.</span><span class="sxs-lookup"><span data-stu-id="4b7da-148">10.</span></span>  <br/> |<span data-ttu-id="4b7da-149">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-149">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-150">Vérifie la ligne d'État du fournisseur de transport pour le bit STATUS_INBOUND_FLUSH et appelle [IXPLogon:: StartMessage](ixplogon-startmessage.md) s'il est défini.</span><span class="sxs-lookup"><span data-stu-id="4b7da-150">Checks the transport provider's status row for the STATUS_INBOUND_FLUSH bit and calls [IXPLogon::StartMessage](ixplogon-startmessage.md) if it is set.</span></span>  <br/> |
|<span data-ttu-id="4b7da-151">11.</span><span class="sxs-lookup"><span data-stu-id="4b7da-151">11.</span></span>  <br/> |<span data-ttu-id="4b7da-152">Fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-152">Transport provider</span></span>  <br/> |<span data-ttu-id="4b7da-153">Traite le message et renvoie à partir de **StartMessage**.</span><span class="sxs-lookup"><span data-stu-id="4b7da-153">Processes the message and returns from **StartMessage**.</span></span> <span data-ttu-id="4b7da-154">Si le fournisseur de transport a d'autres messages à charger, il doit appeler **SpoolerNotify** avec l'indicateur NOTIFY_NEWMAIL défini.</span><span class="sxs-lookup"><span data-stu-id="4b7da-154">If the transport provider has other messages to upload, it should call **SpoolerNotify** with the NOTIFY_NEWMAIL flag set.</span></span>  <br/> <span data-ttu-id="4b7da-155">Si le fournisseur de transport n'a aucun message à charger, il doit appeler [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) sur le message le spouleur MAPI transmis dans **StartMessage** et Return.</span><span class="sxs-lookup"><span data-stu-id="4b7da-155">If the transport provider has no messages to upload, it should call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message the MAPI spooler passed in **StartMessage** and return.</span></span>  <br/> |
|<span data-ttu-id="4b7da-156">an.</span><span class="sxs-lookup"><span data-stu-id="4b7da-156">12.</span></span>  <br/> |<span data-ttu-id="4b7da-157">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-157">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-158">Continue d'appeler **StartMessage** jusqu'à ce que **SaveChanges** soit appelé sur un message.</span><span class="sxs-lookup"><span data-stu-id="4b7da-158">Continues calling **StartMessage** until **SaveChanges** is called on a message.</span></span> <span data-ttu-id="4b7da-159">Une fois le téléchargement du fournisseur de transport terminé, le spouleur MAPI appelle **TransportNotify** avec l'indicateur NOTIFY_END_INBOUND_FLUSH défini.</span><span class="sxs-lookup"><span data-stu-id="4b7da-159">After the transport provider has finished uploading, the MAPI spooler calls **TransportNotify** with the NOTIFY_END_INBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="4b7da-160">kg.</span><span class="sxs-lookup"><span data-stu-id="4b7da-160">13.</span></span>  <br/> |<span data-ttu-id="4b7da-161">Fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="4b7da-161">Transport provider</span></span>  <br/> |<span data-ttu-id="4b7da-162">Efface le bit STATUS_INBOUND_FLUSH de la propriété **PR_STATUS_CODE** de sa ligne d'État à l'aide de **ModifyStatusRow** et libère toutes les ressources externes de sorte qu'elles soient utilisables par d'autres fournisseurs de transport.</span><span class="sxs-lookup"><span data-stu-id="4b7da-162">Clears the STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of its status row using **ModifyStatusRow** and releases all external resources so they are available for use by other transport providers.</span></span>  <br/> |
|<span data-ttu-id="4b7da-163">13.</span><span class="sxs-lookup"><span data-stu-id="4b7da-163">14.</span></span>  <br/> |<span data-ttu-id="4b7da-164">Spouleur MAPI</span><span class="sxs-lookup"><span data-stu-id="4b7da-164">MAPI spooler</span></span>  <br/> |<span data-ttu-id="4b7da-165">Appelle **FlushQueues** pour le fournisseur de transport suivant indiqué dans l'ordre de transport du profil de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4b7da-165">Calls **FlushQueues** for the next transport provider listed in the transport order of the user's profile.</span></span>  <br/> |
   
<span data-ttu-id="4b7da-166">Si une application cliente appelle [IMAPIStatus:: FlushQueues](imapistatus-flushqueues.md) sur l'objet d'état d'un fournisseur de transport, le fournisseur de transport doit définir le bit approprié dans sa ligne d'État avec **ModifyStatusRow**.</span><span class="sxs-lookup"><span data-stu-id="4b7da-166">If a client application calls [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) on a transport provider's status object, the transport provider should set the appropriate bit in its status row with **ModifyStatusRow**.</span></span> <span data-ttu-id="4b7da-167">Le spouleur MAPI appelle ensuite la méthode **IXPLogon:: FlushQueues** du fournisseur de transport au niveau de la commodité du spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="4b7da-167">The MAPI spooler then calls the transport provider's **IXPLogon::FlushQueues** method at the MAPI spooler's convenience.</span></span> <span data-ttu-id="4b7da-168">Lorsque la méthode **IXPLogon:: FlushQueues** du fournisseur de transport est appelée à la suite de l'appel de **IMAPIStatus:: FlushQueues** de l'application cliente, l'opération a lieu de manière asynchrone à l'application cliente.</span><span class="sxs-lookup"><span data-stu-id="4b7da-168">When the transport provider's **IXPLogon::FlushQueues** method is called as a result of a client application's **IMAPIStatus::FlushQueues** call, the operation occurs asynchronously to the client application.</span></span> <span data-ttu-id="4b7da-169">Sinon, **IXPLogon:: FlushQueues** fonctionne de façon synchrone avec le spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="4b7da-169">Otherwise **IXPLogon::FlushQueues** works synchronously with the MAPI spooler.</span></span> 
  
<span data-ttu-id="4b7da-170">Pour des raisons de performances, le spouleur MAPI appelle uniquement la méthode **FlushQueues** d'un fournisseur de transport si les indicateurs STATUS_INBOUND_FLUSH et STATUS_OUTBOUND_FLUSH sont définis dans la ligne d'État du fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="4b7da-170">For performance reasons, the MAPI spooler will only call a transport provider's **FlushQueues** method if the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH flags are set in the transport provider's status row.</span></span> <span data-ttu-id="4b7da-171">Par conséquent, un fournisseur de transport peut arrêter l'opération **FlushQueues** à tout moment en effaçant les indicateurs STATUS_OUTBOUND_FLUSH et STATUS_INBOUND_FLUSH dans sa ligne d'État.</span><span class="sxs-lookup"><span data-stu-id="4b7da-171">Consequently, a transport provider can stop the **FlushQueues** operation at any time by clearing the STATUS_OUTBOUND_FLUSH and STATUS_INBOUND_FLUSH flags in its status row.</span></span> <span data-ttu-id="4b7da-172">Si le spouleur MAPI est arrêté et doit mettre fin à l'opération **FlushQueues** , il appelle **TransportNotify** avec les indicateurs NOTIFY_END_INBOUND_FLUSH et NOTIFY_END_OUTBOUND_FLUSH définis.</span><span class="sxs-lookup"><span data-stu-id="4b7da-172">If the MAPI spooler is shutting down and needs to end the **FlushQueues** operation, it calls **TransportNotify** with both the NOTIFY_END_INBOUND_FLUSH and NOTIFY_END_OUTBOUND_FLUSH flags set.</span></span> <span data-ttu-id="4b7da-173">Le fournisseur de transport doit libérer toutes les ressources externes et renvoyer.</span><span class="sxs-lookup"><span data-stu-id="4b7da-173">The transport provider should release all external resources and return.</span></span> 
  

