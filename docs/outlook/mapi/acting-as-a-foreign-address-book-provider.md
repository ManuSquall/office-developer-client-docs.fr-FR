---
title: Rôle du fournisseur de carnets d’adresses étranger
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 300681bd585e9d534113404a82f43565f4e79bb4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435739"
---
# <a name="acting-as-a-foreign-address-book-provider"></a><span data-ttu-id="5c36d-103">Rôle du fournisseur de carnets d’adresses étranger</span><span class="sxs-lookup"><span data-stu-id="5c36d-103">Acting as a foreign address book provider</span></span>

<span data-ttu-id="5c36d-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="5c36d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="5c36d-105">Un fournisseur étranger est un fournisseur de carnets d'adresses qui:</span><span class="sxs-lookup"><span data-stu-id="5c36d-105">A foreign provider is an address book provider that:</span></span> 
  
- <span data-ttu-id="5c36d-106">Affecte des identificateurs de modèle à ses destinataires.</span><span class="sxs-lookup"><span data-stu-id="5c36d-106">Assigns template identifiers for its recipients.</span></span>
    
- <span data-ttu-id="5c36d-107">Prend en charge la méthode [IABLogon:: OpenTemplateID](iablogon-opentemplateid.md) .</span><span class="sxs-lookup"><span data-stu-id="5c36d-107">Supports the [IABLogon::OpenTemplateID](iablogon-opentemplateid.md) method.</span></span> 
    
- <span data-ttu-id="5c36d-108">Fournit du code pour la gestion des destinataires qui existent dans les conteneurs d'autres fournisseurs de carnet d'adresses appelés fournisseurs d'hôte.</span><span class="sxs-lookup"><span data-stu-id="5c36d-108">Supplies code for maintaining recipients that exist in the containers of other address book providers known as host providers.</span></span> <span data-ttu-id="5c36d-109">Ce code implique un objet Property, généralement une implémentation d'interface **IMAPIProp** , qui enveloppe un objet Property à partir du fournisseur hôte.</span><span class="sxs-lookup"><span data-stu-id="5c36d-109">This code involves a property object, typically an **IMAPIProp** interface implementation, which wraps a property object from the host provider.</span></span> 
    
<span data-ttu-id="5c36d-110">Agir en tant que fournisseur étranger est un rôle facultatif; tous les fournisseurs n'ont pas besoin de prendre en charge les identificateurs de modèle et leur code associé.</span><span class="sxs-lookup"><span data-stu-id="5c36d-110">Acting as a foreign provider is an optional role; not all providers need to support template identifiers and their related code.</span></span> <span data-ttu-id="5c36d-111">Implémentez votre fournisseur en tant que fournisseur étranger si vous souhaitez maintenir le contrôle des destinataires que les fournisseurs hôtes créent à l'aide de modèles fournis par votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="5c36d-111">Implement your provider as a foreign provider if you want to maintain control over recipients that host providers create using templates supplied by your provider.</span></span> 
  
<span data-ttu-id="5c36d-112">Le format que votre fournisseur utilise pour ses identificateurs d'entrée peut également être utilisé pour ses identificateurs de modèle.</span><span class="sxs-lookup"><span data-stu-id="5c36d-112">The format that your provider uses for its entry identifiers can also be used for its template identifiers.</span></span> <span data-ttu-id="5c36d-113">Les identificateurs de modèle doivent inclure le **MAPIUID** enregistré de votre fournisseur pour permettre à MAPI de lier correctement les destinataires aux fournisseurs appropriés.</span><span class="sxs-lookup"><span data-stu-id="5c36d-113">Template identifiers must include your provider's registered **MAPIUID** to enable MAPI to successfully bind recipients to the appropriate providers.</span></span> 
  
<span data-ttu-id="5c36d-114">MAPI appelle la méthode **IABLogon:: OpenTemplateID** de votre fournisseur lorsqu'un fournisseur d'hôte appelle [IMAPISupport:: OpenTemplateID](imapisupport-opentemplateid.md).</span><span class="sxs-lookup"><span data-stu-id="5c36d-114">MAPI calls your provider's **IABLogon::OpenTemplateID** method when a host provider calls [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md).</span></span> <span data-ttu-id="5c36d-115">Le fournisseur hôte transmet l'identificateur de modèle du destinataire dans le paramètre _lpTemplateID_ dans son appel à **IMAPISupport:: OpenTemplateID**.</span><span class="sxs-lookup"><span data-stu-id="5c36d-115">The host provider passes the template identifier of the recipient in the  _lpTemplateID_ parameter in its call to **IMAPISupport::OpenTemplateID**.</span></span> <span data-ttu-id="5c36d-116">MAPI détermine que l'identificateur de modèle appartient à votre fournisseur en comparant le [MAPIUID](mapiuid.md) dans l'identificateur de modèle avec le **MAPIUID** que votre fournisseur a enregistré lors de l'ouverture de session.</span><span class="sxs-lookup"><span data-stu-id="5c36d-116">MAPI determines that the template identifier belongs to your provider by matching the [MAPIUID](mapiuid.md) in the template identifier with the **MAPIUID** that your provider registered at logon time.</span></span> <span data-ttu-id="5c36d-117">MAPI transfère ensuite l'appel du fournisseur de l'hôte à votre fournisseur via la méthode **IABLogon:: OpenTemplateID** .</span><span class="sxs-lookup"><span data-stu-id="5c36d-117">MAPI then forwards the host provider's call to your provider through the **IABLogon::OpenTemplateID** method.</span></span> 
  
<span data-ttu-id="5c36d-118">Le fournisseur hôte transmet également un pointeur à son implémentation d'objet de propriété pour le destinataire dans le paramètre _lpMAPIPropData_ , un identificateur d'interface dans le paramètre _lpInterface_ qui correspond au type d'implémentation de l'interface transmis dans _lpMAPIPropData_et un indicateur facultatif, FILL_ENTRY.</span><span class="sxs-lookup"><span data-stu-id="5c36d-118">The host provider also passes a pointer to its property object implementation for the recipient in the  _lpMAPIPropData_ parameter, an interface identifier in the  _lpInterface_ parameter that corresponds to the type of interface implementation passed in  _lpMAPIPropData_, and an optional flag, FILL_ENTRY.</span></span> <span data-ttu-id="5c36d-119">Votre fournisseur est supposé renvoyer dans le paramètre _lppMAPIPropNew_ pointeur vers une implémentation d'objet de propriété du type spécifié dans _lpInterface_.</span><span class="sxs-lookup"><span data-stu-id="5c36d-119">Your provider is expected to return in the  _lppMAPIPropNew_ parameter a pointer to a property object implementation of the type specified in  _lpInterface_.</span></span> <span data-ttu-id="5c36d-120">Le pointeur renvoyé peut être soit à l'objet de propriété encapsulé implémenté par votre fournisseur, soit à l'objet fourni par le fournisseur hôte dans _lpMAPIPropData_.</span><span class="sxs-lookup"><span data-stu-id="5c36d-120">The returned pointer can either be to the wrapped property object implemented by your provider or to the object supplied by the host provider in  _lpMAPIPropData_.</span></span> <span data-ttu-id="5c36d-121">Votre fournisseur doit renvoyer un pointeur d'objet de propriété encapsulée lorsque:</span><span class="sxs-lookup"><span data-stu-id="5c36d-121">Your provider should return a wrapped property object pointer when:</span></span>
  
- <span data-ttu-id="5c36d-122">La table d'affichage du destinataire contient des contrôles de zone de liste.</span><span class="sxs-lookup"><span data-stu-id="5c36d-122">The recipient's display table contains list box controls.</span></span>
    
- <span data-ttu-id="5c36d-123">L'adresse de messagerie du destinataire doit être Assemblée à partir de données dans plusieurs contrôles de table d'affichage.</span><span class="sxs-lookup"><span data-stu-id="5c36d-123">The email address for the recipient must be assembled from data in multiple display table controls.</span></span>
    
- <span data-ttu-id="5c36d-124">Votre fournisseur émet des notifications de table d'affichage.</span><span class="sxs-lookup"><span data-stu-id="5c36d-124">Your provider issues display table notifications.</span></span>
    
<span data-ttu-id="5c36d-125">L'indicateur FILL_ENTRY indique à votre fournisseur que le fournisseur d'hôte requiert que toutes les propriétés du destinataire soient mises à jour.</span><span class="sxs-lookup"><span data-stu-id="5c36d-125">The FILL_ENTRY flag indicates to your provider that the host provider requires all the properties of the recipient to be updated.</span></span> <span data-ttu-id="5c36d-126">Votre fournisseur est nécessaire pour répondre à cette demande.</span><span class="sxs-lookup"><span data-stu-id="5c36d-126">Your provider is required to fulfill this request.</span></span>
  
<span data-ttu-id="5c36d-127">Lorsqu'un fournisseur hôte appelle la méthode **OpenTemplateID** de votre fournisseur, votre fournisseur peut:</span><span class="sxs-lookup"><span data-stu-id="5c36d-127">When a host provider calls your provider's **OpenTemplateID** method, your provider might:</span></span> 
  
- <span data-ttu-id="5c36d-128">Mettre à jour régulièrement les données d'une entrée copiée.</span><span class="sxs-lookup"><span data-stu-id="5c36d-128">Periodically update the data for a copied entry.</span></span>
    
- <span data-ttu-id="5c36d-129">Conserver une entrée copiée synchronisée avec son original, par exemple lorsqu'une entrée de carnet d'adresses est copiée dans le carnet d'adresses personnel.</span><span class="sxs-lookup"><span data-stu-id="5c36d-129">Keep a copied entry synchronized with its original, such as when an address book entry is copied to the personal address book.</span></span>
    
- <span data-ttu-id="5c36d-130">Implémenter des fonctionnalités qui ne peuvent pas être implémentées par le fournisseur hôte, telles que le remplissage dynamique de zones de liste dans la table des détails de l'entrée copiée à partir de données sur un serveur.</span><span class="sxs-lookup"><span data-stu-id="5c36d-130">Implement functionality that cannot be implemented by the host provider, such as dynamically populating list boxes in the copied entry's details table from data on a server.</span></span>
    
- <span data-ttu-id="5c36d-131">Contrôler l'interaction entre les propriétés d'une entrée copiée ou d'un modèle instancié.</span><span class="sxs-lookup"><span data-stu-id="5c36d-131">Control the interaction among properties in a copied entry or instantiated template.</span></span> <span data-ttu-id="5c36d-132">Par exemple, calcul de **PR_EMAIL_ADDRESS** à partir d'autres propriétés affichées dans le tableau des détails.</span><span class="sxs-lookup"><span data-stu-id="5c36d-132">For example, computing **PR_EMAIL_ADDRESS** from other properties displayed in the details table.</span></span> 
    
<span data-ttu-id="5c36d-133">Les deux premiers éléments sont des exemples de tâches qui ne nécessitent pas que votre fournisseur fournisse un objet de propriété incluse, une implémentation de **IMAPIProp** basée sur l'implémentation du fournisseur de l'hôte.</span><span class="sxs-lookup"><span data-stu-id="5c36d-133">The first two items are examples of tasks that do not require your provider to supply a wrapped property object — an implementation of **IMAPIProp** that is based on the host provider's implementation.</span></span> <span data-ttu-id="5c36d-134">Votre fournisseur peut simplement mettre à jour les propriétés, le cas échéant, en définissant le paramètre _lppMAPIPropNew_ de sorte qu'il pointe vers le pointeur transmis par le fournisseur hôte dans le paramètre _lpMAPIPropData_ .</span><span class="sxs-lookup"><span data-stu-id="5c36d-134">Your provider can simply update the properties as necessary and return, setting the  _lppMAPIPropNew_ parameter to point to the pointer passed in by the host provider in the  _lpMAPIPropData_ parameter.</span></span> 
  
<span data-ttu-id="5c36d-135">Les deux tâches suivantes requièrent que votre fournisseur retourne au fournisseur hôte un objet Property qui encapsule l'objet du fournisseur d'hôte avec des fonctionnalités supplémentaires, telles que la possibilité d'afficher une feuille de propriétés pour l'entrée.</span><span class="sxs-lookup"><span data-stu-id="5c36d-135">The second two tasks require that your provider return to the host provider a property object that wraps the host provider's object with additional functionality, such as the ability to display a property sheet for the entry.</span></span> <span data-ttu-id="5c36d-136">Cet objet Property sera un utilisateur de messagerie ou une liste de distribution, selon le type d'objet transmis par le fournisseur d'hôte dans le paramètre _lpMAPIPropData_ et indiqué par l'identificateur d'interface dans le paramètre _lpInterface_ .</span><span class="sxs-lookup"><span data-stu-id="5c36d-136">This property object will either be a messaging user or distribution list, depending on the type of object passed in by the host provider in the  _lpMAPIPropData_ parameter and indicated by the interface identifier in the  _lpInterface_ parameter.</span></span> <span data-ttu-id="5c36d-137">Si le paramètre _lpMAPIPropData_ pointe vers un utilisateur de messagerie, l'objet de propriété encapsulé de votre fournisseur doit être une implémentation **IMailUser** .</span><span class="sxs-lookup"><span data-stu-id="5c36d-137">If the  _lpMAPIPropData_ parameter points to a messaging user, your provider's wrapped property object must be an **IMailUser** implementation.</span></span> <span data-ttu-id="5c36d-138">Si _lpMAPIPropData_ pointe vers une liste de distribution, il doit s'agir d'une implémentation **IDistList** .</span><span class="sxs-lookup"><span data-stu-id="5c36d-138">If  _lpMAPIPropData_ points to a distribution list, it must be an **IDistList** implementation.</span></span> 
  
<span data-ttu-id="5c36d-139">L'objet de propriété encapsulé de votre fournisseur intercepte les appels de la méthode **IMAPIProp** pour effectuer une manipulation spécifique du contexte du destinataire du fournisseur d'hôte, c'est-à-dire l'objet qu'il encapsule.</span><span class="sxs-lookup"><span data-stu-id="5c36d-139">Your provider's wrapped property object intercepts **IMAPIProp** method calls to perform context-specific manipulation of the host provider's recipient—the object it is wrapping.</span></span> <span data-ttu-id="5c36d-140">MAPI n'a qu'une seule condition requise pour les objets de propriété encapsulés: tous les appels à [IMAPIProp:: OpenProperty](imapiprop-openproperty.md) la demande de la propriété **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) doit être transmise au fournisseur d'hôte.</span><span class="sxs-lookup"><span data-stu-id="5c36d-140">MAPI only has one requirement for wrapped property objects: all calls to [IMAPIProp::OpenProperty](imapiprop-openproperty.md) requesting the **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) property should be passed to the host provider.</span></span> <span data-ttu-id="5c36d-141">L'implémentation de votre fournisseur peut utiliser la table renvoyée pour intercepter les notifications d'affichage de table ou ajouter ses propres notifications.</span><span class="sxs-lookup"><span data-stu-id="5c36d-141">Your provider's implementation can use the returned table to intercept display table notifications or to add its own if necessary.</span></span> 
  
<span data-ttu-id="5c36d-142">La liste suivante inclut les tâches généralement implémentées dans l'objet de propriété encapsulé implémenté par des fournisseurs étrangers:</span><span class="sxs-lookup"><span data-stu-id="5c36d-142">The following list includes tasks that are typically implemented in the wrapped property object implemented by foreign providers:</span></span>
  
- <span data-ttu-id="5c36d-143">Valeurs des propriétés de prétraitement et de post-traitement pour le destinataire hôte dans [IMAPIProp:: GetProps](imapiprop-getprops.md).</span><span class="sxs-lookup"><span data-stu-id="5c36d-143">Preprocessing and postprocessing property values for the host recipient in [IMAPIProp::GetProps](imapiprop-getprops.md).</span></span>
    
- <span data-ttu-id="5c36d-144">Gestion des détails des contrôles d'affichage de tableau, tels que les boutons et les zones de liste, dans **IMAPIProp:: OpenProperty**.</span><span class="sxs-lookup"><span data-stu-id="5c36d-144">Handling details display table controls, such as buttons and list boxes, in **IMAPIProp::OpenProperty**.</span></span>
    
- <span data-ttu-id="5c36d-145">Validation ou manipulation des valeurs de propriété pour le destinataire hôte dans [IMAPIProp:: SetProps](imapiprop-setprops.md).</span><span class="sxs-lookup"><span data-stu-id="5c36d-145">Validating or manipulating property values for the host recipient in [IMAPIProp::SetProps](imapiprop-setprops.md).</span></span>
    
- <span data-ttu-id="5c36d-146">Calculer les propriétés requises telles que **PR_EMAIL_ADDRESS** et vérifier que toutes les propriétés nécessaires ont été définies avant d'enregistrer le destinataire de l'hôte dans [IMAPIProp:: SaveChanges](imapiprop-savechanges.md).</span><span class="sxs-lookup"><span data-stu-id="5c36d-146">Computing required properties such as **PR_EMAIL_ADDRESS** and verifying that all of the necessary properties have been set before saving the host recipient in [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span>
    
### <a name="to-implement-iablogonopentemplateid"></a><span data-ttu-id="5c36d-147">Pour implémenter IABLogon:: OpenTemplateID</span><span class="sxs-lookup"><span data-stu-id="5c36d-147">To implement IABLogon::OpenTemplateID</span></span>
  
1. <span data-ttu-id="5c36d-148">Vérifiez si l'identificateur de modèle passé avec le paramètre _lpTemplateID_ est valide et s'il est dans un format reconnu par votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="5c36d-148">Check if the template identifier passed in with the  _lpTemplateID_ parameter is valid and is in a format that your provider recognizes.</span></span> <span data-ttu-id="5c36d-149">Si ce n'est pas le cas, échec et renvoyer MAPI_E_INVALID_ENTRYID.</span><span class="sxs-lookup"><span data-stu-id="5c36d-149">If it is not, fail and return MAPI_E_INVALID_ENTRYID.</span></span> 
    
2. <span data-ttu-id="5c36d-150">Créez un objet du type indiqué par l'identificateur de modèle, un utilisateur de messagerie, une liste de distribution ou un destinataire isolé.</span><span class="sxs-lookup"><span data-stu-id="5c36d-150">Create an object of the type indicated by the template identifier, either a messaging user, distribution list, or one-off recipient.</span></span> 
    
3. <span data-ttu-id="5c36d-151">Appelez la méthode **IUnknown:: AddRef** dans l'objet Property du fournisseur hôte, qui est l'objet désigné par le paramètre _lpMAPIPropData_ .</span><span class="sxs-lookup"><span data-stu-id="5c36d-151">Call the **IUnknown::AddRef** method in the host provider's property object, which is the object pointed to by the  _lpMAPIPropData_ parameter.</span></span> 
    
4. <span data-ttu-id="5c36d-152">Si le paramètre _ulTemplateFlags_ est défini sur FILL_ENTRY:</span><span class="sxs-lookup"><span data-stu-id="5c36d-152">If the  _ulTemplateFlags_ parameter is set to FILL_ENTRY:</span></span> 
    
   1. <span data-ttu-id="5c36d-153">Si le nouvel objet est un utilisateur de messagerie ou une liste de distribution:</span><span class="sxs-lookup"><span data-stu-id="5c36d-153">If the new object is a messaging user or distribution list:</span></span>
      
      1. <span data-ttu-id="5c36d-154">Récupérez toutes les propriétés du nouvel objet, éventuellement en appelant sa méthode **IMAPIProp:: GetProps** .</span><span class="sxs-lookup"><span data-stu-id="5c36d-154">Retrieve all of the properties of the new object, possibly by calling its **IMAPIProp::GetProps** method.</span></span> 
          
      2. <span data-ttu-id="5c36d-155">Appelez la méthode **IMAPIProp:: SetProps** du fournisseur hôte pour copier toutes les propriétés récupérées dans l'objet Property du fournisseur hôte.</span><span class="sxs-lookup"><span data-stu-id="5c36d-155">Call the host provider's **IMAPIProp::SetProps** method to copy all of the retrieved properties to the host provider's property object.</span></span> 
      
   2. <span data-ttu-id="5c36d-156">Si le nouvel objet est un destinataire isolé, appelez la méthode **IMAPIProp:: SetProps** du fournisseur hôte pour définir les propriétés suivantes:</span><span class="sxs-lookup"><span data-stu-id="5c36d-156">If the new object is a one-off recipient, call the host provider's **IMAPIProp::SetProps** method to set the following properties:</span></span> 
      
      - <span data-ttu-id="5c36d-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) vers le type d'adresse géré par votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="5c36d-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) to the address type handled by your provider.</span></span>
        
      - <span data-ttu-id="5c36d-158">**PR\_TemplateID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) à l'identificateur de modèle à partir des paramètres _lpTemplateID_ et _cbTemplateID_ .</span><span class="sxs-lookup"><span data-stu-id="5c36d-158">**PR\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) to the template identifier from the  _lpTemplateID_ and  _cbTemplateID_ parameters.</span></span> 
        
      - <span data-ttu-id="5c36d-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) à DT_MAILUSER ou DT_DISTLIST, selon le cas.</span><span class="sxs-lookup"><span data-stu-id="5c36d-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) to DT_MAILUSER or DT_DISTLIST, as appropriate.</span></span>
    
5. <span data-ttu-id="5c36d-160">Définissez le contenu du paramètre _lppMAPIPropNew_ de sorte qu'il pointe vers le nouvel objet de votre fournisseur ou l'objet Property transmis avec le paramètre _lpMAPIPropData_ , selon que votre fournisseur détermine ou non un objet encapsulé.</span><span class="sxs-lookup"><span data-stu-id="5c36d-160">Set the contents of the  _lppMAPIPropNew_ parameter to point to either your provider's new object or the property object passed in with the  _lpMAPIPropData_ parameter, depending on whether your provider determines a wrapped object is necessary.</span></span> 
    
6. <span data-ttu-id="5c36d-161">Si une erreur critique se produit, comme une défaillance réseau ou une condition de mémoire insuffisante, renvoyez la valeur d'erreur appropriée.</span><span class="sxs-lookup"><span data-stu-id="5c36d-161">If a critical error occurs, such as a network failure or an out of memory condition, return the appropriate error value.</span></span> <span data-ttu-id="5c36d-162">Cette valeur doit être propagée au client avec la structure [MAPIERROR](mapierror.md) appropriée, une tâche effectuée par le fournisseur de l'hôte.</span><span class="sxs-lookup"><span data-stu-id="5c36d-162">This value should get propagated to the client with the appropriate [MAPIERROR](mapierror.md) structure, a task performed by the host provider.</span></span> 
    

