---
title: Moteur d'inActivité MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 755d096a-2a61-44d2-a765-5d464a857756
description: Dernière modification le 9 mars 2015
ms.openlocfilehash: d8d591c02bb621c16a1d1b46272b19573ea79785
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428451"
---
# <a name="mapi-idle-engine"></a><span data-ttu-id="a8b83-103">Moteur d'inActivité MAPI</span><span class="sxs-lookup"><span data-stu-id="a8b83-103">MAPI Idle Engine</span></span>

  
  
<span data-ttu-id="a8b83-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="a8b83-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="a8b83-105">MAPI offre plusieurs fonctions, appelées «moteur inactif».</span><span class="sxs-lookup"><span data-stu-id="a8b83-105">MAPI provides several functions that are collectively known as the idle engine.</span></span> <span data-ttu-id="a8b83-106">Ces fonctions permettent aux clients, aux fournisseurs de carnets d'adresses et aux fournisseurs de banques de messages d'effectuer diverses tâches pendant les temps de ralentissement dans la session ou en réponse à un temps de ralentissement.</span><span class="sxs-lookup"><span data-stu-id="a8b83-106">These functions allow clients, address book providers, and message store providers to perform various tasks during slow times in the session or in response to a slow time.</span></span> <span data-ttu-id="a8b83-107">Par exemple, les clients et les fournisseurs de services peuvent différer les opérations lentes ou fermer des fichiers qui sont restés inutilisés pendant une longue période.</span><span class="sxs-lookup"><span data-stu-id="a8b83-107">For example, clients and service providers can defer slow operations or close files that have remained unused for a lengthy period.</span></span> <span data-ttu-id="a8b83-108">En règle générale, les fournisseurs de transport n'utilisent pas le moteur inactif car la méthode **IXPLogon:: Idle** prend sa place.</span><span class="sxs-lookup"><span data-stu-id="a8b83-108">Transport providers typically do not use the idle engine because the **IXPLogon::Idle** method takes its place.</span></span> <span data-ttu-id="a8b83-109">Pour plus d'informations, consultez la rubrique [IXPLogon:: Idle](ixplogon-idle.md).</span><span class="sxs-lookup"><span data-stu-id="a8b83-109">For more information, see [IXPLogon::Idle](ixplogon-idle.md).</span></span>
  
<span data-ttu-id="a8b83-110">Pour utiliser le moteur inactif, les clients et les fournisseurs de services créent une fonction de rappel qui contient les tâches qui doivent se produire lorsque le sous-système MAPI est inactif.</span><span class="sxs-lookup"><span data-stu-id="a8b83-110">To use the idle engine, clients and service providers create a callback function that contains the tasks that should occur when the MAPI subsystem is idle.</span></span> <span data-ttu-id="a8b83-111">Lorsque MAPI détecte le temps d'inactivité, il appelle cette fonction de rappel.</span><span class="sxs-lookup"><span data-stu-id="a8b83-111">When MAPI detects idle time, it invokes this callback function.</span></span> <span data-ttu-id="a8b83-112">La fonction de rappel suit le prototype **FNIDLE** , défini comme suit:</span><span class="sxs-lookup"><span data-stu-id="a8b83-112">The callback function follows the **FNIDLE** prototype, defined as follows:</span></span> 
  
 `BOOL (STDAPICALLTYPE FNIDLE) (LPVOID lpvContext)`
  
<span data-ttu-id="a8b83-113">Pour plus d'informations, consultez la rubrique [FNIDLE](fnidle.md).</span><span class="sxs-lookup"><span data-stu-id="a8b83-113">For more information, see [FNIDLE](fnidle.md).</span></span>
  
<span data-ttu-id="a8b83-114">Les fonctions qui composent le moteur inactif sont les suivantes:</span><span class="sxs-lookup"><span data-stu-id="a8b83-114">The functions that make up the idle engine are:</span></span>
  
[<span data-ttu-id="a8b83-115">ChangeIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="a8b83-115">ChangeIdleRoutine</span></span>](changeidleroutine.md)
  
[<span data-ttu-id="a8b83-116">DeregisterIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="a8b83-116">DeregisterIdleRoutine</span></span>](deregisteridleroutine.md)
  
[<span data-ttu-id="a8b83-117">EnableIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="a8b83-117">EnableIdleRoutine</span></span>](enableidleroutine.md)
  
[<span data-ttu-id="a8b83-118">FtgRegisterIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="a8b83-118">FtgRegisterIdleRoutine</span></span>](ftgregisteridleroutine.md)
  
[<span data-ttu-id="a8b83-119">MAPIDeInitIdle</span><span class="sxs-lookup"><span data-stu-id="a8b83-119">MAPIDeInitIdle</span></span>](mapideinitidle.md)
  
[<span data-ttu-id="a8b83-120">MAPIInitIdle</span><span class="sxs-lookup"><span data-stu-id="a8b83-120">MAPIInitIdle</span></span>](mapiinitidle.md)
  
<span data-ttu-id="a8b83-121">Pour enregistrer une fonction de rappel, les clients et les fournisseurs de services appellent la fonction **FtgRegisterIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="a8b83-121">To register a callback function, clients and service providers call the **FtgRegisterIdleRoutine** function.</span></span> <span data-ttu-id="a8b83-122">Les paramètres d'entrée incluent une priorité facultative, un bloc de mémoire qui est transmis à votre fonction de rappel comme entrée, un délai à utiliser en quelque sorte et un ensemble d'indicateurs d'option.</span><span class="sxs-lookup"><span data-stu-id="a8b83-122">The input parameters include an optional priority, a block of memory that is passed to your callback function as input, an amount of time to be used in any way appropriate, and a set of option flags.</span></span> 
  
<span data-ttu-id="a8b83-123">Les clients et les fournisseurs de services peuvent spécifier une priorité dans le paramètre _priIdle_ qui contrôle le mode d'exécution de la fonction Idle ou spécifier zéro si la priorité n'est pas un problème.</span><span class="sxs-lookup"><span data-stu-id="a8b83-123">Clients and service providers can specify a priority in the  _priIdle_ parameter that controls how the idle function runs or specify zero if priority is not an issue.</span></span> <span data-ttu-id="a8b83-124">Étant donné que les nombres négatifs représentent des priorités supérieures à ceux des nombres positifs ou zéro, des nombres négatifs doivent être attribués aux opérations de compression et de recherche.</span><span class="sxs-lookup"><span data-stu-id="a8b83-124">Because negative numbers represent higher priorities than positive numbers or zero, compression and search operations should be assigned negative numbers.</span></span> <span data-ttu-id="a8b83-125">Les tâches qui se produisent une fois doivent recevoir des nombres positifs.</span><span class="sxs-lookup"><span data-stu-id="a8b83-125">Tasks that occur once should be assigned positive numbers.</span></span> 
  
<span data-ttu-id="a8b83-126">Pour annuler l'inscription d'une fonction de rappel active, les clients et les fournisseurs de services appellent la fonction **DeregisterIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="a8b83-126">To deregister an active callback function, clients and service providers call the **DeregisterIdleRoutine** function.</span></span> <span data-ttu-id="a8b83-127">Étant donné que **DeregisterIdleRoutine** opère de manière asynchrone, il est possible que la fonction de rappel soit appelée à tout moment pendant l'appel de désinscription, voire même après que **DeregisterIdleRoutine** a renvoyé.</span><span class="sxs-lookup"><span data-stu-id="a8b83-127">Because **DeregisterIdleRoutine** operates asynchronously, it is possible for the callback function to be invoked at any time during the deregister call and possibly even after **DeregisterIdleRoutine** has returned.</span></span> 
  
<span data-ttu-id="a8b83-128">Pour modifier une partie ou la totalité des caractéristiques d'une fonction de rappel, les clients et les fournisseurs de services appellent la fonction **ChangeIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="a8b83-128">To modify some or all of the characteristics of a callback function, clients and service providers call the **ChangeIdleRoutine** function.</span></span> <span data-ttu-id="a8b83-129">**ChangeIdleRoutine** apporte des modifications en fonction de la définition du paramètre flags _ircIdle_ ; **ChangeIdleRoutine** peut modifier la fonction elle-même, sa priorité, son paramètre d'heure et son paramètre d'entrée.</span><span class="sxs-lookup"><span data-stu-id="a8b83-129">**ChangeIdleRoutine** makes changes according to how the flags parameter  _ircIdle_ is set; **ChangeIdleRoutine** can change the function itself, its priority, time setting, and input parameter.</span></span> 
  
<span data-ttu-id="a8b83-130">MAPI définit inactif de la même manière que le système d'exploitation, lorsque le système d'exploitation a une définition.</span><span class="sxs-lookup"><span data-stu-id="a8b83-130">MAPI defines idle the same as the operating system, when the operating system has a definition.</span></span> <span data-ttu-id="a8b83-131">Sur Win32, MAPI crée un thread avec une priorité de classe inactive pour planifier les tâches inactives.</span><span class="sxs-lookup"><span data-stu-id="a8b83-131">On Win32, MAPI creates a thread with idle-class priority to schedule idle tasks.</span></span> <span data-ttu-id="a8b83-132">Cette thread effectue le suivi du temps et publie un message dans le thread qui doit exécuter la tâche inactive lorsque l'heure de son exécution arrive.</span><span class="sxs-lookup"><span data-stu-id="a8b83-132">This thread keeps track of the time and posts a message to the thread that is to execute the idle task when the time for its execution arrives.</span></span> <span data-ttu-id="a8b83-133">Win32 planifie les threads, pas les processus.</span><span class="sxs-lookup"><span data-stu-id="a8b83-133">Win32 schedules threads, not processes.</span></span> <span data-ttu-id="a8b83-134">Si les tâches dont la priorité est supérieure à la priorité d'inactivité se produisent sur le poste de travail, la tâche inactive ne doit pas être planifiée pour l'exécution jusqu'à ce que les tâches soient terminées.</span><span class="sxs-lookup"><span data-stu-id="a8b83-134">If tasks that have a priority higher than the idle priority are occurring on the workstation, the idle task should not get scheduled for execution until the tasks have completed.</span></span> 
  
<span data-ttu-id="a8b83-135">Toutes les tâches inactives s'exécutent sur le thread qui a appelé **MAPIInitIdle**.</span><span class="sxs-lookup"><span data-stu-id="a8b83-135">All idle tasks run on the thread that called **MAPIInitIdle**.</span></span> <span data-ttu-id="a8b83-136">MAPI dispose d'un thread distinct pour la planification, mais lorsqu'une tâche inactive devient éligible, il publie un message sur le thread d'initialisation et la tâche inactive est exécutée.</span><span class="sxs-lookup"><span data-stu-id="a8b83-136">MAPI has a separate thread for scheduling, but when an idle task becomes eligible, it posts a message back over to the initialization thread and the idle task is executed there.</span></span> <span data-ttu-id="a8b83-137">Les implications pour les différents types de clients sont les suivantes.</span><span class="sxs-lookup"><span data-stu-id="a8b83-137">The implications for different types of clients are as follows.</span></span>
  
|<span data-ttu-id="a8b83-138">**Modèle de thread**</span><span class="sxs-lookup"><span data-stu-id="a8b83-138">**Threading model**</span></span>|<span data-ttu-id="a8b83-139">**Implique**</span><span class="sxs-lookup"><span data-stu-id="a8b83-139">**Implication**</span></span>|
|:-----|:-----|
|<span data-ttu-id="a8b83-140">Thread unique</span><span class="sxs-lookup"><span data-stu-id="a8b83-140">Single-threaded</span></span>  <br/> |<span data-ttu-id="a8b83-141">Pas de problème.</span><span class="sxs-lookup"><span data-stu-id="a8b83-141">No problem.</span></span> <span data-ttu-id="a8b83-142">Les fonctions inActives s'exécutent sur le thread principal de votre client et sont sérialisées via la boucle de message.</span><span class="sxs-lookup"><span data-stu-id="a8b83-142">Idle functions execute on your client's main thread and are serialized through the message loop.</span></span>  <br/> |
|<span data-ttu-id="a8b83-143">Thread libre</span><span class="sxs-lookup"><span data-stu-id="a8b83-143">Free-threaded</span></span>  <br/> |<span data-ttu-id="a8b83-144">Les fonctions inActives doivent être thread-safe, mais votre client dispose déjà de l'infrastructure nécessaire.</span><span class="sxs-lookup"><span data-stu-id="a8b83-144">Idle functions must be thread-safe, but your client already has the necessary infrastructure.</span></span> <span data-ttu-id="a8b83-145">Il se peut que votre client n'ait pas du tout besoin du moteur inactif MAPI.</span><span class="sxs-lookup"><span data-stu-id="a8b83-145">Your client might not need the MAPI idle engine at all.</span></span>  <br/> |
|<span data-ttu-id="a8b83-146">Thread cloisonné</span><span class="sxs-lookup"><span data-stu-id="a8b83-146">Apartment-threaded</span></span>  <br/> |<span data-ttu-id="a8b83-147">La fonction Idle doit s'exécuter sur le même thread qui l'a inscrite si elle veut utiliser MAPI, OLE ou toute autre interface COM.</span><span class="sxs-lookup"><span data-stu-id="a8b83-147">Idle function has to execute on the same thread that registered it if it wants to use MAPI, OLE, or any other COM interfaces.</span></span> <span data-ttu-id="a8b83-148">La méthode la plus simple consiste à enregistrer une fonction inactive avec MAPI qui publie un message vers le thread approprié et de distribuer la fonction inactive «Real» directement à partir de la boucle de message de ce thread.</span><span class="sxs-lookup"><span data-stu-id="a8b83-148">The most straightforward way is to register an idle function with MAPI that posts a message to the right thread and dispatch the "real" idle function directly from that thread's message loop.</span></span>  <br/> |
   

