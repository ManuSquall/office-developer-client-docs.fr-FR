---
title: Enregistrement d’un message
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 97bff16b-dc7c-4eed-8834-d0c076d83ca3
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: fcb5486cc96403b872e07ab597545ca6f493907d
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/23/2018
ms.locfileid: "22581320"
---
# <a name="saving-a-message"></a><span data-ttu-id="7c811-103">Enregistrement d’un message</span><span class="sxs-lookup"><span data-stu-id="7c811-103">Saving a Message</span></span>

  
  
<span data-ttu-id="7c811-104">**S’applique à**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="7c811-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="7c811-105">Avant l’enregistrée d’un message, clients appellent généralement la méthode de [IMAPIProp::SetProps](imapiprop-setprops.md) du message pour définir plusieurs propriétés en plus des propriétés de texte de message, les propriétés de pièce jointe, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) et les propriétés associée à la liste des destinataires.</span><span class="sxs-lookup"><span data-stu-id="7c811-105">Before a message is saved, clients typically call the message's [IMAPIProp::SetProps](imapiprop-setprops.md) method to set a few properties in addition to the message text properties, attachment properties, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)), and properties associated with the recipient list.</span></span>
  
<span data-ttu-id="7c811-106">Définissez la propriété **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) à une chaîne de caractères comme IPM. Notez que décrit la classe de message sortant.</span><span class="sxs-lookup"><span data-stu-id="7c811-106">Set the **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) property to a character string such as IPM.Note that describes the class of the outgoing message.</span></span> <span data-ttu-id="7c811-107">Bien que les clients doivent définir **PR_MESSAGE_CLASS** sur tous les messages sortants, une valeur par défaut est fournie par le fournisseur de banque de message si vous ne le définissez pas.</span><span class="sxs-lookup"><span data-stu-id="7c811-107">Although clients should set **PR_MESSAGE_CLASS** on all outgoing messages, a default value is supplied by the message store provider if you do not set it.</span></span> <span data-ttu-id="7c811-108">La classe de message par défaut pour les messages sortants est IPM.</span><span class="sxs-lookup"><span data-stu-id="7c811-108">The default message class for outgoing messages is IPM.</span></span> 
  
<span data-ttu-id="7c811-109">Définir l’indicateur MSGFLAG_UNSENT dans la propriété **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="7c811-109">Set the MSGFLAG_UNSENT flag in the **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) property.</span></span> <span data-ttu-id="7c811-110">Si vous le souhaitez, définissez également les indicateurs MSGFLAG_READ et MSGFLAG_UNMODIFIED.</span><span class="sxs-lookup"><span data-stu-id="7c811-110">If desired, also set the MSGFLAG_READ and MSGFLAG_UNMODIFIED flags.</span></span> <span data-ttu-id="7c811-111">Définition de la MSGFLAG_UNMODIFIED permet à un message dans la composition simuler un message remis.</span><span class="sxs-lookup"><span data-stu-id="7c811-111">Setting the MSGFLAG_UNMODIFIED allows a message under composition to simulate a delivered message.</span></span> <span data-ttu-id="7c811-112">MSGFLAG_UNMODIFIED peut uniquement être définie par les clients avant un message a été enregistré pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="7c811-112">MSGFLAG_UNMODIFIED can only be set by clients before a message has been saved for the first time.</span></span> 
  
<span data-ttu-id="7c811-113">Lorsque vous êtes prêt à effectuer une copie d’un message en attente permanente, appelez [IMAPIProp::SaveChanges](imapiprop-savechanges.md) sur le message et toutes ses pièces jointes.</span><span class="sxs-lookup"><span data-stu-id="7c811-113">When you are ready to make a permanent copy of an unsent message, call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message and all of its attachments.</span></span> <span data-ttu-id="7c811-114">Si vous souhaitez envoyer le message immédiatement, il est inutile d’appeler **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="7c811-114">If you intend to send the message right away, you do not need to call **SaveChanges**.</span></span> <span data-ttu-id="7c811-115">En interne, l’appel à **SubmitMessage** enregistre le message dans le cadre de son traitement.</span><span class="sxs-lookup"><span data-stu-id="7c811-115">The call to **SubmitMessage** internally saves the message as part of its processing.</span></span> 
  
<span data-ttu-id="7c811-116">Lorsque vous appelez **SaveChanges**, il est conseillé de spécifier l’indicateur KEEP_OPEN_READWRITE, ce qui autorise le message de modification à une date ultérieure.</span><span class="sxs-lookup"><span data-stu-id="7c811-116">When calling **SaveChanges**, it is a good idea to specify the KEEP_OPEN_READWRITE flag, which allows the message to be modified at a later time.</span></span> <span data-ttu-id="7c811-117">Autres indicateurs définissables incluent FORCE_SAVE, ce qui indique que le message ou une pièce jointe doit être fermé une fois que les modifications soient validées, KEEP_OPEN_READONLY, ce qui indique qu’aucune modification ne seront, et l’indicateur pour autoriser le fournisseur de banque de messages à traitement par lots des demandes des clients, MAPI_DEFERRED_ERRORS.</span><span class="sxs-lookup"><span data-stu-id="7c811-117">Other settable flags include FORCE_SAVE, which indicates that the message or attachment should be closed after changes are committed, KEEP_OPEN_READONLY, which indicates that no further changes will be made, and the flag to allow the message store provider to batch client requests, MAPI_DEFERRED_ERRORS.</span></span>
  
<span data-ttu-id="7c811-118">Il est essentiel que vous appelez **SaveChanges** pour chaque pièce jointe dans le message avant d’appeler **SaveChanges** pour le message.</span><span class="sxs-lookup"><span data-stu-id="7c811-118">It is essential that you call **SaveChanges** for every attachment in the message before you call **SaveChanges** for the message.</span></span> <span data-ttu-id="7c811-119">Si vous ne parvenez pas à enregistrer une pièce jointe, la pièce jointe ne sera pas incluse dans le message lorsqu’il est envoyé et il n’apparaît pas dans la table des pièces jointes du message.</span><span class="sxs-lookup"><span data-stu-id="7c811-119">If you fail to save an attachment, the attachment will not be included with the message when it is sent and it will not appear in the message's attachment table.</span></span> <span data-ttu-id="7c811-120">Si vous ne parvenez pas à enregistrer le message après avoir enregistré toutes les pièces jointes, le message et les pièces jointes seront perdues.</span><span class="sxs-lookup"><span data-stu-id="7c811-120">If you fail to save the message after saving all of the attachments, both the message and the attachments will be lost.</span></span> 
  
<span data-ttu-id="7c811-121">Lorsque **SaveChanges** est appelée, le fournisseur de banque de messages met à jour les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="7c811-121">When **SaveChanges** is called, the message store provider updates the following properties:</span></span> 
  
- <span data-ttu-id="7c811-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) répertorie tous les destinataires principales.</span><span class="sxs-lookup"><span data-stu-id="7c811-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) lists all primary recipients.</span></span>
    
- <span data-ttu-id="7c811-123">**PR_DISPLAY_TO** répertorie tous les destinataires en copie carbone.</span><span class="sxs-lookup"><span data-stu-id="7c811-123">**PR_DISPLAY_TO** lists all carbon copy recipients.</span></span> 
    
- <span data-ttu-id="7c811-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) répertorie tous les destinataires en copie carbone invisible.</span><span class="sxs-lookup"><span data-stu-id="7c811-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) lists all blind carbon copy recipients.</span></span>
    
- <span data-ttu-id="7c811-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="7c811-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span></span>
    
- <span data-ttu-id="7c811-126">**PR_MESSAGE_FLAGS** définit MSGFLAG_HASATTACH si une ou plusieurs pièces jointes ont été enregistrées et efface MSGFLAG_UNMODIFIED pour afficher que le message a été modifié.</span><span class="sxs-lookup"><span data-stu-id="7c811-126">**PR_MESSAGE_FLAGS** sets MSGFLAG_HASATTACH if one or more attachments have been saved and clears MSGFLAG_UNMODIFIED to show the message has changed.</span></span> 
    
- <span data-ttu-id="7c811-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contient la taille du message plus récente.</span><span class="sxs-lookup"><span data-stu-id="7c811-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contains the most current size of the message.</span></span>
    
- <span data-ttu-id="7c811-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) permet d’accéder à la table des pièces jointes.</span><span class="sxs-lookup"><span data-stu-id="7c811-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) provides access to the attachment table.</span></span>
    
- <span data-ttu-id="7c811-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) permet d’accéder à la table de destinataires.</span><span class="sxs-lookup"><span data-stu-id="7c811-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) provides access to the recipient table.</span></span>
    
<span data-ttu-id="7c811-130">Certaines propriétés de message sont généralement fournies par les clients ou fournisseurs de services lors de la création d’un message.</span><span class="sxs-lookup"><span data-stu-id="7c811-130">Some message properties are typically supplied by clients or service providers when a message is created.</span></span> <span data-ttu-id="7c811-131">Si un client oublie leur définition, il est le fournisseur de magasin de message pour les mettre à jour en temps **que SaveChanges** est appelée.</span><span class="sxs-lookup"><span data-stu-id="7c811-131">If a client neglects to set them, it is up to the message store provider to update them at the time **SaveChanges** is called.</span></span> <span data-ttu-id="7c811-132">Par exemple, si **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) et des propriétés **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) d’un message ont été définies lorsque le message a été créé, ils ne doivent pas être modifiés à gagner du temps.</span><span class="sxs-lookup"><span data-stu-id="7c811-132">For example, if a message's **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) and **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) properties were set when the message was created, they need not be modified at save time.</span></span> <span data-ttu-id="7c811-133">Toutefois, les fournisseurs de magasins de message négligent les définir lors de la création du message doivent les définir la première fois **SaveChanges** est appelée.</span><span class="sxs-lookup"><span data-stu-id="7c811-133">However, message store providers that neglect to set them at message creation must set them the first time that **SaveChanges** is called.</span></span> 
  
<span data-ttu-id="7c811-134">Si **SaveChanges** renvoie MAPI_E_CORRUPT_DATA, partent du principe que les données enregistrées sont maintenant perdu.</span><span class="sxs-lookup"><span data-stu-id="7c811-134">If **SaveChanges** returns MAPI_E_CORRUPT_DATA, assume that the data being saved is now lost.</span></span> <span data-ttu-id="7c811-135">Les fournisseurs de magasins de message qui utilisent un modèle client-serveur de mise en oeuvre peuvent retourner cette valeur lorsqu’une connexion réseau est perdue ou le serveur n’est pas en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="7c811-135">Message store providers that use a client-server model for their implementation might return this value when a network connection is lost or the server is not running.</span></span> <span data-ttu-id="7c811-136">Avant de retourner une erreur à l’utilisateur, essayez d’écrire et enregistrer les données d’une deuxième fois en effectuant un appel à **SetProps** suivi par un autre appel à **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="7c811-136">Before returning an error to the user, try to write and save the data a second time by making a call to **SetProps** followed by another call to **SaveChanges**.</span></span> <span data-ttu-id="7c811-137">Si les données sont mis en cache localement, il ne doit pas être un problème.</span><span class="sxs-lookup"><span data-stu-id="7c811-137">If the data is cached locally, this should not be a problem.</span></span> <span data-ttu-id="7c811-138">Toutefois, si aucun cache local ou si l’appel de **SaveChanges** deuxième échoue, affiche une erreur pour avertir l’utilisateur au problème.</span><span class="sxs-lookup"><span data-stu-id="7c811-138">However, if there is no local cache or the second **SaveChanges** call fails, display an error to alert the user to the problem.</span></span> 
  

