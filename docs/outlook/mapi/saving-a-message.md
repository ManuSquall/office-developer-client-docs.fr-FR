---
title: Enregistrement d'un message
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 97bff16b-dc7c-4eed-8834-d0c076d83ca3
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: d5ceeb46bded101700aec696a17d690bde80ce6d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33420930"
---
# <a name="saving-a-message"></a><span data-ttu-id="6c289-103">Enregistrement d'un message</span><span class="sxs-lookup"><span data-stu-id="6c289-103">Saving a Message</span></span>

  
  
<span data-ttu-id="6c289-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="6c289-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="6c289-105">Avant qu'un message ne soit enregistré, les clients appellent généralement la méthode [IMAPIProp:: SetProps](imapiprop-setprops.md) du message pour définir quelques propriétés en plus des propriétés Text du message, des propriétés des pièces jointes, des **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) et des propriétés. associé à la liste des destinataires.</span><span class="sxs-lookup"><span data-stu-id="6c289-105">Before a message is saved, clients typically call the message's [IMAPIProp::SetProps](imapiprop-setprops.md) method to set a few properties in addition to the message text properties, attachment properties, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)), and properties associated with the recipient list.</span></span>
  
<span data-ttu-id="6c289-106">Définissez la propriété **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) sur une chaîne de caractères telle que IPM. Notez que décrit la classe du message sortant.</span><span class="sxs-lookup"><span data-stu-id="6c289-106">Set the **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) property to a character string such as IPM.Note that describes the class of the outgoing message.</span></span> <span data-ttu-id="6c289-107">Bien que les clients doivent définir **PR_MESSAGE_CLASS** sur tous les messages sortants, une valeur par défaut est fournie par le fournisseur de banque de messages si vous ne le configurez pas.</span><span class="sxs-lookup"><span data-stu-id="6c289-107">Although clients should set **PR_MESSAGE_CLASS** on all outgoing messages, a default value is supplied by the message store provider if you do not set it.</span></span> <span data-ttu-id="6c289-108">La classe de message par défaut pour les messages sortants est IPM.</span><span class="sxs-lookup"><span data-stu-id="6c289-108">The default message class for outgoing messages is IPM.</span></span> 
  
<span data-ttu-id="6c289-109">Définissez l'indicateur MSGFLAG_UNSENT dans la propriété **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="6c289-109">Set the MSGFLAG_UNSENT flag in the **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) property.</span></span> <span data-ttu-id="6c289-110">Si vous le souhaitez, définissez également les indicateurs MSGFLAG_READ et MSGFLAG_UNMODIFIED.</span><span class="sxs-lookup"><span data-stu-id="6c289-110">If desired, also set the MSGFLAG_READ and MSGFLAG_UNMODIFIED flags.</span></span> <span data-ttu-id="6c289-111">La définition de MSGFLAG_UNMODIFIED permet à un message en cours de composition de simuler un message remis.</span><span class="sxs-lookup"><span data-stu-id="6c289-111">Setting the MSGFLAG_UNMODIFIED allows a message under composition to simulate a delivered message.</span></span> <span data-ttu-id="6c289-112">MSGFLAG_UNMODIFIED ne peut être défini que par les clients avant la première sauvegarde d'un message.</span><span class="sxs-lookup"><span data-stu-id="6c289-112">MSGFLAG_UNMODIFIED can only be set by clients before a message has been saved for the first time.</span></span> 
  
<span data-ttu-id="6c289-113">Lorsque vous êtes prêt à créer une copie permanente d'un message non envoyé, appelez [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) sur le message et toutes ses pièces jointes.</span><span class="sxs-lookup"><span data-stu-id="6c289-113">When you are ready to make a permanent copy of an unsent message, call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message and all of its attachments.</span></span> <span data-ttu-id="6c289-114">Si vous envisagez d'envoyer le message immédiatement, il n'est pas nécessaire d'appeler **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="6c289-114">If you intend to send the message right away, you do not need to call **SaveChanges**.</span></span> <span data-ttu-id="6c289-115">L'appel à **SubmitMessage** enregistre en interne le message dans le cadre de son traitement.</span><span class="sxs-lookup"><span data-stu-id="6c289-115">The call to **SubmitMessage** internally saves the message as part of its processing.</span></span> 
  
<span data-ttu-id="6c289-116">Lors de l'appel de **SaveChanges**, il est recommandé de spécifier l'indicateur KEEP_OPEN_READWRITE, qui permet de modifier le message ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="6c289-116">When calling **SaveChanges**, it is a good idea to specify the KEEP_OPEN_READWRITE flag, which allows the message to be modified at a later time.</span></span> <span data-ttu-id="6c289-117">D'autres indicateurs définissables incluent FORCE_SAVE, qui indique que le message ou la pièce jointe doit être fermé une fois les modifications validées, KEEP_OPEN_READONLY, qui indique qu'aucune autre modification ne sera apportée, et l'indicateur pour autoriser le fournisseur de banque de messages à demandes de client par lots, MAPI_DEFERRED_ERRORS.</span><span class="sxs-lookup"><span data-stu-id="6c289-117">Other settable flags include FORCE_SAVE, which indicates that the message or attachment should be closed after changes are committed, KEEP_OPEN_READONLY, which indicates that no further changes will be made, and the flag to allow the message store provider to batch client requests, MAPI_DEFERRED_ERRORS.</span></span>
  
<span data-ttu-id="6c289-118">Avant d'appeler **SaveChanges** pour le message, il est essentiel d'appeler **SaveChanges** pour chaque pièce jointe du message.</span><span class="sxs-lookup"><span data-stu-id="6c289-118">It is essential that you call **SaveChanges** for every attachment in the message before you call **SaveChanges** for the message.</span></span> <span data-ttu-id="6c289-119">Si vous ne parvenez pas à enregistrer une pièce jointe, elle ne sera pas incluse dans le message lors de son envoi et n'apparaîtra pas dans la table des pièces jointes du message.</span><span class="sxs-lookup"><span data-stu-id="6c289-119">If you fail to save an attachment, the attachment will not be included with the message when it is sent and it will not appear in the message's attachment table.</span></span> <span data-ttu-id="6c289-120">Si vous ne parvenez pas à enregistrer le message après avoir enregistré toutes les pièces jointes, le message et les pièces jointes seront perdus.</span><span class="sxs-lookup"><span data-stu-id="6c289-120">If you fail to save the message after saving all of the attachments, both the message and the attachments will be lost.</span></span> 
  
<span data-ttu-id="6c289-121">Lorsque **SaveChanges** est appelé, le fournisseur de banque de messages met à jour les propriétés suivantes:</span><span class="sxs-lookup"><span data-stu-id="6c289-121">When **SaveChanges** is called, the message store provider updates the following properties:</span></span> 
  
- <span data-ttu-id="6c289-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) répertorie tous les destinataires principaux.</span><span class="sxs-lookup"><span data-stu-id="6c289-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) lists all primary recipients.</span></span>
    
- <span data-ttu-id="6c289-123">**PR_DISPLAY_TO** répertorie tous les destinataires de copie carbone.</span><span class="sxs-lookup"><span data-stu-id="6c289-123">**PR_DISPLAY_TO** lists all carbon copy recipients.</span></span> 
    
- <span data-ttu-id="6c289-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) répertorie tous les destinataires en copie carbone invisible.</span><span class="sxs-lookup"><span data-stu-id="6c289-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) lists all blind carbon copy recipients.</span></span>
    
- <span data-ttu-id="6c289-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="6c289-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span></span>
    
- <span data-ttu-id="6c289-126">**PR_MESSAGE_FLAGS** définit MSGFLAG_HASATTACH si une ou plusieurs pièces jointes ont été enregistrées et efface MSGFLAG_UNMODIFIED pour afficher le message a été modifié.</span><span class="sxs-lookup"><span data-stu-id="6c289-126">**PR_MESSAGE_FLAGS** sets MSGFLAG_HASATTACH if one or more attachments have been saved and clears MSGFLAG_UNMODIFIED to show the message has changed.</span></span> 
    
- <span data-ttu-id="6c289-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contient la taille de message la plus récente.</span><span class="sxs-lookup"><span data-stu-id="6c289-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contains the most current size of the message.</span></span>
    
- <span data-ttu-id="6c289-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) permet d'accéder au tableau des pièces jointes.</span><span class="sxs-lookup"><span data-stu-id="6c289-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) provides access to the attachment table.</span></span>
    
- <span data-ttu-id="6c289-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) fournit l'accès à la table de destinataires.</span><span class="sxs-lookup"><span data-stu-id="6c289-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) provides access to the recipient table.</span></span>
    
<span data-ttu-id="6c289-130">Certaines propriétés de message sont généralement fournies par des clients ou des fournisseurs de services lors de la création d'un message.</span><span class="sxs-lookup"><span data-stu-id="6c289-130">Some message properties are typically supplied by clients or service providers when a message is created.</span></span> <span data-ttu-id="6c289-131">Si un client oublie de les définir, il revient au fournisseur de banque de messages de les mettre à jour au moment de l'appel de **SaveChanges** .</span><span class="sxs-lookup"><span data-stu-id="6c289-131">If a client neglects to set them, it is up to the message store provider to update them at the time **SaveChanges** is called.</span></span> <span data-ttu-id="6c289-132">Par exemple, si les propriétés **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) et **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) d'un message ont été définies lors de la création du message, elles n'ont pas besoin d'être modifiées lors de l'enregistrement.</span><span class="sxs-lookup"><span data-stu-id="6c289-132">For example, if a message's **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) and **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) properties were set when the message was created, they need not be modified at save time.</span></span> <span data-ttu-id="6c289-133">Toutefois, les fournisseurs de banque de messages qui négligent de les définir lors de la création de messages doivent les définir lors du premier appel de **SaveChanges** .</span><span class="sxs-lookup"><span data-stu-id="6c289-133">However, message store providers that neglect to set them at message creation must set them the first time that **SaveChanges** is called.</span></span> 
  
<span data-ttu-id="6c289-134">Si **SaveChanges** renvoie MAPI_E_CORRUPT_DATA, partez du principe que les données enregistrées sont maintenant perdues.</span><span class="sxs-lookup"><span data-stu-id="6c289-134">If **SaveChanges** returns MAPI_E_CORRUPT_DATA, assume that the data being saved is now lost.</span></span> <span data-ttu-id="6c289-135">Les fournisseurs de banques de messages qui utilisent un modèle de serveur client pour leur implémentation peuvent renvoyer cette valeur lorsqu'une connexion réseau est perdue ou que le serveur n'est pas en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="6c289-135">Message store providers that use a client-server model for their implementation might return this value when a network connection is lost or the server is not running.</span></span> <span data-ttu-id="6c289-136">Avant de renvoyer une erreur à l'utilisateur, essayez d'écrire et d'enregistrer les données une seconde fois en appelant **SetProps** suivi d'un autre appel à **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="6c289-136">Before returning an error to the user, try to write and save the data a second time by making a call to **SetProps** followed by another call to **SaveChanges**.</span></span> <span data-ttu-id="6c289-137">Si les données sont mises en cache localement, cela ne doit pas être un problème.</span><span class="sxs-lookup"><span data-stu-id="6c289-137">If the data is cached locally, this should not be a problem.</span></span> <span data-ttu-id="6c289-138">Toutefois, s'il n'y a pas de cache local ou si le deuxième appel de **SaveChanges** échoue, affiche une erreur pour alerter l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="6c289-138">However, if there is no local cache or the second **SaveChanges** call fails, display an error to alert the user to the problem.</span></span> 
  

