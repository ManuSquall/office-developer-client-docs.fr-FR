---
title: Notification d’événement dans MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321394"
---
# <a name="event-notification-in-mapi"></a><span data-ttu-id="cc454-103">Notification d’événement dans MAPI</span><span class="sxs-lookup"><span data-stu-id="cc454-103">Event notification in MAPI</span></span>

<span data-ttu-id="cc454-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="cc454-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="cc454-105">La notification d’événement est la communication d’informations entre deux objets MAPI.</span><span class="sxs-lookup"><span data-stu-id="cc454-105">Event notification is the communication of information between two MAPI objects.</span></span> <span data-ttu-id="cc454-106">Via l’un des objets, un client ou un fournisseur de services s’inscrit pour la notification d’une modification ou d’une erreur, appelée événement, qui peut avoir lieu dans l’autre objet.</span><span class="sxs-lookup"><span data-stu-id="cc454-106">Through one of the objects, a client or service provider registers for notification of a change or error, called an event, which may take place in the other object.</span></span> <span data-ttu-id="cc454-107">Une fois l’événement se produit, le premier objet est averti de la modification ou de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="cc454-107">After the event occurs, the first object is notified of the change or error.</span></span> <span data-ttu-id="cc454-108">L’objet qui reçoit la notification est appelé le sink de notification ; L’objet responsable de la notification est appelé source de notification.</span><span class="sxs-lookup"><span data-stu-id="cc454-108">The object receiving the notification is called the advise sink; the object responsible for the notification is called the advise source.</span></span>
  
<span data-ttu-id="cc454-109">Il existe trois types d’objets de type sink de conseil (tous les types sont des objets MAPI standard) :</span><span class="sxs-lookup"><span data-stu-id="cc454-109">There are three types of advise sink objects (all types are standard MAPI objects):</span></span>
  
- <span data-ttu-id="cc454-110">Conseillez les objets de sink.</span><span class="sxs-lookup"><span data-stu-id="cc454-110">Advise sink objects.</span></span>   
- <span data-ttu-id="cc454-111">Les objets de sink de conseil de formulaire.</span><span class="sxs-lookup"><span data-stu-id="cc454-111">Form advise sink objects.</span></span>  
- <span data-ttu-id="cc454-112">Afficher les objets de sink de conseil.</span><span class="sxs-lookup"><span data-stu-id="cc454-112">View advise sink objects.</span></span>
    
<span data-ttu-id="cc454-113">Les objets de type sink de conseil sont le type le plus courant.</span><span class="sxs-lookup"><span data-stu-id="cc454-113">Advise sink objects are the most common type.</span></span> <span data-ttu-id="cc454-114">Les réceptions de notification sont généralement implémentées par les applications clientes pour recevoir des notifications de carnet d’adresses et de magasin de messages et prendre en charge l’interface [IMAPIAdviseSink : IUnknown.](imapiadvisesinkiunknown.md)</span><span class="sxs-lookup"><span data-stu-id="cc454-114">Advise sinks are typically implemented by client applications to receive address book and message store notifications and support the [IMAPIAdviseSink : IUnknown](imapiadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="cc454-115">**IMAPIAdviseSink** contient une seule méthode, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span><span class="sxs-lookup"><span data-stu-id="cc454-115">**IMAPIAdviseSink** contains a single method, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span></span> <span data-ttu-id="cc454-116">Les sinks de conseil de formulaire et d’affichage sont moins courants ; ils sont implémentés pour recevoir des notifications concernant les modifications apportées aux formulaires personnalisés.</span><span class="sxs-lookup"><span data-stu-id="cc454-116">Form and view advise sinks are less common; they are implemented to receive notifications about changes to custom forms.</span></span> <span data-ttu-id="cc454-117">Les sinks de conseil de formulaires supportent l’interface [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) et les sinks de conseil d’affichage la prise en charge de l’interface [IMAPIViewAdviseSink : IUnknown.](imapiviewadvisesinkiunknown.md)</span><span class="sxs-lookup"><span data-stu-id="cc454-117">Form advise sinks support the [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) interface and view advise sinks support the [IMAPIViewAdviseSink : IUnknown](imapiviewadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="cc454-118">Étant donné que la plupart des clients implémentent des objets de réception de notification standard, supposons que les discussions sur les notifications concernent les notifications de carnet d’adresses et de magasin de messages plutôt que les notifications par formulaires.</span><span class="sxs-lookup"><span data-stu-id="cc454-118">Because most clients implement standard advise sink objects, assume that discussions of notifications relate to address book and message store notifications rather than forms notifications.</span></span> <span data-ttu-id="cc454-119">Pour plus d’informations sur les notifications de formulaires, voir [MAPI Forms Notifications](mapi-forms-notifications.md) et [Writing Form Server Code](writing-form-server-code.md).</span><span class="sxs-lookup"><span data-stu-id="cc454-119">For more information about forms notifications, see [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span></span>
  
<span data-ttu-id="cc454-120">Les objets source de conseil sont implémentés par les fournisseurs de services et par MAPI.</span><span class="sxs-lookup"><span data-stu-id="cc454-120">Advise source objects are implemented by service providers and by MAPI.</span></span> <span data-ttu-id="cc454-121">Tous les fournisseurs de services ne supportent pas la notification d’événement ; Il est facultatif, mais fortement recommandé.</span><span class="sxs-lookup"><span data-stu-id="cc454-121">Not all service providers support event notification; it is optional, but strongly recommended.</span></span> <span data-ttu-id="cc454-122">Les fournisseurs de magasins de messages et de carnets d’adresses prend généralement en charge les notifications d’objet sur plusieurs de leurs objets et les notifications de tableau sur leur contenu et leurs tables hiérarchiques.</span><span class="sxs-lookup"><span data-stu-id="cc454-122">Message store and address book providers usually support object notifications on several of their objects and table notifications on their contents and hierarchy tables.</span></span> <span data-ttu-id="cc454-123">Les fournisseurs de transport ne supportent pas les notifications directement ; ils s’appuient sur d’autres méthodes de communication avec les clients.</span><span class="sxs-lookup"><span data-stu-id="cc454-123">Transport providers do not support notifications directly; they rely on alternative methods of communication with clients.</span></span>
  
<span data-ttu-id="cc454-124">Contrairement aux sinks de conseil, les objets source de conseil ne sont pas un type unique d’objet MAPI.</span><span class="sxs-lookup"><span data-stu-id="cc454-124">Unlike advise sinks, advise source objects are not a unique type of MAPI object.</span></span> <span data-ttu-id="cc454-125">De nombreux objets MAPI, tels que les magasins de messages et les tables, peuvent prendre le rôle de source de conseil.</span><span class="sxs-lookup"><span data-stu-id="cc454-125">Many MAPI objects, such as message stores and tables, can take on the role of advise source.</span></span> <span data-ttu-id="cc454-126">Une source de conseil est tout objet MAPI qui fait les choses suivantes :</span><span class="sxs-lookup"><span data-stu-id="cc454-126">An advise source is any MAPI object that does the following:</span></span>
  
- <span data-ttu-id="cc454-127">Implémente une **méthode Advise** pour recevoir des inscriptions de notification.</span><span class="sxs-lookup"><span data-stu-id="cc454-127">Implements an **Advise** method to receive notification registrations.</span></span> 
    
- <span data-ttu-id="cc454-128">Implémente **une méthode Unadvise** pour recevoir des annulations de notification.</span><span class="sxs-lookup"><span data-stu-id="cc454-128">Implements an **Unadvise** method to receive notification cancellations.</span></span> 
    
- <span data-ttu-id="cc454-129">Génère des notifications du type approprié aux objets de réception de notification appropriés qui ont été inscrits en appelant leurs méthodes **IMAPIAdviseSink::OnNotify.**</span><span class="sxs-lookup"><span data-stu-id="cc454-129">Generates notifications of the appropriate type to the appropriate advise sink objects that have registered by calling their **IMAPIAdviseSink::OnNotify** methods.</span></span> 
    
<span data-ttu-id="cc454-130">Les clients qui implémentent des objets de réception de notification appellent **Advise** lorsqu’ils souhaitent s’inscrire pour une notification, dans la plupart des cas en passant l’identificateur d’entrée de l’objet avec lequel l’inscription doit avoir lieu, et **Unadvise** lorsqu’ils souhaitent annuler l’inscription.</span><span class="sxs-lookup"><span data-stu-id="cc454-130">Clients that implement advise sink objects call **Advise** when they want to register for a notification, in most cases passing in the entry identifier of the object with which registration should occur, and **Unadvise** when they want to cancel the registration.</span></span> <span data-ttu-id="cc454-131">Les clients passent un paramètre **à Advise** qui indique lequel des différents types d’événements qu’ils souhaitent surveiller.</span><span class="sxs-lookup"><span data-stu-id="cc454-131">Clients pass a parameter to **Advise** that indicates which of the several types of events they want to monitor.</span></span> <span data-ttu-id="cc454-132">**L’avis** renvoie un nombre autre que zéro qui représente une connexion réussie entre le sink de conseil et la source de conseil.</span><span class="sxs-lookup"><span data-stu-id="cc454-132">**Advise** returns a nonzero number that represents a successful connection between the advise sink and advise source.</span></span> 
  
<span data-ttu-id="cc454-133">Avant d’appeler **Advise,** les clients peuvent déterminer si un fournisseur de magasins de messages prend en charge la notification en vérifiant que l’indicateur STORE_NOTIFY_OK est définie dans la propriété **PR_STORE_SUPPORT_MASK (** [PidTagStoreSupportMask)](pidtagstoresupportmask-canonical-property.md)de la boutique de messages.</span><span class="sxs-lookup"><span data-stu-id="cc454-133">Before calling **Advise**, clients can determine whether a message store provider supports notification by checking that the STORE_NOTIFY_OK flag is set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span> <span data-ttu-id="cc454-134">Les clients ne peuvent pas déterminer à l’avance si un fournisseur de carnet d’adresses prend en charge les notifications.</span><span class="sxs-lookup"><span data-stu-id="cc454-134">There is no way for clients to determine ahead of time whether or not an address book provider supports notifications.</span></span> <span data-ttu-id="cc454-135">Les clients doivent tenter de s’inscrire et, si la tentative échoue, ils peuvent supposer que les notifications ne sont pas pris en compte.</span><span class="sxs-lookup"><span data-stu-id="cc454-135">Clients must attempt to register and if the attempt fails, they can assume notifications are unsupported.</span></span>
  
<span data-ttu-id="cc454-136">Lorsqu’un événement pour lequel un client s’est inscrit se produit, la source de notification avertit le recevoir en appelant sa méthode [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) avec une structure de données de notification qui contient des informations sur l’événement.</span><span class="sxs-lookup"><span data-stu-id="cc454-136">When an event for which a client has registered occurs, the advise source notifies the advise sink by calling its [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method with a notification data structure that contains information about the event.</span></span> <span data-ttu-id="cc454-137">L’implémentation **d’OnNotify** par un réception de conseil peut effectuer des tâches en réponse à la notification, telles que la mise à jour des données en mémoire ou l’actualisation d’un écran.</span><span class="sxs-lookup"><span data-stu-id="cc454-137">An advise sink's implementation of **OnNotify** can perform tasks in response to the notification, such as updating data in memory or refreshing a screen display.</span></span> 
  
<span data-ttu-id="cc454-138">Les fournisseurs de services peuvent implémenter la prise en charge des notifications manuellement ou tirer parti de l’aide fournie dans trois méthodes **IMAPISupport** : [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)et [IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="cc454-138">Service providers can implement support for notifications manually or take advantage of the help provided in three **IMAPISupport** methods: [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md), and [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="cc454-139">Les **méthodes Subscribe** et **Unsubscribe** gèrent l’inscription et l’enregistrement des notifications pour les fournisseurs ; La **méthode Notify** gère l’envoi de notifications, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="cc454-139">The **Subscribe** and **Unsubscribe** methods handle notification registration and deregistration for providers; the **Notify** method handles sending notifications when appropriate.</span></span> 
  
<span data-ttu-id="cc454-140">Pour utiliser les méthodes d’objet de support pour l’inscription des notifications, les fournisseurs de services appellent [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span><span class="sxs-lookup"><span data-stu-id="cc454-140">To use the support object methods for notification registration, service providers call [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span></span> <span data-ttu-id="cc454-141">Si un identificateur d’entrée est transmis en tant que paramètre d’entrée pour spécifier une source de conseil, les fournisseurs de services le convertissent en clé binaire.</span><span class="sxs-lookup"><span data-stu-id="cc454-141">If an entry identifier is passed as an input parameter to specify an advise source, service providers convert it to a binary key.</span></span> <span data-ttu-id="cc454-142">**S’abonner** crée un numéro de connexion unique et c’est ce numéro que les fournisseurs de services retournent aux clients.</span><span class="sxs-lookup"><span data-stu-id="cc454-142">**Subscribe** creates a unique connection number and it is this number that service providers return to clients.</span></span> <span data-ttu-id="cc454-143">Les fournisseurs de services peuvent libérer le pointeur d’objet de sink du client à tout moment une fois **l’appel** de conseil terminé.</span><span class="sxs-lookup"><span data-stu-id="cc454-143">Service providers can release the client's advise sink object pointer at any time after the **Advise** call has completed.</span></span> 
  
<span data-ttu-id="cc454-144">Lorsque les clients appellent **Unadvise** pour annuler une inscription, les fournisseurs de services décrémentent le nombre de références sur le pointeur de sink de conseil du client ou appellent **Unsubscribe** pour en faire de même.</span><span class="sxs-lookup"><span data-stu-id="cc454-144">When clients call **Unadvise** to cancel a registration, service providers either decrement the reference count on the client's advise sink pointer or call **Unsubscribe** to do the same.</span></span> 
  
<span data-ttu-id="cc454-145">Lorsqu’il est temps de générer une notification, les fournisseurs de services effectuent tout traitement interne lié à la notification et initialisent une structure de [notification](notification.md) en lui fixant la valeur zéro pour tous ses membres inutilisés.</span><span class="sxs-lookup"><span data-stu-id="cc454-145">When it is time to generate a notification, service providers perform any internal processing that relates to the notification and initializes a [NOTIFICATION](notification.md) structure by setting all of its unused members to zero.</span></span> <span data-ttu-id="cc454-146">Cette technique d’initialisation de la structure **NOTIFICATION** peut aider les clients à créer des implémentations **OnNotify** plus petites, plus rapides et moins sujettes aux erreurs.</span><span class="sxs-lookup"><span data-stu-id="cc454-146">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="cc454-147">L’illustration suivante montre la communication entre les objets de sink de conseil, les objets source de conseil et MAPI.</span><span class="sxs-lookup"><span data-stu-id="cc454-147">The following illustration shows the communication between advise sink objects, advise source objects, and MAPI.</span></span> <span data-ttu-id="cc454-148">MAPI est impliqué uniquement lorsque la source de notification appelle les méthodes **IMAPISupport** pour la prise en charge des notifications.</span><span class="sxs-lookup"><span data-stu-id="cc454-148">MAPI is involved only when the advise source calls the **IMAPISupport** methods for notification support.</span></span> 
  
<span data-ttu-id="cc454-149">**Appels de notification d’événement**</span><span class="sxs-lookup"><span data-stu-id="cc454-149">**Event notification calls**</span></span>
  
<span data-ttu-id="cc454-150">![Appels de notification d’événements appels](media/amapi_51.gif "de notification d’événement")</span><span class="sxs-lookup"><span data-stu-id="cc454-150">![Event notification calls](media/amapi_51.gif "Event notification calls")</span></span>
  
<span data-ttu-id="cc454-151">La classe MFCMAPI **CAdviseSink** (à l’aide des fichiers AdviseSink.h et AdviseSink.cpp) implémente l’objet de sink de conseil pour tous les appels à **Advise**.</span><span class="sxs-lookup"><span data-stu-id="cc454-151">The MFCMAPI **CAdviseSink** class (using the AdviseSink.h and AdviseSink.cpp files) implements the advise sink object for all calls to **Advise**.</span></span> <span data-ttu-id="cc454-152">Pour plus d’informations sur MFCMAPI, voir [MFCMAPI en](mfcmapi-as-a-code-sample.md) tant qu’exemple de code et [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).</span><span class="sxs-lookup"><span data-stu-id="cc454-152">For more information about MFCMAPI, see [MFCMAPI as a Code Sample](mfcmapi-as-a-code-sample.md) and [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).</span></span>
  

