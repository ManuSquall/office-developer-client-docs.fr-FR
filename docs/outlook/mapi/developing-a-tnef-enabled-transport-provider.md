---
title: Développement d’un fournisseur TNEF-Enabled transport de données
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439001"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a><span data-ttu-id="16561-103">Développement d’un fournisseur TNEF-Enabled transport de données</span><span class="sxs-lookup"><span data-stu-id="16561-103">Developing a TNEF-Enabled Transport Provider</span></span>

  
  
<span data-ttu-id="16561-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="16561-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="16561-105">Pour promouvoir l’interopérabilité entre les systèmes de messagerie qui assurent la prise en charge de différents ensembles de fonctionnalités MAPI, MAPI fournit le format TNEF (Transport Neutral Encapsulation Format) comme moyen standard de transférer des données.</span><span class="sxs-lookup"><span data-stu-id="16561-105">To promote interoperability between messaging systems that support different sets of MAPI features, MAPI provides the Transport Neutral Encapsulation Format (TNEF) as a standard way to transfer data.</span></span> <span data-ttu-id="16561-106">Ce format encapsule les propriétés MAPI non pris en charge par un système de messagerie sous-jacent dans un flux binaire qui peut être transféré avec le message lorsqu’un fournisseur de transport l’envoie.</span><span class="sxs-lookup"><span data-stu-id="16561-106">This format encapsulates MAPI properties not supported by an underlying messaging system into a binary stream that can be transferred along with the message when a transport provider sends it.</span></span> <span data-ttu-id="16561-107">Le fournisseur de transport qui reçoit le message peut ensuite décoder le flux binaire pour récupérer toutes les propriétés du message d’origine et les rendre accessibles aux applications clientes.</span><span class="sxs-lookup"><span data-stu-id="16561-107">The transport provider that receives the message can then decode the binary stream to retrieve all the properties of the original message and make them available to client applications.</span></span> <span data-ttu-id="16561-108">Le modèle opérationnel pour le TNEF est :</span><span class="sxs-lookup"><span data-stu-id="16561-108">The operational model for TNEF is:</span></span>
  
- <span data-ttu-id="16561-109">Les clients de messagerie envoient et reçoivent des messages dans un transport TNEF comme d’habitude.</span><span class="sxs-lookup"><span data-stu-id="16561-109">Messaging clients submit and receive messages to a TNEF transport as normal.</span></span>
    
- <span data-ttu-id="16561-110">Le transport sépare les propriétés des messages sortants en deux catégories : celles que le système de message sous-jacent prend en charge et celles qui ne le sont pas.</span><span class="sxs-lookup"><span data-stu-id="16561-110">The transport separates the properties on outgoing messages into two categories: those that the underlying message system supports and those that it does not.</span></span> <span data-ttu-id="16561-111">Les valeurs des propriétés qui sont pris en charge par le système de messagerie sous-jacent sont converties dans le format requis.</span><span class="sxs-lookup"><span data-stu-id="16561-111">The values of the properties that are supported by the underlying messaging system are translated into the required format.</span></span>
    
- <span data-ttu-id="16561-112">Le transport utilise les méthodes MAPI TNEF pour encoder toutes les propriétés non pris en compte dans un flux de données unique.</span><span class="sxs-lookup"><span data-stu-id="16561-112">The transport uses the MAPI TNEF methods to encode any unsupported properties into a single data stream.</span></span> <span data-ttu-id="16561-113">Le transport transforme ensuite ce flux de données en pièce jointe spéciale sur le message sortant, à l’aide du modèle de pièce jointe du système de messagerie sous-jacent, avant d’envoyer le message.</span><span class="sxs-lookup"><span data-stu-id="16561-113">The transport then turns that data stream into a special attachment on the outgoing message, using the underlying messaging system's attachment model, before sending the message.</span></span>
    
- <span data-ttu-id="16561-114">Un transport TNEF activé qui reçoit un tel message fait deux choses.</span><span class="sxs-lookup"><span data-stu-id="16561-114">A TNEF enabled transport that receives such a message does two things.</span></span> <span data-ttu-id="16561-115">Tout d’abord, il traduit les propriétés du message entrant (ceux pris en charge par le système de message sous-jacent) en propriétés MAPI.</span><span class="sxs-lookup"><span data-stu-id="16561-115">First, it translates the incoming message's properties — the ones supported by the underlying message system — into MAPI properties.</span></span> <span data-ttu-id="16561-116">Ensuite, si la pièce jointe spéciale est présente, elle utilise les méthodes MAPI TNEF pour récupérer des propriétés MAPI supplémentaires de la pièce jointe avant de remettre le message à une application cliente.</span><span class="sxs-lookup"><span data-stu-id="16561-116">Second, if the special attachment is present, it uses the MAPI TNEF methods to retrieve additional MAPI properties from the attachment before delivering the message to a client application.</span></span>
    
<span data-ttu-id="16561-117">MAPI fournit une implémentation de l’interface **ITnef** à utiliser par les fournisseurs de transport MAPI lors de l’utilisation d’objets TNEF.</span><span class="sxs-lookup"><span data-stu-id="16561-117">MAPI supplies an implementation of the **ITnef** interface for use by MAPI transport providers when working with TNEF objects.</span></span> <span data-ttu-id="16561-118">La [fonction OpenTnefStreamEx permet](opentnefstreamex.md) de créer des objets TNEF et de les associer à un message.</span><span class="sxs-lookup"><span data-stu-id="16561-118">The [OpenTnefStreamEx](opentnefstreamex.md) function is used to create TNEF objects and associate them with a message.</span></span> <span data-ttu-id="16561-119">Les flux TNEF sont créés au-dessus de l’interface OLE **IStream**</span><span class="sxs-lookup"><span data-stu-id="16561-119">TNEF streams are built on top of the OLE **IStream** interface</span></span> 
  
> [!NOTE]
> <span data-ttu-id="16561-120">Vous utilisez **OpenTnefStreamEx pour** créer des objets TNEF.</span><span class="sxs-lookup"><span data-stu-id="16561-120">You use **OpenTnefStreamEx** to create TNEF objects.</span></span> <span data-ttu-id="16561-121">**L’ancienne fonction OpenTnefStream** existe toujours pour la compatibilité avec l’ancien code source et ne doit pas être utilisée dans quelque chose de nouveau.</span><span class="sxs-lookup"><span data-stu-id="16561-121">The old **OpenTnefStream** function still exists for compatibility with old source code and should not be used in anything new.</span></span> 
  
<span data-ttu-id="16561-122">**L’interface ITnef** fournit les méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="16561-122">The **ITnef** interface provides the following methods:</span></span> 
  
- [<span data-ttu-id="16561-123">AddProps</span><span class="sxs-lookup"><span data-stu-id="16561-123">AddProps</span></span>](itnef-addprops.md)
    
- [<span data-ttu-id="16561-124">EncodeRecips</span><span class="sxs-lookup"><span data-stu-id="16561-124">EncodeRecips</span></span>](itnef-encoderecips.md)
    
- [<span data-ttu-id="16561-125">ExtractProps</span><span class="sxs-lookup"><span data-stu-id="16561-125">ExtractProps</span></span>](itnef-extractprops.md)
    
- [<span data-ttu-id="16561-126">Finish</span><span class="sxs-lookup"><span data-stu-id="16561-126">Finish</span></span>](itnef-finish.md)
    
- [<span data-ttu-id="16561-127">FinishComponent</span><span class="sxs-lookup"><span data-stu-id="16561-127">FinishComponent</span></span>](itnef-finishcomponent.md)
    
- [<span data-ttu-id="16561-128">OpenTaggedBody</span><span class="sxs-lookup"><span data-stu-id="16561-128">OpenTaggedBody</span></span>](itnef-opentaggedbody.md)
    
- [<span data-ttu-id="16561-129">SetProps</span><span class="sxs-lookup"><span data-stu-id="16561-129">SetProps</span></span>](itnef-setprops.md)
    
<span data-ttu-id="16561-130">Le modèle d’implémentation MAPI TNEF prend en charge :</span><span class="sxs-lookup"><span data-stu-id="16561-130">The MAPI TNEF implementation model supports:</span></span>
  
- <span data-ttu-id="16561-131">Toutes les propriétés MAPI sans affecter les autres propriétés de message.</span><span class="sxs-lookup"><span data-stu-id="16561-131">All MAPI properties without affecting other message properties.</span></span> <span data-ttu-id="16561-132">Pour que les messages MAPI survit au transport via un système de messagerie, toutes les propriétés qui ne peuvent pas être codées en tant que propriétés du système de messagerie doivent être encapsulées.</span><span class="sxs-lookup"><span data-stu-id="16561-132">In order for MAPI messages to survive transport through a messaging system, all properties that cannot be encoded as properties of the messaging system must be encapsulated.</span></span> <span data-ttu-id="16561-133">Étant donné qu’il n’est presque jamais connu au moment de l’envoi d’un message si un client compatible MAPI recevra ou non le message, le schéma d’encapsulation permet à un fournisseur de transport de coder uniquement les propriétés de message MAPI que le système de messagerie ne prend pas en charge en natif.</span><span class="sxs-lookup"><span data-stu-id="16561-133">Because it is almost never known at the time a message is sent whether or not a MAPI-compliant client will receive the message, the encapsulation scheme allows a transport provider to encode only those MAPI message properties that the messaging system does not natively support.</span></span> <span data-ttu-id="16561-134">Cela signifie que les messages qui utilisent le TNEF ne sont pas « opaques » pour les systèmes de messagerie qui ne sont pas basés sur MAPI tels que les systèmes de messagerie UNIX SMTP.</span><span class="sxs-lookup"><span data-stu-id="16561-134">This means that messages which use TNEF are not "opaque" to messaging systems that are not based on MAPI such as SMTP-based UNIX messaging systems.</span></span> <span data-ttu-id="16561-135">Ces systèmes reçoivent les propriétés qu’ils prisent en charge, quelle que soit leur manière habituelle, et d’autres propriétés sont reçues en tant que flux de données TNEF codés.</span><span class="sxs-lookup"><span data-stu-id="16561-135">These systems receive the properties they support in whatever manner is typical for them, and other properties are received as an encoded TNEF data stream.</span></span> <span data-ttu-id="16561-136">Le fournisseur de transport TNEF est responsable de la différenciation entre ces deux ensembles de propriétés et de l’envoi de l’ensemble pris en charge de la manière appropriée pour le système de messagerie.</span><span class="sxs-lookup"><span data-stu-id="16561-136">The TNEF transport provider is responsible for differentiating between these two sets of properties and sending the supported set in the proper manner for the messaging system.</span></span> <span data-ttu-id="16561-137">Le TNEF n’effectue aucune hypothèse quant au niveau de prise en charge fourni par un système de messagerie.</span><span class="sxs-lookup"><span data-stu-id="16561-137">TNEF makes no assumptions as to the level of support provided by a messaging system.</span></span> <span data-ttu-id="16561-138">Toutefois, dans les exemples d’utilisation du TNEF inclus dans cette section, nous partons du principe que le système de messagerie prend en charge au moins une seule pièce jointe en dehors du message.</span><span class="sxs-lookup"><span data-stu-id="16561-138">However, in the examples of TNEF usage included in this section, the assumption is made that the messaging system supports at least one single attachment aside from the message.</span></span> <span data-ttu-id="16561-139">Dans certains cas, la pièce jointe peut uniquement être prise en charge via un flux uuencoded et transmise dans le cadre du texte du message.</span><span class="sxs-lookup"><span data-stu-id="16561-139">In some cases, the attachment can only be supported through a uuencoded stream and transmitted as part of the message text.</span></span> <span data-ttu-id="16561-140">Ce n’est que dans de très rares cas que le système de messagerie aura si peu de prise en charge des propriétés de message que le codage TNEF complet de toutes les propriétés est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="16561-140">Only in very rare circumstances will the messaging system have so little support for message properties that full TNEF encoding of all properties is necessary.</span></span>
    
- <span data-ttu-id="16561-141">Mécanisme permettant de déterminer si un flux TNEF sur un message entrant appartient au message, en fonction de la propriété MAPI **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="16561-141">A mechanism for determining whether a TNEF stream on an incoming message belongs to the message, based on the MAPI property **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span></span> <span data-ttu-id="16561-142">Cette propriété doit être trouvée à la fois dans le flux TNEF et dans un en-tête de message approprié.</span><span class="sxs-lookup"><span data-stu-id="16561-142">This property should be found both in the TNEF stream and in an appropriate message header.</span></span> <span data-ttu-id="16561-143">Si la propriété a la même valeur aux deux endroits ou s’il est absent à l’un ou l’autre endroit, le flux TNEF est supposé appartenir au message.</span><span class="sxs-lookup"><span data-stu-id="16561-143">If the property has the same value in both places, or is missing in either place, the TNEF stream is assumed to belong to the message.</span></span> <span data-ttu-id="16561-144">Sinon, le flux TNEF est ignoré.</span><span class="sxs-lookup"><span data-stu-id="16561-144">Otherwise, the TNEF stream is ignored.</span></span> <span data-ttu-id="16561-145">Les transports TNEF activés sont chargés de choisir une valeur pour cette propriété sur les messages sortants et de l’encoder dans un en-tête de message approprié (par exemple, l’en-tête Message-ID: pour les messages SMTP) et dans le flux TNEF.</span><span class="sxs-lookup"><span data-stu-id="16561-145">TNEF enabled transports are responsible for choosing a value for this property on outbound messages and encoding it in an appropriate message header (for example, the Message-ID: header for SMTP messages) and in the TNEF stream.</span></span>
    

