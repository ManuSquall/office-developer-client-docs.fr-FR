---
title: Développement d'un fournisseur de transport compatible TNEF
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439001"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a><span data-ttu-id="ced59-103">Développement d'un fournisseur de transport compatible TNEF</span><span class="sxs-lookup"><span data-stu-id="ced59-103">Developing a TNEF-Enabled Transport Provider</span></span>

  
  
<span data-ttu-id="ced59-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="ced59-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="ced59-105">Pour promouvoir l'interopérabilité entre les systèmes de messagerie qui prennent en charge différents ensembles de fonctionnalités MAPI, MAPI fournit le format TNEF (Transport Neutral Encapsulation Format) comme moyen standard de transfert de données.</span><span class="sxs-lookup"><span data-stu-id="ced59-105">To promote interoperability between messaging systems that support different sets of MAPI features, MAPI provides the Transport Neutral Encapsulation Format (TNEF) as a standard way to transfer data.</span></span> <span data-ttu-id="ced59-106">Ce Format encapsule les propriétés MAPI qui ne sont pas prises en charge par un système de messagerie sous-jacent dans un flux binaire pouvant être transféré avec le message lorsqu'un fournisseur de transport l'envoie.</span><span class="sxs-lookup"><span data-stu-id="ced59-106">This format encapsulates MAPI properties not supported by an underlying messaging system into a binary stream that can be transferred along with the message when a transport provider sends it.</span></span> <span data-ttu-id="ced59-107">Le fournisseur de transport qui reçoit le message peut ensuite décoder le flux binaire pour récupérer toutes les propriétés du message d'origine et les rendre accessibles aux applications clientes.</span><span class="sxs-lookup"><span data-stu-id="ced59-107">The transport provider that receives the message can then decode the binary stream to retrieve all the properties of the original message and make them available to client applications.</span></span> <span data-ttu-id="ced59-108">Le modèle opérationnel pour TNEF est le suivant:</span><span class="sxs-lookup"><span data-stu-id="ced59-108">The operational model for TNEF is:</span></span>
  
- <span data-ttu-id="ced59-109">Les clients de messagerie envoient et reçoivent des messages vers un transport TNEF comme d'habitude.</span><span class="sxs-lookup"><span data-stu-id="ced59-109">Messaging clients submit and receive messages to a TNEF transport as normal.</span></span>
    
- <span data-ttu-id="ced59-110">Le transport sépare les propriétés des messages sortants en deux catégories: celles que le système de messagerie sous-jacent prend en charge et celles qui ne le sont pas.</span><span class="sxs-lookup"><span data-stu-id="ced59-110">The transport separates the properties on outgoing messages into two categories: those that the underlying message system supports and those that it does not.</span></span> <span data-ttu-id="ced59-111">Les valeurs des propriétés prises en charge par le système de messagerie sous-jacent sont converties dans le format requis.</span><span class="sxs-lookup"><span data-stu-id="ced59-111">The values of the properties that are supported by the underlying messaging system are translated into the required format.</span></span>
    
- <span data-ttu-id="ced59-112">Le transport utilise les méthodes TNEF MAPI pour coder les propriétés non prises en charge dans un seul flux de données.</span><span class="sxs-lookup"><span data-stu-id="ced59-112">The transport uses the MAPI TNEF methods to encode any unsupported properties into a single data stream.</span></span> <span data-ttu-id="ced59-113">Le transport transforme alors ce flux de données en pièce jointe spéciale sur le message sortant, en utilisant le modèle de pièce jointe du système de messagerie sous-jacent, avant d'envoyer le message.</span><span class="sxs-lookup"><span data-stu-id="ced59-113">The transport then turns that data stream into a special attachment on the outgoing message, using the underlying messaging system's attachment model, before sending the message.</span></span>
    
- <span data-ttu-id="ced59-114">Un transport activé TNEF qui reçoit ce type de message effectue deux actions.</span><span class="sxs-lookup"><span data-stu-id="ced59-114">A TNEF enabled transport that receives such a message does two things.</span></span> <span data-ttu-id="ced59-115">Tout d'abord, il traduit les propriétés du message entrant, c'est-à-dire celles prises en charge par le système de messagerie sous-jacent, dans les propriétés MAPI.</span><span class="sxs-lookup"><span data-stu-id="ced59-115">First, it translates the incoming message's properties — the ones supported by the underlying message system — into MAPI properties.</span></span> <span data-ttu-id="ced59-116">Deuxièmement, si la pièce jointe spéciale est présente, elle utilise les méthodes TNEF MAPI pour récupérer des propriétés MAPI supplémentaires à partir de la pièce jointe avant de remettre le message à une application cliente.</span><span class="sxs-lookup"><span data-stu-id="ced59-116">Second, if the special attachment is present, it uses the MAPI TNEF methods to retrieve additional MAPI properties from the attachment before delivering the message to a client application.</span></span>
    
<span data-ttu-id="ced59-117">MAPI fournit une implémentation de l'interface **ITnef** pour une utilisation par les fournisseurs de transport MAPI lors de l'utilisation d'objets TNEF.</span><span class="sxs-lookup"><span data-stu-id="ced59-117">MAPI supplies an implementation of the **ITnef** interface for use by MAPI transport providers when working with TNEF objects.</span></span> <span data-ttu-id="ced59-118">La fonction [OpenTnefStreamEx](opentnefstreamex.md) permet de créer des objets TNEF et de les associer à un message.</span><span class="sxs-lookup"><span data-stu-id="ced59-118">The [OpenTnefStreamEx](opentnefstreamex.md) function is used to create TNEF objects and associate them with a message.</span></span> <span data-ttu-id="ced59-119">Les flux TNEF sont créés en plus de l'interface OLE **IStream** .</span><span class="sxs-lookup"><span data-stu-id="ced59-119">TNEF streams are built on top of the OLE **IStream** interface</span></span> 
  
> [!NOTE]
> <span data-ttu-id="ced59-120">Vous utilisez **OpenTnefStreamEx** pour créer des objets TNEF.</span><span class="sxs-lookup"><span data-stu-id="ced59-120">You use **OpenTnefStreamEx** to create TNEF objects.</span></span> <span data-ttu-id="ced59-121">L'ancienne fonction **OpenTnefStream** existe toujours pour des incompatibilités avec le code source ancien et ne doit pas être utilisée dans les nouveautés.</span><span class="sxs-lookup"><span data-stu-id="ced59-121">The old **OpenTnefStream** function still exists for compatibility with old source code and should not be used in anything new.</span></span> 
  
<span data-ttu-id="ced59-122">L'interface **ITnef** fournit les méthodes suivantes:</span><span class="sxs-lookup"><span data-stu-id="ced59-122">The **ITnef** interface provides the following methods:</span></span> 
  
- [<span data-ttu-id="ced59-123">AddProps</span><span class="sxs-lookup"><span data-stu-id="ced59-123">AddProps</span></span>](itnef-addprops.md)
    
- [<span data-ttu-id="ced59-124">EncodeRecips</span><span class="sxs-lookup"><span data-stu-id="ced59-124">EncodeRecips</span></span>](itnef-encoderecips.md)
    
- [<span data-ttu-id="ced59-125">ExtractProps</span><span class="sxs-lookup"><span data-stu-id="ced59-125">ExtractProps</span></span>](itnef-extractprops.md)
    
- [<span data-ttu-id="ced59-126">Finish</span><span class="sxs-lookup"><span data-stu-id="ced59-126">Finish</span></span>](itnef-finish.md)
    
- [<span data-ttu-id="ced59-127">FinishComponent</span><span class="sxs-lookup"><span data-stu-id="ced59-127">FinishComponent</span></span>](itnef-finishcomponent.md)
    
- [<span data-ttu-id="ced59-128">OpenTaggedBody</span><span class="sxs-lookup"><span data-stu-id="ced59-128">OpenTaggedBody</span></span>](itnef-opentaggedbody.md)
    
- [<span data-ttu-id="ced59-129">SetProps</span><span class="sxs-lookup"><span data-stu-id="ced59-129">SetProps</span></span>](itnef-setprops.md)
    
<span data-ttu-id="ced59-130">Le modèle d'implémentation MAPI TNEF prend en charge les éléments suivants:</span><span class="sxs-lookup"><span data-stu-id="ced59-130">The MAPI TNEF implementation model supports:</span></span>
  
- <span data-ttu-id="ced59-131">Toutes les propriétés MAPI sans affecter les autres propriétés de message.</span><span class="sxs-lookup"><span data-stu-id="ced59-131">All MAPI properties without affecting other message properties.</span></span> <span data-ttu-id="ced59-132">Pour que les messages MAPI survivent le transport via un système de messagerie, toutes les propriétés qui ne peuvent pas être codées en tant que propriétés du système de messagerie doivent être encapsulées.</span><span class="sxs-lookup"><span data-stu-id="ced59-132">In order for MAPI messages to survive transport through a messaging system, all properties that cannot be encoded as properties of the messaging system must be encapsulated.</span></span> <span data-ttu-id="ced59-133">Étant donné qu'il n'est presque jamais connu lors de l'envoi d'un message qu'un client conforme à la norme MAPI reçoit le message, le schéma d'encapsulation permet à un fournisseur de transport de coder uniquement les propriétés de message MAPI non répertoriées par le système de messagerie. prise en charge native.</span><span class="sxs-lookup"><span data-stu-id="ced59-133">Because it is almost never known at the time a message is sent whether or not a MAPI-compliant client will receive the message, the encapsulation scheme allows a transport provider to encode only those MAPI message properties that the messaging system does not natively support.</span></span> <span data-ttu-id="ced59-134">Cela signifie que les messages qui utilisent TNEF ne sont pas «opaques» pour les systèmes de messagerie qui ne sont pas basés sur MAPI, tels que les systèmes de messagerie UNIX SMTP.</span><span class="sxs-lookup"><span data-stu-id="ced59-134">This means that messages which use TNEF are not "opaque" to messaging systems that are not based on MAPI such as SMTP-based UNIX messaging systems.</span></span> <span data-ttu-id="ced59-135">Ces systèmes reçoivent les propriétés qu'ils prennent en charge de la manière habituelle pour eux, et d'autres propriétés sont reçues sous la forme d'un flux de données encodé TNEF.</span><span class="sxs-lookup"><span data-stu-id="ced59-135">These systems receive the properties they support in whatever manner is typical for them, and other properties are received as an encoded TNEF data stream.</span></span> <span data-ttu-id="ced59-136">Le fournisseur de transport TNEF est chargé de différencier ces deux ensembles de propriétés et d'envoyer le jeu pris en charge de la manière appropriée pour le système de messagerie.</span><span class="sxs-lookup"><span data-stu-id="ced59-136">The TNEF transport provider is responsible for differentiating between these two sets of properties and sending the supported set in the proper manner for the messaging system.</span></span> <span data-ttu-id="ced59-137">Le format TNEF ne fait aucune supposition quant au niveau de prise en charge fourni par un système de messagerie.</span><span class="sxs-lookup"><span data-stu-id="ced59-137">TNEF makes no assumptions as to the level of support provided by a messaging system.</span></span> <span data-ttu-id="ced59-138">Toutefois, dans les exemples de l'utilisation de TNEF incluse dans cette section, l'hypothèse est que le système de messagerie prend en charge au moins une seule pièce jointe du message.</span><span class="sxs-lookup"><span data-stu-id="ced59-138">However, in the examples of TNEF usage included in this section, the assumption is made that the messaging system supports at least one single attachment aside from the message.</span></span> <span data-ttu-id="ced59-139">Dans certains cas, la pièce jointe ne peut être prise en charge que par le biais d'un flux UUEncoded et est transmise dans le texte du message.</span><span class="sxs-lookup"><span data-stu-id="ced59-139">In some cases, the attachment can only be supported through a uuencoded stream and transmitted as part of the message text.</span></span> <span data-ttu-id="ced59-140">Le système de messagerie est tellement peu pris en charge pour les propriétés de message que le codage TNEF complet de toutes les propriétés est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ced59-140">Only in very rare circumstances will the messaging system have so little support for message properties that full TNEF encoding of all properties is necessary.</span></span>
    
- <span data-ttu-id="ced59-141">Mécanisme permettant de déterminer si un flux TNEF sur un message entrant appartient au message, en fonction de la propriété MAPI **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="ced59-141">A mechanism for determining whether a TNEF stream on an incoming message belongs to the message, based on the MAPI property **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span></span> <span data-ttu-id="ced59-142">Cette propriété doit être trouvée dans le flux TNEF et dans un en-tête de message approprié.</span><span class="sxs-lookup"><span data-stu-id="ced59-142">This property should be found both in the TNEF stream and in an appropriate message header.</span></span> <span data-ttu-id="ced59-143">Si la propriété a la même valeur aux deux endroits ou manquante à partir de n'importe quel endroit, le flux TNEF est supposé appartenir au message.</span><span class="sxs-lookup"><span data-stu-id="ced59-143">If the property has the same value in both places, or is missing in either place, the TNEF stream is assumed to belong to the message.</span></span> <span data-ttu-id="ced59-144">Dans le cas contraire, le flux TNEF est ignoré.</span><span class="sxs-lookup"><span data-stu-id="ced59-144">Otherwise, the TNEF stream is ignored.</span></span> <span data-ttu-id="ced59-145">Les transports activés par TNEF sont chargés de choisir une valeur pour cette propriété sur les messages sortants et de l'encoder dans un en-tête de message approprié (par exemple, l'en-tête Message-ID: pour les messages SMTP) et dans le flux TNEF.</span><span class="sxs-lookup"><span data-stu-id="ced59-145">TNEF enabled transports are responsible for choosing a value for this property on outbound messages and encoding it in an appropriate message header (for example, the Message-ID: header for SMTP messages) and in the TNEF stream.</span></span>
    

