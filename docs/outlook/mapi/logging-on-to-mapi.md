---
title: Connexion à MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 63f71066b1afc90c3e495ed4f9ba654bcbdfe558
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/23/2018
ms.locfileid: "22579927"
---
# <a name="logging-on-to-mapi"></a><span data-ttu-id="67cfc-103">Connexion à MAPI</span><span class="sxs-lookup"><span data-stu-id="67cfc-103">Logging on to MAPI</span></span>
 
<span data-ttu-id="67cfc-104">**S’applique à**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="67cfc-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="67cfc-105">Applications clientes ouvrez une session le sous-système MAPI en appelant la fonction **MAPILogonEx** .</span><span class="sxs-lookup"><span data-stu-id="67cfc-105">Client applications log on to the MAPI subsystem by calling the **MAPILogonEx** function.</span></span> <span data-ttu-id="67cfc-106">Pour plus d’informations, voir [MAPILogonEx](mapilogonex.md).</span><span class="sxs-lookup"><span data-stu-id="67cfc-106">For more information, see [MAPILogonEx](mapilogonex.md).</span></span> <span data-ttu-id="67cfc-107">**MAPILogonEx** valide la sélection de profil et la configuration de chaque fournisseur de services dans le profil.</span><span class="sxs-lookup"><span data-stu-id="67cfc-107">**MAPILogonEx** validates the profile selection and the configuration of each service provider in the profile.</span></span> <span data-ttu-id="67cfc-108">Une fois configuré, MAPI démarre les fournisseurs de carnet d’adresses avant de commencer les fournisseurs de banque de messages.</span><span class="sxs-lookup"><span data-stu-id="67cfc-108">Once configured, MAPI starts the address book providers before starting the message store providers.</span></span> <span data-ttu-id="67cfc-109">Fournisseurs de transport sont démarrés lorsque leurs services sont d’abord requis.</span><span class="sxs-lookup"><span data-stu-id="67cfc-109">Transport providers are started when their services are first required.</span></span> 
  
## <a name="choose-a-profile"></a><span data-ttu-id="67cfc-110">Choisir un profil</span><span class="sxs-lookup"><span data-stu-id="67cfc-110">Choose a profile</span></span>
  
- <span data-ttu-id="67cfc-111">Passer une chaîne de caractères qui représente le nom du profil dans le paramètre _lpszProfileName_ à **MAPILogonEx**, ou...</span><span class="sxs-lookup"><span data-stu-id="67cfc-111">Pass in a character string that represents the name of the profile in the  _lpszProfileName_ parameter to **MAPILogonEx**, or...</span></span>
    
- <span data-ttu-id="67cfc-112">Autorise l’utilisateur à spécifier le profil en transmettant la valeur NULL dans le paramètre _lpszProfileName_ et en définissant l’indicateur MAPI_LOGON_UI, ou...</span><span class="sxs-lookup"><span data-stu-id="67cfc-112">Allow the user to specify the profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_LOGON_UI flag, or...</span></span> 

- <span data-ttu-id="67cfc-113">Sélectionnez le profil par défaut en passant NULL dans le paramètre _lpszProfileName_ et en définissant l’indicateur MAPI_USE_DEFAULT.</span><span class="sxs-lookup"><span data-stu-id="67cfc-113">Select the default profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_USE_DEFAULT flag.</span></span> 
    
<span data-ttu-id="67cfc-114">Si vous avez besoin d’un profil spécifique autre que le profil par défaut, vous devez enregistrer son nom dans votre propre base de données de configuration ou utiliser une convention d’affectation de noms spécifique.</span><span class="sxs-lookup"><span data-stu-id="67cfc-114">If you require a specific profile other than the default profile, you must save its name in your own configuration database or use a specific naming convention.</span></span> <span data-ttu-id="67cfc-115">MAPI n’expose pas les attributs de profil autre que l’indicateur de nom et la valeur par défaut dans le tableau de profil et l’indicateur de profil par défaut est réservé pour la messagerie client et les applications associées IPM.</span><span class="sxs-lookup"><span data-stu-id="67cfc-115">MAPI does not expose any profile attributes other than the name and default flag in the profile table, and the default profile flag is reserved for messaging client and related IPM applications.</span></span>
  
<span data-ttu-id="67cfc-116">Clients qui fournissent le profil partiel ou les informations de configuration de fournisseur pour **MAPILogonEx** doivent demander à l’utilisateur pour les données supplémentaires en permettant à une boîte de dialogue s’affiche.</span><span class="sxs-lookup"><span data-stu-id="67cfc-116">Clients that supply partial profile or provider configuration information to **MAPILogonEx** must prompt the user for the additional data by allowing a dialog box to be displayed.</span></span> <span data-ttu-id="67cfc-117">Si les informations sont manquantes et **MAPILogonEx** ne peut pas demander à l’utilisateur de lui, l’ouverture de session échoue.</span><span class="sxs-lookup"><span data-stu-id="67cfc-117">If information is missing and **MAPILogonEx** cannot prompt the user to supply it, the logon fails.</span></span> <span data-ttu-id="67cfc-118">Les clients qui ne pas besoin de l’entrée d’utilisateur peuvent supprimer l’affichage de boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="67cfc-118">Clients that do not need user input can suppress the dialog box display.</span></span> 
  
<span data-ttu-id="67cfc-119">Les indicateurs **MAPILogonEx** utilise pour activer une interface utilisateur sont mutuellement ; seul peut être défini.</span><span class="sxs-lookup"><span data-stu-id="67cfc-119">The flags that **MAPILogonEx** uses to enable a user interface are mutually exclusive; only one can be set.</span></span> <span data-ttu-id="67cfc-120">En laissant ces indicateurs Annuler supprime l’affichage de l’interface utilisateur, à l’origine de **MAPILogonEx** échoue si les informations nécessaires sont manquantes.</span><span class="sxs-lookup"><span data-stu-id="67cfc-120">Leaving these flags unset suppresses the display of a user interface, causing **MAPILogonEx** to fail if necessary information is missing.</span></span> <span data-ttu-id="67cfc-121">Autrement dit, si vous désactivez l’interface utilisateur et passez la valeur NULL pour le paramètre _lpszProfileName_ et que vous ne définissez pas l’indicateur MAPI_USE_DEFAULT, **MAPILogonEx** échoue parce qu’il ne peut pas récupérer un nom de profil.</span><span class="sxs-lookup"><span data-stu-id="67cfc-121">That is, if you disable the user interface and pass NULL for the  _lpszProfileName_ parameter and do not set the MAPI_USE_DEFAULT flag, **MAPILogonEx** will fail because it cannot retrieve a profile name.</span></span> 
  
<span data-ttu-id="67cfc-122">La session **MAPILogonEx** établit peut être une session non-messagerie, une session de messagerie partagée ou une session de messagerie spécifique.</span><span class="sxs-lookup"><span data-stu-id="67cfc-122">The session that **MAPILogonEx** establishes can be an individual messaging session, a shared messaging session, or a nonmessaging session.</span></span> <span data-ttu-id="67cfc-123">Sessions de messagerie individuelles sont des connexions entre votre client et le sous-système MAPI et peuvent être établies en définissant l’indicateur MAPI_NEW_SESSION dans l’appel de **MAPILogonEx**.</span><span class="sxs-lookup"><span data-stu-id="67cfc-123">Individual messaging sessions are private connections between your client and the MAPI subsystem and can be established by setting the MAPI_NEW_SESSION flag in the call to **MAPILogonEx**.</span></span>
  
<span data-ttu-id="67cfc-124">Sessions de messagerie partagées sont des connexions de plusieurs clients de messagerie peuvent utiliser.</span><span class="sxs-lookup"><span data-stu-id="67cfc-124">Shared messaging sessions are connections that multiple messaging clients can use.</span></span> <span data-ttu-id="67cfc-125">Les sessions partagées sont généralement définies pour les clients utilisent le même profil.</span><span class="sxs-lookup"><span data-stu-id="67cfc-125">Shared sessions are typically established for clients use the same profile.</span></span> <span data-ttu-id="67cfc-126">Pour établir une nouvelle session en tant qu’une session partagée, définir l’indicateur MAPI_ALLOW_OTHERS.</span><span class="sxs-lookup"><span data-stu-id="67cfc-126">To establish a new session as a shared session, set the MAPI_ALLOW_OTHERS flag.</span></span> 
  
## <a name="use-an-existing-shared-session"></a><span data-ttu-id="67cfc-127">Utilisez une session partagée</span><span class="sxs-lookup"><span data-stu-id="67cfc-127">Use an existing shared session</span></span>
  
- <span data-ttu-id="67cfc-128">Ne définissez pas l’indicateur MAPI_NEW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="67cfc-128">Do not set the MAPI_NEW_SESSION flag.</span></span>
    
- <span data-ttu-id="67cfc-129">Ne définissez pas l’indicateur MAPI_ALLOW_OTHERS.</span><span class="sxs-lookup"><span data-stu-id="67cfc-129">Do not set the MAPI_ALLOW_OTHERS flag.</span></span>
    
- <span data-ttu-id="67cfc-130">Passez la valeur NULL pour le paramètre _lpszProfileName_ .</span><span class="sxs-lookup"><span data-stu-id="67cfc-130">Pass NULL for the  _lpszProfileName_ parameter.</span></span> 
    
- <span data-ttu-id="67cfc-131">Passez la valeur NULL pour le paramètre _lpszPassword_ .</span><span class="sxs-lookup"><span data-stu-id="67cfc-131">Pass NULL for the  _lpszPassword_ parameter.</span></span> 
    
<span data-ttu-id="67cfc-132">Sessions non-messagerie permettent aux clients d’accéder à du sous-système MAPI, mais ne pas autorisent les messages envoyés ou reçus.</span><span class="sxs-lookup"><span data-stu-id="67cfc-132">Nonmessaging sessions allow clients to access the MAPI subsystem, but do not allow messages to be sent or received.</span></span> <span data-ttu-id="67cfc-133">Configuration ou l’administration des applications sont des exemples de clients qui devront d’établir des sessions non-messagerie.</span><span class="sxs-lookup"><span data-stu-id="67cfc-133">Configuration or administration applications are examples of clients that might need to establish nonmessaging sessions.</span></span> <span data-ttu-id="67cfc-134">Pour demander une session non-messagerie, définir l’indicateur MAPI_NO_MAIL.</span><span class="sxs-lookup"><span data-stu-id="67cfc-134">To request a nonmessaging session, set the MAPI_NO_MAIL flag.</span></span> <span data-ttu-id="67cfc-135">Définition de cet indicateur connecte votre client sans en informer le spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="67cfc-135">Setting this flag logs your client on without informing the MAPI spooler.</span></span> <span data-ttu-id="67cfc-136">Les clients qui se connectent à MAPI avec cet indicateur ne peut pas s’attendent jamais recevoir des rapports d’état de lecture.</span><span class="sxs-lookup"><span data-stu-id="67cfc-136">Clients that log on to MAPI with this flag cannot expect to ever receive read status reports.</span></span>
  
<span data-ttu-id="67cfc-137">L’indicateur MAPI_NO_MAIL doit uniquement être définie :</span><span class="sxs-lookup"><span data-stu-id="67cfc-137">The MAPI_NO_MAIL flag should only be set:</span></span>
  
- <span data-ttu-id="67cfc-138">Si votre client ne sera pas envoyer ou recevoir des messages pendant la session.</span><span class="sxs-lookup"><span data-stu-id="67cfc-138">If your client will not send or receive messages during the session.</span></span>
    
- <span data-ttu-id="67cfc-139">Si votre client possède le contrôle total sur le contenu du profil et les messages envoyés et reçus à l’aide d’étroitement couplés banque de messages et fournisseurs, tels que les fournisseurs de Microsoft Exchange de transport.</span><span class="sxs-lookup"><span data-stu-id="67cfc-139">If your client has complete control over the contents of the profile and messages are sent and received using tightly coupled message store and transport providers, such as the Microsoft Exchange providers.</span></span>
    
<span data-ttu-id="67cfc-140">Un client de messagerie peut partager une session avec un client non-messagerie.</span><span class="sxs-lookup"><span data-stu-id="67cfc-140">A messaging client can share a session with a nonmessaging client.</span></span> <span data-ttu-id="67cfc-141">Les caractéristiques d’un membre d’une session partagée ne sont pas affectés par les caractéristiques d’autres membres.</span><span class="sxs-lookup"><span data-stu-id="67cfc-141">The characteristics of one member of a shared session are not affected by the characteristics of other members.</span></span> <span data-ttu-id="67cfc-142">Autrement dit, si vous ouvrez une session avec l’ensemble d’indicateurs MAPI_NO_MAIL et MAPI_ALLOW_OTHERS, se connecter à votre session d’un client de messagerie n’a aucun effet sur le fonctionnement de votre client, et inversement.</span><span class="sxs-lookup"><span data-stu-id="67cfc-142">That is, if you log on with the MAPI_NO_MAIL and MAPI_ALLOW_OTHERS flags set, a messaging client logging on to your session has no affect on the operation of your client and vice versa.</span></span> <span data-ttu-id="67cfc-143">Le client de messagerie sera toujours en mesure d’envoyer et recevoir des messages et votre client ne le pourront pas.</span><span class="sxs-lookup"><span data-stu-id="67cfc-143">The messaging client will still be able to send and receive messages and your client will not.</span></span>
  
<span data-ttu-id="67cfc-144">**MAPILogonEx** définit quelques autres indicateurs que vous pouvez définir :</span><span class="sxs-lookup"><span data-stu-id="67cfc-144">**MAPILogonEx** defines a few other flags that you can set:</span></span> 
  
- <span data-ttu-id="67cfc-145">MAPI_FORCE_DOWNLOAD indique que les messages entrants doivent être téléchargées avant **MAPILogonEx** renvoie.</span><span class="sxs-lookup"><span data-stu-id="67cfc-145">MAPI_FORCE_DOWNLOAD indicates that incoming messages should be downloaded before **MAPILogonEx** returns.</span></span> <span data-ttu-id="67cfc-146">Ne pas cet indicateur provoque messages à télécharger en arrière-plan à une date ultérieure.</span><span class="sxs-lookup"><span data-stu-id="67cfc-146">Not setting this flag causes messages to be downloaded in the background at a later time.</span></span> 
    
- <span data-ttu-id="67cfc-147">MAPI_SERVICE_UI_ALWAYS demande que chaque service de message dans le profil d’afficher une boîte de dialogue de configuration.</span><span class="sxs-lookup"><span data-stu-id="67cfc-147">MAPI_SERVICE_UI_ALWAYS requests that every message service in the profile display a configuration dialog box.</span></span>
    
- <span data-ttu-id="67cfc-148">MAPI_NT_SERVICE indique que votre client est implémentée comme un service Windows.</span><span class="sxs-lookup"><span data-stu-id="67cfc-148">MAPI_NT_SERVICE indicates that your client is implemented as a Windows service.</span></span> <span data-ttu-id="67cfc-149">Cet indicateur doit être défini si votre client est un service.</span><span class="sxs-lookup"><span data-stu-id="67cfc-149">This flag must be set if your client is a service.</span></span>
    
<span data-ttu-id="67cfc-150">À chaque ouverture de session réussie, **MAPILogonEx** retourne un pointeur vers une session MAPI.</span><span class="sxs-lookup"><span data-stu-id="67cfc-150">With every successful logon, **MAPILogonEx** returns a pointer to a MAPI session.</span></span> <span data-ttu-id="67cfc-151">Vous pouvez utiliser ce pointeur pour appeler les méthodes de l’interface **IMAPISession** .</span><span class="sxs-lookup"><span data-stu-id="67cfc-151">You can use this pointer to call the methods of the **IMAPISession** interface.</span></span> <span data-ttu-id="67cfc-152">Pour plus d’informations, voir [IMAPISession : IUnknown](imapisessioniunknown.md).</span><span class="sxs-lookup"><span data-stu-id="67cfc-152">For more information, see [IMAPISession : IUnknown](imapisessioniunknown.md).</span></span> <span data-ttu-id="67cfc-153">Pointeurs de session, quel que soit le type de session, sont uniques pour les clients qui les reçoivent et ne sont pas valides entre les tâches.</span><span class="sxs-lookup"><span data-stu-id="67cfc-153">Session pointers, regardless of the type of session, are unique to the clients that receive them and are not valid across tasks.</span></span>
  

