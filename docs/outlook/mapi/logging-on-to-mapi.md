---
title: Connexion à MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419708"
---
# <a name="logging-on-to-mapi"></a><span data-ttu-id="b3524-103">Connexion à MAPI</span><span class="sxs-lookup"><span data-stu-id="b3524-103">Logging on to MAPI</span></span>
 
<span data-ttu-id="b3524-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="b3524-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="b3524-105">Les applications clientes se connectent au sous-système MAPI en appelant la **fonction MAPILogonEx.**</span><span class="sxs-lookup"><span data-stu-id="b3524-105">Client applications log on to the MAPI subsystem by calling the **MAPILogonEx** function.</span></span> <span data-ttu-id="b3524-106">Pour plus d’informations, [voir MAPILogonEx](mapilogonex.md).</span><span class="sxs-lookup"><span data-stu-id="b3524-106">For more information, see [MAPILogonEx](mapilogonex.md).</span></span> <span data-ttu-id="b3524-107">**MAPILogonEx valide** la sélection de profil et la configuration de chaque fournisseur de services dans le profil.</span><span class="sxs-lookup"><span data-stu-id="b3524-107">**MAPILogonEx** validates the profile selection and the configuration of each service provider in the profile.</span></span> <span data-ttu-id="b3524-108">Une fois configuré, MAPI démarre les fournisseurs de carnet d’adresses avant de démarrer les fournisseurs de magasins de messages.</span><span class="sxs-lookup"><span data-stu-id="b3524-108">Once configured, MAPI starts the address book providers before starting the message store providers.</span></span> <span data-ttu-id="b3524-109">Les fournisseurs de transport sont démarrés lorsque leurs services sont requis pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="b3524-109">Transport providers are started when their services are first required.</span></span> 
  
## <a name="choose-a-profile"></a><span data-ttu-id="b3524-110">Choisir un profil</span><span class="sxs-lookup"><span data-stu-id="b3524-110">Choose a profile</span></span>
  
- <span data-ttu-id="b3524-111">Passez une chaîne de caractères qui représente le nom du profil dans le paramètre  _lpszProfileName_ **à MAPILogonEx**, ou...</span><span class="sxs-lookup"><span data-stu-id="b3524-111">Pass in a character string that represents the name of the profile in the  _lpszProfileName_ parameter to **MAPILogonEx**, or...</span></span>
    
- <span data-ttu-id="b3524-112">Autorisez l’utilisateur à spécifier le profil en passant null dans le paramètre  _lpszProfileName_ et en paramétifiant l’indicateur MAPI_LOGON_UI, ou...</span><span class="sxs-lookup"><span data-stu-id="b3524-112">Allow the user to specify the profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_LOGON_UI flag, or...</span></span> 

- <span data-ttu-id="b3524-113">Sélectionnez le profil par défaut en passant la valeur NULL dans le paramètre  _lpszProfileName_ et en MAPI_USE_DEFAULT’indicateur.</span><span class="sxs-lookup"><span data-stu-id="b3524-113">Select the default profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_USE_DEFAULT flag.</span></span> 
    
<span data-ttu-id="b3524-114">Si vous avez besoin d’un profil spécifique autre que le profil par défaut, vous devez enregistrer son nom dans votre propre base de données de configuration ou utiliser une convention d’attribution de noms spécifique.</span><span class="sxs-lookup"><span data-stu-id="b3524-114">If you require a specific profile other than the default profile, you must save its name in your own configuration database or use a specific naming convention.</span></span> <span data-ttu-id="b3524-115">MAPI n’expose aucun attribut de profil autre que le nom et l’indicateur par défaut dans la table de profils, et l’indicateur de profil par défaut est réservé au client de messagerie et aux applications IPM associées.</span><span class="sxs-lookup"><span data-stu-id="b3524-115">MAPI does not expose any profile attributes other than the name and default flag in the profile table, and the default profile flag is reserved for messaging client and related IPM applications.</span></span>
  
<span data-ttu-id="b3524-116">Les clients qui fournissent des informations partielles sur la configuration du profil ou du fournisseur dans **MAPILogonEx** doivent fournir des données supplémentaires à l’utilisateur en permettant l’affichage d’une boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="b3524-116">Clients that supply partial profile or provider configuration information to **MAPILogonEx** must prompt the user for the additional data by allowing a dialog box to be displayed.</span></span> <span data-ttu-id="b3524-117">Si des informations sont manquantes et **que MAPILogonEx ne** peut pas invite l’utilisateur à les fournir, l’accès échoue.</span><span class="sxs-lookup"><span data-stu-id="b3524-117">If information is missing and **MAPILogonEx** cannot prompt the user to supply it, the logon fails.</span></span> <span data-ttu-id="b3524-118">Les clients qui n’ont pas besoin d’une entrée utilisateur peuvent supprimer l’affichage de la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="b3524-118">Clients that do not need user input can suppress the dialog box display.</span></span> 
  
<span data-ttu-id="b3524-119">Les indicateurs que **MAPILogonEx utilise** pour activer une interface utilisateur s’excluent mutuellement ; Une seule peut être définie.</span><span class="sxs-lookup"><span data-stu-id="b3524-119">The flags that **MAPILogonEx** uses to enable a user interface are mutually exclusive; only one can be set.</span></span> <span data-ttu-id="b3524-120">L’absence de ces indicateurs supprime l’affichage d’une interface utilisateur, ce qui entraîne l’échec de **MAPILogonEx** si des informations sont manquantes.</span><span class="sxs-lookup"><span data-stu-id="b3524-120">Leaving these flags unset suppresses the display of a user interface, causing **MAPILogonEx** to fail if necessary information is missing.</span></span> <span data-ttu-id="b3524-121">Autrement dit, si vous désactivez l’interface utilisateur et que vous passez la valeur NULL pour le paramètre  _lpszProfileName_ et que vous ne définissez pas l’indicateur MAPI_USE_DEFAULT, **MAPILogonEx** échoue car il ne peut pas récupérer un nom de profil.</span><span class="sxs-lookup"><span data-stu-id="b3524-121">That is, if you disable the user interface and pass NULL for the  _lpszProfileName_ parameter and do not set the MAPI_USE_DEFAULT flag, **MAPILogonEx** will fail because it cannot retrieve a profile name.</span></span> 
  
<span data-ttu-id="b3524-122">La session que **MAPILogonEx** établit peut être une session de messagerie individuelle, une session de messagerie partagée ou une session de non-recherche.</span><span class="sxs-lookup"><span data-stu-id="b3524-122">The session that **MAPILogonEx** establishes can be an individual messaging session, a shared messaging session, or a nonmessaging session.</span></span> <span data-ttu-id="b3524-123">Les sessions de messagerie individuelles sont des connexions privées entre votre client et le sous-système MAPI et peuvent être établies en fixant l’indicateur MAPI_NEW_SESSION dans l’appel à **MAPILogonEx**.</span><span class="sxs-lookup"><span data-stu-id="b3524-123">Individual messaging sessions are private connections between your client and the MAPI subsystem and can be established by setting the MAPI_NEW_SESSION flag in the call to **MAPILogonEx**.</span></span>
  
<span data-ttu-id="b3524-124">Les sessions de messagerie partagées sont des connexions que plusieurs clients de messagerie peuvent utiliser.</span><span class="sxs-lookup"><span data-stu-id="b3524-124">Shared messaging sessions are connections that multiple messaging clients can use.</span></span> <span data-ttu-id="b3524-125">Les sessions partagées sont généralement établies pour les clients qui utilisent le même profil.</span><span class="sxs-lookup"><span data-stu-id="b3524-125">Shared sessions are typically established for clients use the same profile.</span></span> <span data-ttu-id="b3524-126">Pour établir une nouvelle session en tant que session partagée, définissez l MAPI_ALLOW_OTHERS un indicateur.</span><span class="sxs-lookup"><span data-stu-id="b3524-126">To establish a new session as a shared session, set the MAPI_ALLOW_OTHERS flag.</span></span> 
  
## <a name="use-an-existing-shared-session"></a><span data-ttu-id="b3524-127">Utiliser une session partagée existante</span><span class="sxs-lookup"><span data-stu-id="b3524-127">Use an existing shared session</span></span>
  
- <span data-ttu-id="b3524-128">Ne définissez pas l’MAPI_NEW_SESSION de l’indicateur.</span><span class="sxs-lookup"><span data-stu-id="b3524-128">Do not set the MAPI_NEW_SESSION flag.</span></span>
    
- <span data-ttu-id="b3524-129">Ne définissez pas l’MAPI_ALLOW_OTHERS de l’indicateur.</span><span class="sxs-lookup"><span data-stu-id="b3524-129">Do not set the MAPI_ALLOW_OTHERS flag.</span></span>
    
- <span data-ttu-id="b3524-130">Passez NULL pour le _paramètre lpszProfileName._</span><span class="sxs-lookup"><span data-stu-id="b3524-130">Pass NULL for the  _lpszProfileName_ parameter.</span></span> 
    
- <span data-ttu-id="b3524-131">Passez NULL pour le _paramètre lpszPassword._</span><span class="sxs-lookup"><span data-stu-id="b3524-131">Pass NULL for the  _lpszPassword_ parameter.</span></span> 
    
<span data-ttu-id="b3524-132">Les sessions de non-recherche permettent aux clients d’accéder au sous-système MAPI, mais n’autorisent pas l’envoi ou la réception de messages.</span><span class="sxs-lookup"><span data-stu-id="b3524-132">Nonmessaging sessions allow clients to access the MAPI subsystem, but do not allow messages to be sent or received.</span></span> <span data-ttu-id="b3524-133">Les applications de configuration ou d’administration sont des exemples de clients qui peuvent avoir besoin d’établir des sessions de non-recherche.</span><span class="sxs-lookup"><span data-stu-id="b3524-133">Configuration or administration applications are examples of clients that might need to establish nonmessaging sessions.</span></span> <span data-ttu-id="b3524-134">Pour demander une session de non-recherche, définissez l’MAPI_NO_MAIL de recherche.</span><span class="sxs-lookup"><span data-stu-id="b3524-134">To request a nonmessaging session, set the MAPI_NO_MAIL flag.</span></span> <span data-ttu-id="b3524-135">La définition de cet indicateur connecte votre client sans en informer lepooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="b3524-135">Setting this flag logs your client on without informing the MAPI spooler.</span></span> <span data-ttu-id="b3524-136">Les clients qui se connectent à MAPI avec cet indicateur ne peuvent pas s’attendre à recevoir des rapports d’état de lecture.</span><span class="sxs-lookup"><span data-stu-id="b3524-136">Clients that log on to MAPI with this flag cannot expect to ever receive read status reports.</span></span>
  
<span data-ttu-id="b3524-137">L MAPI_NO_MAIL de contrôle doit uniquement être définie :</span><span class="sxs-lookup"><span data-stu-id="b3524-137">The MAPI_NO_MAIL flag should only be set:</span></span>
  
- <span data-ttu-id="b3524-138">Si votre client n’envoie ou ne reçoit pas de messages pendant la session.</span><span class="sxs-lookup"><span data-stu-id="b3524-138">If your client will not send or receive messages during the session.</span></span>
    
- <span data-ttu-id="b3524-139">Si votre client dispose d’un contrôle total sur le contenu du profil et que les messages sont envoyés et reçus à l’aide de fournisseurs de transport et de magasin de messages étroitement couplés, tels que les fournisseurs Microsoft Exchange.</span><span class="sxs-lookup"><span data-stu-id="b3524-139">If your client has complete control over the contents of the profile and messages are sent and received using tightly coupled message store and transport providers, such as the Microsoft Exchange providers.</span></span>
    
<span data-ttu-id="b3524-140">Un client de messagerie peut partager une session avec un client qui n’est pas un client de messagerie.</span><span class="sxs-lookup"><span data-stu-id="b3524-140">A messaging client can share a session with a nonmessaging client.</span></span> <span data-ttu-id="b3524-141">Les caractéristiques d’un membre d’une session partagée ne sont pas affectées par les caractéristiques des autres membres.</span><span class="sxs-lookup"><span data-stu-id="b3524-141">The characteristics of one member of a shared session are not affected by the characteristics of other members.</span></span> <span data-ttu-id="b3524-142">Autrement dit, si vous vous connectez avec les indicateurs MAPI_NO_MAIL et MAPI_ALLOW_OTHERS, une connexion du client de messagerie à votre session n’a aucune incidence sur le fonctionnement de votre client et inversement.</span><span class="sxs-lookup"><span data-stu-id="b3524-142">That is, if you log on with the MAPI_NO_MAIL and MAPI_ALLOW_OTHERS flags set, a messaging client logging on to your session has no affect on the operation of your client and vice versa.</span></span> <span data-ttu-id="b3524-143">Le client de messagerie sera toujours en mesure d’envoyer et de recevoir des messages, mais pas votre client.</span><span class="sxs-lookup"><span data-stu-id="b3524-143">The messaging client will still be able to send and receive messages and your client will not.</span></span>
  
<span data-ttu-id="b3524-144">**MAPILogonEx** définit quelques autres indicateurs que vous pouvez définir :</span><span class="sxs-lookup"><span data-stu-id="b3524-144">**MAPILogonEx** defines a few other flags that you can set:</span></span> 
  
- <span data-ttu-id="b3524-145">MAPI_FORCE_DOWNLOAD indique que les messages entrants doivent être téléchargés avant le retour **de MAPILogonEx.**</span><span class="sxs-lookup"><span data-stu-id="b3524-145">MAPI_FORCE_DOWNLOAD indicates that incoming messages should be downloaded before **MAPILogonEx** returns.</span></span> <span data-ttu-id="b3524-146">Le fait de ne pas définir cet indicateur entraîne le téléchargement ultérieur des messages en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="b3524-146">Not setting this flag causes messages to be downloaded in the background at a later time.</span></span> 
    
- <span data-ttu-id="b3524-147">MAPI_SERVICE_UI_ALWAYS demande à chaque service de message du profil d’afficher une boîte de dialogue de configuration.</span><span class="sxs-lookup"><span data-stu-id="b3524-147">MAPI_SERVICE_UI_ALWAYS requests that every message service in the profile display a configuration dialog box.</span></span>
    
- <span data-ttu-id="b3524-148">MAPI_NT_SERVICE indique que votre client est implémenté en tant que service Windows client.</span><span class="sxs-lookup"><span data-stu-id="b3524-148">MAPI_NT_SERVICE indicates that your client is implemented as a Windows service.</span></span> <span data-ttu-id="b3524-149">Cet indicateur doit être définie si votre client est un service.</span><span class="sxs-lookup"><span data-stu-id="b3524-149">This flag must be set if your client is a service.</span></span>
    
<span data-ttu-id="b3524-150">À chaque ouverture de session réussie, **MAPILogonEx renvoie** un pointeur vers une session MAPI.</span><span class="sxs-lookup"><span data-stu-id="b3524-150">With every successful logon, **MAPILogonEx** returns a pointer to a MAPI session.</span></span> <span data-ttu-id="b3524-151">Vous pouvez utiliser ce pointeur pour appeler les méthodes de l’interface **IMAPISession.**</span><span class="sxs-lookup"><span data-stu-id="b3524-151">You can use this pointer to call the methods of the **IMAPISession** interface.</span></span> <span data-ttu-id="b3524-152">Pour plus d’informations, [voir IMAPISession : IUnknown](imapisessioniunknown.md).</span><span class="sxs-lookup"><span data-stu-id="b3524-152">For more information, see [IMAPISession : IUnknown](imapisessioniunknown.md).</span></span> <span data-ttu-id="b3524-153">Les pointeurs de session, quel que soit le type de session, sont propres aux clients qui les reçoivent et ne sont pas valides pour toutes les tâches.</span><span class="sxs-lookup"><span data-stu-id="b3524-153">Session pointers, regardless of the type of session, are unique to the clients that receive them and are not valid across tasks.</span></span>
  

