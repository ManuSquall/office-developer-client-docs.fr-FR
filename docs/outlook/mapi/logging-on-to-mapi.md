---
title: Connexion à MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419708"
---
# <a name="logging-on-to-mapi"></a><span data-ttu-id="d54d6-103">Connexion à MAPI</span><span class="sxs-lookup"><span data-stu-id="d54d6-103">Logging on to MAPI</span></span>
 
<span data-ttu-id="d54d6-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="d54d6-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="d54d6-105">Les applications clientes se connectent au sous-système MAPI en appelant la fonction **MAPILogonEx** .</span><span class="sxs-lookup"><span data-stu-id="d54d6-105">Client applications log on to the MAPI subsystem by calling the **MAPILogonEx** function.</span></span> <span data-ttu-id="d54d6-106">Pour plus d'informations, consultez la rubrique [MAPILogonEx](mapilogonex.md).</span><span class="sxs-lookup"><span data-stu-id="d54d6-106">For more information, see [MAPILogonEx](mapilogonex.md).</span></span> <span data-ttu-id="d54d6-107">**MAPILogonEx** valide la sélection de profil et la configuration de chaque fournisseur de services dans le profil.</span><span class="sxs-lookup"><span data-stu-id="d54d6-107">**MAPILogonEx** validates the profile selection and the configuration of each service provider in the profile.</span></span> <span data-ttu-id="d54d6-108">Une fois configuré, MAPI démarre les fournisseurs de carnets d'adresses avant de démarrer les fournisseurs de banques de messages.</span><span class="sxs-lookup"><span data-stu-id="d54d6-108">Once configured, MAPI starts the address book providers before starting the message store providers.</span></span> <span data-ttu-id="d54d6-109">Les fournisseurs de transport sont démarrés lorsque leurs services sont requis pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="d54d6-109">Transport providers are started when their services are first required.</span></span> 
  
## <a name="choose-a-profile"></a><span data-ttu-id="d54d6-110">Choisir un profil</span><span class="sxs-lookup"><span data-stu-id="d54d6-110">Choose a profile</span></span>
  
- <span data-ttu-id="d54d6-111">TransMettez une chaîne de caractères qui représente le nom du profil dans le paramètre _lpszProfileName_ à **MAPILogonEx**, ou...</span><span class="sxs-lookup"><span data-stu-id="d54d6-111">Pass in a character string that represents the name of the profile in the  _lpszProfileName_ parameter to **MAPILogonEx**, or...</span></span>
    
- <span data-ttu-id="d54d6-112">Autoriser l'utilisateur à spécifier le profil en passant NULL dans le paramètre _lpszProfileName_ et en définissant l'indicateur MAPI_LOGON_UI, ou...</span><span class="sxs-lookup"><span data-stu-id="d54d6-112">Allow the user to specify the profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_LOGON_UI flag, or...</span></span> 

- <span data-ttu-id="d54d6-113">Sélectionnez le profil par défaut en transmettant NULL dans le paramètre _lpszProfileName_ et en définissant l'indicateur MAPI_USE_DEFAULT.</span><span class="sxs-lookup"><span data-stu-id="d54d6-113">Select the default profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_USE_DEFAULT flag.</span></span> 
    
<span data-ttu-id="d54d6-114">Si vous avez besoin d'un profil spécifique autre que le profil par défaut, vous devez enregistrer son nom dans votre propre base de données de configuration ou utiliser une convention d'affectation de noms spécifique.</span><span class="sxs-lookup"><span data-stu-id="d54d6-114">If you require a specific profile other than the default profile, you must save its name in your own configuration database or use a specific naming convention.</span></span> <span data-ttu-id="d54d6-115">MAPI n'expose pas d'attributs de profil autres que le nom et l'indicateur par défaut dans la table de profils, et l'indicateur de profil par défaut est réservé pour le client de messagerie et les applications IPM associées.</span><span class="sxs-lookup"><span data-stu-id="d54d6-115">MAPI does not expose any profile attributes other than the name and default flag in the profile table, and the default profile flag is reserved for messaging client and related IPM applications.</span></span>
  
<span data-ttu-id="d54d6-116">Les clients qui fournissent des informations de configuration de fournisseur ou de profil partiel à **MAPILogonEx** doivent inviter l'utilisateur à entrer les données supplémentaires en autorisant l'affichage d'une boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="d54d6-116">Clients that supply partial profile or provider configuration information to **MAPILogonEx** must prompt the user for the additional data by allowing a dialog box to be displayed.</span></span> <span data-ttu-id="d54d6-117">Si des informations sont manquantes et que **MAPILogonEx** ne peut pas inviter l'utilisateur à le fournir, la connexion échoue.</span><span class="sxs-lookup"><span data-stu-id="d54d6-117">If information is missing and **MAPILogonEx** cannot prompt the user to supply it, the logon fails.</span></span> <span data-ttu-id="d54d6-118">Les clients qui n'ont pas besoin d'entrer l'utilisateur peuvent supprimer l'affichage de la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="d54d6-118">Clients that do not need user input can suppress the dialog box display.</span></span> 
  
<span data-ttu-id="d54d6-119">Les indicateurs utilisés par **MAPILogonEx** pour activer une interface utilisateur s'excluent mutuellement; une seule peut être définie.</span><span class="sxs-lookup"><span data-stu-id="d54d6-119">The flags that **MAPILogonEx** uses to enable a user interface are mutually exclusive; only one can be set.</span></span> <span data-ttu-id="d54d6-120">Le fait de ne pas affecter ces indicateurs supprime l'affichage d'une interface utilisateur, provoquant l'échec de **MAPILogonEx** si des informations nécessaires sont manquantes.</span><span class="sxs-lookup"><span data-stu-id="d54d6-120">Leaving these flags unset suppresses the display of a user interface, causing **MAPILogonEx** to fail if necessary information is missing.</span></span> <span data-ttu-id="d54d6-121">Autrement dit, si vous désactivez l'interface utilisateur et transmettez la valeur NULL pour le paramètre _lpszProfileName_ et que vous ne définissez pas l'indicateur MAPI_USE_DEFAULT, **MAPILogonEx** échoue car il ne peut pas récupérer un nom de profil.</span><span class="sxs-lookup"><span data-stu-id="d54d6-121">That is, if you disable the user interface and pass NULL for the  _lpszProfileName_ parameter and do not set the MAPI_USE_DEFAULT flag, **MAPILogonEx** will fail because it cannot retrieve a profile name.</span></span> 
  
<span data-ttu-id="d54d6-122">La session que **MAPILogonEx** établit peut être une session de messagerie individuelle, une session de messagerie partagée ou une session de non-messagerie.</span><span class="sxs-lookup"><span data-stu-id="d54d6-122">The session that **MAPILogonEx** establishes can be an individual messaging session, a shared messaging session, or a nonmessaging session.</span></span> <span data-ttu-id="d54d6-123">Les sessions de messagerie individuelles sont des connexions privées entre votre client et le sous-système MAPI et peuvent être établies en définissant l'indicateur MAPI_NEW_SESSION dans l'appel à **MAPILogonEx**.</span><span class="sxs-lookup"><span data-stu-id="d54d6-123">Individual messaging sessions are private connections between your client and the MAPI subsystem and can be established by setting the MAPI_NEW_SESSION flag in the call to **MAPILogonEx**.</span></span>
  
<span data-ttu-id="d54d6-124">Les sessions de messagerie partagées sont des connexions que plusieurs clients de messagerie peuvent utiliser.</span><span class="sxs-lookup"><span data-stu-id="d54d6-124">Shared messaging sessions are connections that multiple messaging clients can use.</span></span> <span data-ttu-id="d54d6-125">Les sessions partagées sont généralement établies pour les clients qui utilisent le même profil.</span><span class="sxs-lookup"><span data-stu-id="d54d6-125">Shared sessions are typically established for clients use the same profile.</span></span> <span data-ttu-id="d54d6-126">Pour établir une nouvelle session en tant que session partagée, définissez l'indicateur MAPI_ALLOW_OTHERS.</span><span class="sxs-lookup"><span data-stu-id="d54d6-126">To establish a new session as a shared session, set the MAPI_ALLOW_OTHERS flag.</span></span> 
  
## <a name="use-an-existing-shared-session"></a><span data-ttu-id="d54d6-127">Utiliser une session partagée existante</span><span class="sxs-lookup"><span data-stu-id="d54d6-127">Use an existing shared session</span></span>
  
- <span data-ttu-id="d54d6-128">Ne définissez pas l'indicateur MAPI_NEW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="d54d6-128">Do not set the MAPI_NEW_SESSION flag.</span></span>
    
- <span data-ttu-id="d54d6-129">Ne définissez pas l'indicateur MAPI_ALLOW_OTHERS.</span><span class="sxs-lookup"><span data-stu-id="d54d6-129">Do not set the MAPI_ALLOW_OTHERS flag.</span></span>
    
- <span data-ttu-id="d54d6-130">Transmettre NULL pour le paramètre _lpszProfileName_ .</span><span class="sxs-lookup"><span data-stu-id="d54d6-130">Pass NULL for the  _lpszProfileName_ parameter.</span></span> 
    
- <span data-ttu-id="d54d6-131">Transmettre NULL pour le paramètre _lpszPassword_ .</span><span class="sxs-lookup"><span data-stu-id="d54d6-131">Pass NULL for the  _lpszPassword_ parameter.</span></span> 
    
<span data-ttu-id="d54d6-132">Les sessions non de messagerie permettent aux clients d'accéder au sous-système MAPI, mais n'autorisent pas l'envoi ou la réception de messages.</span><span class="sxs-lookup"><span data-stu-id="d54d6-132">Nonmessaging sessions allow clients to access the MAPI subsystem, but do not allow messages to be sent or received.</span></span> <span data-ttu-id="d54d6-133">Les applications de configuration ou d'administration sont des clients qui peuvent avoir besoin d'établir des sessions autres que des sessions de messagerie.</span><span class="sxs-lookup"><span data-stu-id="d54d6-133">Configuration or administration applications are examples of clients that might need to establish nonmessaging sessions.</span></span> <span data-ttu-id="d54d6-134">Pour demander une session non de messagerie, définissez l'indicateur MAPI_NO_MAIL.</span><span class="sxs-lookup"><span data-stu-id="d54d6-134">To request a nonmessaging session, set the MAPI_NO_MAIL flag.</span></span> <span data-ttu-id="d54d6-135">La définition de cet indicateur déconnecte votre client sans informer le spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="d54d6-135">Setting this flag logs your client on without informing the MAPI spooler.</span></span> <span data-ttu-id="d54d6-136">Les clients qui se connectent à MAPI avec cet indicateur ne peuvent pas s'attendre à recevoir des rapports d'état de lecture.</span><span class="sxs-lookup"><span data-stu-id="d54d6-136">Clients that log on to MAPI with this flag cannot expect to ever receive read status reports.</span></span>
  
<span data-ttu-id="d54d6-137">L'indicateur MAPI_NO_MAIL doit être défini uniquement:</span><span class="sxs-lookup"><span data-stu-id="d54d6-137">The MAPI_NO_MAIL flag should only be set:</span></span>
  
- <span data-ttu-id="d54d6-138">Si votre client n'envoie pas ou ne reçoit pas de messages pendant la session.</span><span class="sxs-lookup"><span data-stu-id="d54d6-138">If your client will not send or receive messages during the session.</span></span>
    
- <span data-ttu-id="d54d6-139">Si votre client dispose d'un contrôle total sur le contenu du profil et que les messages sont envoyés et reçus à l'aide de banques de messages et de fournisseurs de transport étroitement couplés, tels que les fournisseurs Microsoft Exchange.</span><span class="sxs-lookup"><span data-stu-id="d54d6-139">If your client has complete control over the contents of the profile and messages are sent and received using tightly coupled message store and transport providers, such as the Microsoft Exchange providers.</span></span>
    
<span data-ttu-id="d54d6-140">Un client de messagerie peut partager une session avec un client non de messagerie.</span><span class="sxs-lookup"><span data-stu-id="d54d6-140">A messaging client can share a session with a nonmessaging client.</span></span> <span data-ttu-id="d54d6-141">Les caractéristiques d'un membre d'une session partagée ne sont pas affectées par les caractéristiques d'autres membres.</span><span class="sxs-lookup"><span data-stu-id="d54d6-141">The characteristics of one member of a shared session are not affected by the characteristics of other members.</span></span> <span data-ttu-id="d54d6-142">Autrement dit, si vous vous connectez avec les indicateurs MAPI_NO_MAIL et MAPI_ALLOW_OTHERS définis, un client de messagerie qui se connecte à votre session n'a aucun effet sur le fonctionnement de votre client et inversement.</span><span class="sxs-lookup"><span data-stu-id="d54d6-142">That is, if you log on with the MAPI_NO_MAIL and MAPI_ALLOW_OTHERS flags set, a messaging client logging on to your session has no affect on the operation of your client and vice versa.</span></span> <span data-ttu-id="d54d6-143">Le client de messagerie pourra toujours envoyer et recevoir des messages et votre client ne le sera pas.</span><span class="sxs-lookup"><span data-stu-id="d54d6-143">The messaging client will still be able to send and receive messages and your client will not.</span></span>
  
<span data-ttu-id="d54d6-144">**MAPILogonEx** définit quelques autres indicateurs que vous pouvez définir:</span><span class="sxs-lookup"><span data-stu-id="d54d6-144">**MAPILogonEx** defines a few other flags that you can set:</span></span> 
  
- <span data-ttu-id="d54d6-145">MAPI_FORCE_DOWNLOAD indique que les messages entrants doivent être téléchargés avant le renvoi de **MAPILogonEx** .</span><span class="sxs-lookup"><span data-stu-id="d54d6-145">MAPI_FORCE_DOWNLOAD indicates that incoming messages should be downloaded before **MAPILogonEx** returns.</span></span> <span data-ttu-id="d54d6-146">Si vous ne définissez pas cet indicateur, les messages sont téléchargés en arrière-plan ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="d54d6-146">Not setting this flag causes messages to be downloaded in the background at a later time.</span></span> 
    
- <span data-ttu-id="d54d6-147">MAPI_SERVICE_UI_ALWAYS demande que chaque service de messagerie dans le profil affiche une boîte de dialogue de configuration.</span><span class="sxs-lookup"><span data-stu-id="d54d6-147">MAPI_SERVICE_UI_ALWAYS requests that every message service in the profile display a configuration dialog box.</span></span>
    
- <span data-ttu-id="d54d6-148">MAPI_NT_SERVICE indique que votre client est implémenté en tant que service Windows.</span><span class="sxs-lookup"><span data-stu-id="d54d6-148">MAPI_NT_SERVICE indicates that your client is implemented as a Windows service.</span></span> <span data-ttu-id="d54d6-149">Cet indicateur doit être défini si votre client est un service.</span><span class="sxs-lookup"><span data-stu-id="d54d6-149">This flag must be set if your client is a service.</span></span>
    
<span data-ttu-id="d54d6-150">Avec chaque ouverture de session réussie, **MAPILogonEx** renvoie un pointeur vers une session MAPI.</span><span class="sxs-lookup"><span data-stu-id="d54d6-150">With every successful logon, **MAPILogonEx** returns a pointer to a MAPI session.</span></span> <span data-ttu-id="d54d6-151">Vous pouvez utiliser ce pointeur pour appeler les méthodes de l'interface **IMAPISession** .</span><span class="sxs-lookup"><span data-stu-id="d54d6-151">You can use this pointer to call the methods of the **IMAPISession** interface.</span></span> <span data-ttu-id="d54d6-152">Pour plus d'informations, consultez la rubrique [IMAPISession: IUnknown](imapisessioniunknown.md).</span><span class="sxs-lookup"><span data-stu-id="d54d6-152">For more information, see [IMAPISession : IUnknown](imapisessioniunknown.md).</span></span> <span data-ttu-id="d54d6-153">Les pointeurs de session, quel que soit le type de session, sont propres aux clients qui les reçoivent et ne sont pas valides dans les tâches.</span><span class="sxs-lookup"><span data-stu-id="d54d6-153">Session pointers, regardless of the type of session, are unique to the clients that receive them and are not valid across tasks.</span></span>
  

