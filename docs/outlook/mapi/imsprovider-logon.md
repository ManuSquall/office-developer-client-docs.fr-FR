---
title: IMSProviderLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMSProvider.Logon
api_type:
- COM
ms.assetid: 890d9cbe-3570-4cf0-aeae-667c0e5ba181
description: 'Derniére modification : samedi 23 juillet 2011'
ms.openlocfilehash: 9c7f62c69c7a06f7ca0e4bfddcf789cddc536ea6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32309666"
---
# <a name="imsproviderlogon"></a><span data-ttu-id="82f9d-103">IMSProvider::Logon</span><span class="sxs-lookup"><span data-stu-id="82f9d-103">IMSProvider::Logon</span></span>

  
  
<span data-ttu-id="82f9d-104">**S’applique à** : Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="82f9d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="82f9d-105">Connecte MAPI à une instance d’un fournisseur de magasins de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-105">Logs MAPI on to one instance of a message store provider.</span></span>
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulFlags,
  LPCIID lpInterface,
  ULONG FAR * lpcbSpoolSecurity,
  LPBYTE FAR * lppbSpoolSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPMSLOGON FAR * lppMSLogon,
  LPMDB FAR * lppMDB
);
```

## <a name="parameters"></a><span data-ttu-id="82f9d-106">Parameters</span><span class="sxs-lookup"><span data-stu-id="82f9d-106">Parameters</span></span>

 <span data-ttu-id="82f9d-107">_lpMAPISup_</span><span class="sxs-lookup"><span data-stu-id="82f9d-107">_lpMAPISup_</span></span>
  
> <span data-ttu-id="82f9d-108">[in] Pointeur vers l’objet de support MAPI actuel pour la magasin de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-108">[in] A pointer to the current MAPI support object for the message store.</span></span>
    
 <span data-ttu-id="82f9d-109">_ulUIParam_</span><span class="sxs-lookup"><span data-stu-id="82f9d-109">_ulUIParam_</span></span>
  
> <span data-ttu-id="82f9d-110">[in] Poignée vers la fenêtre parente de toutes les boîtes de dialogue ou fenêtres affichées par cette méthode.</span><span class="sxs-lookup"><span data-stu-id="82f9d-110">[in] A handle to the parent window of any dialog boxes or windows this method displays.</span></span> 
    
 <span data-ttu-id="82f9d-111">_lpszProfileName_</span><span class="sxs-lookup"><span data-stu-id="82f9d-111">_lpszProfileName_</span></span>
  
> <span data-ttu-id="82f9d-112">[in] Pointeur vers une chaîne qui contient le nom du profil utilisé pour l’ouverture de page du fournisseur de magasins.</span><span class="sxs-lookup"><span data-stu-id="82f9d-112">[in] A pointer to a string that contains the name of the profile being used for store provider logon.</span></span> <span data-ttu-id="82f9d-113">Cette chaîne peut être affichée dans des boîtes de dialogue, écrite dans un fichier journal ou simplement ignorée.</span><span class="sxs-lookup"><span data-stu-id="82f9d-113">This string can be displayed in dialog boxes, written out to a log file, or simply ignored.</span></span> <span data-ttu-id="82f9d-114">Elle doit être au format Unicode si l’MAPI_UNICODE est définie dans le _paramètre ulFlags._</span><span class="sxs-lookup"><span data-stu-id="82f9d-114">It must be in Unicode format if the MAPI_UNICODE flag is set in the  _ulFlags_ parameter.</span></span> 
    
 <span data-ttu-id="82f9d-115">_cbEntryID_</span><span class="sxs-lookup"><span data-stu-id="82f9d-115">_cbEntryID_</span></span>
  
> <span data-ttu-id="82f9d-116">[in] Taille, en octets, de l’identificateur d’entrée pointé par _le paramètre lpEntryID._</span><span class="sxs-lookup"><span data-stu-id="82f9d-116">[in] The size, in bytes, of the entry identifier pointed to by the  _lpEntryID_ parameter.</span></span> 
    
 <span data-ttu-id="82f9d-117">_lpEntryID_</span><span class="sxs-lookup"><span data-stu-id="82f9d-117">_lpEntryID_</span></span>
  
> <span data-ttu-id="82f9d-118">[in] Pointeur vers l’identificateur d’entrée de la boutique de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-118">[in] A pointer to the entry identifier for the message store.</span></span> <span data-ttu-id="82f9d-119">La transmission de la valeur **null** dans  _lpEntryID_ indique qu’une magasin de messages n’a pas encore été sélectionnée et que les boîtes de dialogue qui permettent à l’utilisateur de sélectionner une magasin de messages peuvent être présentées.</span><span class="sxs-lookup"><span data-stu-id="82f9d-119">Passing **null** in  _lpEntryID_ indicates that a message store has not yet been selected and that dialog boxes that enable the user to select a message store can be presented.</span></span> 
    
 <span data-ttu-id="82f9d-120">_ulFlags_</span><span class="sxs-lookup"><span data-stu-id="82f9d-120">_ulFlags_</span></span>
  
> <span data-ttu-id="82f9d-121">[in] Masque de bits d’indicateurs qui contrôle l’utilisation de la logon.</span><span class="sxs-lookup"><span data-stu-id="82f9d-121">[in] A bitmask of flags that controls how the logon is performed.</span></span> <span data-ttu-id="82f9d-122">Les indicateurs suivants peuvent être définies :</span><span class="sxs-lookup"><span data-stu-id="82f9d-122">The following flags can be set:</span></span>
    
<span data-ttu-id="82f9d-123">MAPI_DEFERRED_ERRORS</span><span class="sxs-lookup"><span data-stu-id="82f9d-123">MAPI_DEFERRED_ERRORS</span></span> 
  
> <span data-ttu-id="82f9d-124">L’appel est autorisé à réussir même si l’objet sous-jacent n’est pas disponible pour l’implémentation de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="82f9d-124">The call is allowed to succeed even if the underlying object is not available to the calling implementation.</span></span> <span data-ttu-id="82f9d-125">Si l’objet n’est pas disponible, un appel ultérieur à l’objet peut occasioner une erreur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-125">If the object is not available, a subsequent call to the object might raise an error.</span></span>
    
<span data-ttu-id="82f9d-126">MAPI_UNICODE</span><span class="sxs-lookup"><span data-stu-id="82f9d-126">MAPI_UNICODE</span></span> 
  
> <span data-ttu-id="82f9d-127">Les chaînes transmises sont au format Unicode.</span><span class="sxs-lookup"><span data-stu-id="82f9d-127">The passed-in strings are in Unicode format.</span></span> <span data-ttu-id="82f9d-128">Si MAPI_UNICODE n’est pas définie, les chaînes sont au format ANSI.</span><span class="sxs-lookup"><span data-stu-id="82f9d-128">If MAPI_UNICODE is not set, the strings are in ANSI format.</span></span>
    
<span data-ttu-id="82f9d-129">MDB_NO_DIALOG</span><span class="sxs-lookup"><span data-stu-id="82f9d-129">MDB_NO_DIALOG</span></span> 
  
> <span data-ttu-id="82f9d-130">Empêche l’affichage des boîtes de dialogue d’affichage.</span><span class="sxs-lookup"><span data-stu-id="82f9d-130">Prevents the display of logon dialog boxes.</span></span> <span data-ttu-id="82f9d-131">Si cet indicateur est définie, la valeur d’MAPI_E_LOGON_FAILED’erreur est renvoyée si l’échec de la logon.</span><span class="sxs-lookup"><span data-stu-id="82f9d-131">If this flag is set, the error value MAPI_E_LOGON_FAILED is returned if the logon is unsuccessful.</span></span> <span data-ttu-id="82f9d-132">Si cet indicateur n’est pas définie, le fournisseur de la boutique de messages peut inviter l’utilisateur à corriger un nom ou un mot de passe, à insérer un disque ou à effectuer d’autres actions nécessaires pour établir une connexion à la boutique.</span><span class="sxs-lookup"><span data-stu-id="82f9d-132">If this flag is not set, the message store provider can prompt the user to correct a name or password, to insert a disk, or to perform other actions that are necessary to establish connection to the store.</span></span>
    
<span data-ttu-id="82f9d-133">MDB_NO_MAIL</span><span class="sxs-lookup"><span data-stu-id="82f9d-133">MDB_NO_MAIL</span></span> 
  
> <span data-ttu-id="82f9d-134">La magasin de messages ne doit pas être utilisée pour envoyer ou recevoir des messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-134">The message store should not be used for sending or receiving mail.</span></span> <span data-ttu-id="82f9d-135">L’indicateur indique à MAPI de ne pas informer lepooler MAPI que cette magasin de messages est en cours d’ouverture.</span><span class="sxs-lookup"><span data-stu-id="82f9d-135">The flag signals MAPI not to notify the MAPI spooler that this message store is being opened.</span></span> <span data-ttu-id="82f9d-136">Si cet indicateur est définie et que la magasin de messages est étroitement associée à un fournisseur de transport, le fournisseur n’a pas besoin d’appeler la méthode [IMAPISupport::SpoolerNotify.](imapisupport-spoolernotify.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-136">If this flag is set and the message store is tightly coupled with a transport provider, the provider does not need to call the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method.</span></span> 
    
<span data-ttu-id="82f9d-137">MDB_TEMPORARY</span><span class="sxs-lookup"><span data-stu-id="82f9d-137">MDB_TEMPORARY</span></span> 
  
> <span data-ttu-id="82f9d-138">Logs on the store so that information can be retrieved programmatically from the profile section, without use of dialog boxes.</span><span class="sxs-lookup"><span data-stu-id="82f9d-138">Logs on the store so that information can be retrieved programmatically from the profile section, without use of dialog boxes.</span></span> <span data-ttu-id="82f9d-139">Cet indicateur indique à MAPI que la boutique ne doit pas être ajoutée à la table de la boutique de messages et que la boutique ne peut pas être rendue permanente.</span><span class="sxs-lookup"><span data-stu-id="82f9d-139">This flag instructs MAPI that the store is not to be added to the message store table and that the store cannot be made permanent.</span></span> <span data-ttu-id="82f9d-140">Si cet indicateur est définie, les fournisseurs de magasins de messages n’ont pas besoin d’appeler la méthode [IMAPISupport::ModifyProfile.](imapisupport-modifyprofile.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-140">If this flag is set, message store providers do not need to call the [IMAPISupport::ModifyProfile](imapisupport-modifyprofile.md) method.</span></span> 
    
<span data-ttu-id="82f9d-141">MDB_WRITE</span><span class="sxs-lookup"><span data-stu-id="82f9d-141">MDB_WRITE</span></span> 
  
> <span data-ttu-id="82f9d-142">Demande une autorisation de lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="82f9d-142">Requests read/write permission.</span></span>
    
 <span data-ttu-id="82f9d-143">_lpInterface_</span><span class="sxs-lookup"><span data-stu-id="82f9d-143">_lpInterface_</span></span>
  
> <span data-ttu-id="82f9d-144">[in] Pointeur vers l’identificateur d’interface (IID) de connexion à la boutique de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-144">[in] A pointer to the interface identifier (IID) for the message store to log on to.</span></span> <span data-ttu-id="82f9d-145">La **transmission de la** valeur null indique que l’interface MAPI pour la magasin de messages ( [IMsgStore](imsgstoreimapiprop.md)) est renvoyée.</span><span class="sxs-lookup"><span data-stu-id="82f9d-145">Passing **null** indicates the MAPI interface for the message store ( [IMsgStore](imsgstoreimapiprop.md)) is returned.</span></span> <span data-ttu-id="82f9d-146">Le  _paramètre lpInterface_ peut également être définie sur un identificateur pour une interface appropriée pour la boutique de messages (par exemple, IID_IUnknown ou IID_IMAPIProp).</span><span class="sxs-lookup"><span data-stu-id="82f9d-146">The  _lpInterface_ parameter can also be set to an identifier for an appropriate interface for the message store (for example, IID_IUnknown or IID_IMAPIProp).</span></span> 
    
 <span data-ttu-id="82f9d-147">_lpcbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="82f9d-147">_lpcbSpoolSecurity_</span></span>
  
> <span data-ttu-id="82f9d-148">[out] Pointeur vers la variable dans laquelle le fournisseur de magasins renvoie la taille, en octets, des données de validation dans le paramètre _lppbSpoolSecurity._</span><span class="sxs-lookup"><span data-stu-id="82f9d-148">[out] A pointer to the variable in which the store provider returns the size, in bytes, of the validation data in the  _lppbSpoolSecurity_ parameter.</span></span> 
    
 <span data-ttu-id="82f9d-149">_lppbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="82f9d-149">_lppbSpoolSecurity_</span></span>
  
> <span data-ttu-id="82f9d-150">[out] Pointeur vers le pointeur vers les données de validation renvoyées.</span><span class="sxs-lookup"><span data-stu-id="82f9d-150">[out] A pointer to the pointer to the returned validation data.</span></span> <span data-ttu-id="82f9d-151">Ces données de validation sont fournies afin que la méthode [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) puisse connecter lepooler MAPI au même magasin que le fournisseur de la boutique de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-151">This validation data is provided so the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method can log the MAPI spooler on to the same store as the message store provider.</span></span> 
    
 <span data-ttu-id="82f9d-152">_lppMAPIError_</span><span class="sxs-lookup"><span data-stu-id="82f9d-152">_lppMAPIError_</span></span>
  
> <span data-ttu-id="82f9d-153">[out] Pointeur vers un pointeur vers la structure [MAPIERROR](mapierror.md) renvoyée, le cas besoin, qui contient des informations de version, de composant et de contexte pour une erreur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-153">[out] A pointer to a pointer to the returned [MAPIERROR](mapierror.md) structure, if any, that contains version, component, and context information for an error.</span></span> <span data-ttu-id="82f9d-154">Le  _paramètre lppMAPIError_ peut être définie sur **null** s’il n’existe aucune structure **MAPIERROR** à renvoyer.</span><span class="sxs-lookup"><span data-stu-id="82f9d-154">The  _lppMAPIError_ parameter can be set to **null** if there is no **MAPIERROR** structure to return.</span></span> 
    
 <span data-ttu-id="82f9d-155">_lppMSLogon_</span><span class="sxs-lookup"><span data-stu-id="82f9d-155">_lppMSLogon_</span></span>
  
> <span data-ttu-id="82f9d-156">[out] Pointeur vers le pointeur vers l’objet d’ouverture de session de la boutique de messages pour que MAPI se connecte.</span><span class="sxs-lookup"><span data-stu-id="82f9d-156">[out] A pointer to the pointer to the message store logon object for MAPI to log on to.</span></span>
    
 <span data-ttu-id="82f9d-157">_lppMDB_</span><span class="sxs-lookup"><span data-stu-id="82f9d-157">_lppMDB_</span></span>
  
> <span data-ttu-id="82f9d-158">[out] Pointeur vers le pointeur vers l’objet de la boutique de messages pour lepooler MAPI et les applications clientes à connecter.</span><span class="sxs-lookup"><span data-stu-id="82f9d-158">[out] A pointer to the pointer to the message store object for the MAPI spooler and client applications to log on to.</span></span>
    
## <a name="return-value"></a><span data-ttu-id="82f9d-159">Valeur renvoyée</span><span class="sxs-lookup"><span data-stu-id="82f9d-159">Return value</span></span>

<span data-ttu-id="82f9d-160">S_OK</span><span class="sxs-lookup"><span data-stu-id="82f9d-160">S_OK</span></span> 
  
> <span data-ttu-id="82f9d-161">L'appel a r�ussi et a renvoy� la valeur attendue ou les valeurs.</span><span class="sxs-lookup"><span data-stu-id="82f9d-161">The call succeeded and has returned the expected value or values.</span></span>
    
<span data-ttu-id="82f9d-162">MAPI_E_FAILONEPROVIDER</span><span class="sxs-lookup"><span data-stu-id="82f9d-162">MAPI_E_FAILONEPROVIDER</span></span> 
  
> <span data-ttu-id="82f9d-163">Ce fournisseur ne peut pas se connecter, mais cette erreur ne doit pas désactiver le service.</span><span class="sxs-lookup"><span data-stu-id="82f9d-163">This provider cannot log on, but this error should not disable the service.</span></span> 
    
<span data-ttu-id="82f9d-164">MAPI_E_LOGON_FAILED</span><span class="sxs-lookup"><span data-stu-id="82f9d-164">MAPI_E_LOGON_FAILED</span></span> 
  
> <span data-ttu-id="82f9d-165">Une session d’ouverture de session n’a pas pu être établie.</span><span class="sxs-lookup"><span data-stu-id="82f9d-165">A logon session could not be established.</span></span>
    
<span data-ttu-id="82f9d-166">MAPI_E_UNCONFIGURED</span><span class="sxs-lookup"><span data-stu-id="82f9d-166">MAPI_E_UNCONFIGURED</span></span> 
  
> <span data-ttu-id="82f9d-167">Le profil ne contient pas suffisamment d’informations pour la fin de l’accès.</span><span class="sxs-lookup"><span data-stu-id="82f9d-167">The profile does not contain enough information for the logon to complete.</span></span> <span data-ttu-id="82f9d-168">Lorsque cette valeur est renvoyée, MAPI appelle la fonction de point d’entrée de service de message du fournisseur de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-168">When this value is returned, MAPI calls the message store provider's message-service entry point function.</span></span>
    
<span data-ttu-id="82f9d-169">MAPI_E_USER_CANCEL</span><span class="sxs-lookup"><span data-stu-id="82f9d-169">MAPI_E_USER_CANCEL</span></span> 
  
> <span data-ttu-id="82f9d-170">L’utilisateur a annulé l’opération, généralement en cliquant sur le bouton **Annuler** dans une boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="82f9d-170">The user canceled the operation, typically by clicking the **Cancel** button in a dialog box.</span></span> 
    
<span data-ttu-id="82f9d-171">MAPI_E_UNKNOWN_CPID</span><span class="sxs-lookup"><span data-stu-id="82f9d-171">MAPI_E_UNKNOWN_CPID</span></span> 
  
> <span data-ttu-id="82f9d-172">Le serveur n’est pas configuré pour prendre en charge la page de code du client.</span><span class="sxs-lookup"><span data-stu-id="82f9d-172">The server is not configured to support the client's code page.</span></span>
    
<span data-ttu-id="82f9d-173">MAPI_E_UNKNOWN_LCID</span><span class="sxs-lookup"><span data-stu-id="82f9d-173">MAPI_E_UNKNOWN_LCID</span></span> 
  
> <span data-ttu-id="82f9d-174">Le serveur n’est pas configuré pour prendre en charge les informations de paramètres régionaux du client.</span><span class="sxs-lookup"><span data-stu-id="82f9d-174">The server is not configured to support the client's locale information.</span></span>
    
<span data-ttu-id="82f9d-175">MAPI_W_ERRORS_RETURNED</span><span class="sxs-lookup"><span data-stu-id="82f9d-175">MAPI_W_ERRORS_RETURNED</span></span> 
  
> <span data-ttu-id="82f9d-176">L’appel a réussi, mais des informations d’erreur sont disponibles pour le fournisseur de la boutique de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-176">The call succeeded, but the message store provider has error information available.</span></span> <span data-ttu-id="82f9d-177">Lorsque cet avertissement est renvoyé, l’appel doit être traité comme réussi.</span><span class="sxs-lookup"><span data-stu-id="82f9d-177">When this warning is returned, the call should be handled as successful.</span></span> <span data-ttu-id="82f9d-178">Pour tester cet avertissement, utilisez la macro **HR_FAILED.**</span><span class="sxs-lookup"><span data-stu-id="82f9d-178">To test for this warning, use the **HR_FAILED** macro.</span></span> <span data-ttu-id="82f9d-179">Pour plus d’informations, voir [Utilisation de macros pour la gestion des erreurs.](using-macros-for-error-handling.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-179">For more information, see [Using Macros for Error Handling](using-macros-for-error-handling.md).</span></span> <span data-ttu-id="82f9d-180">Pour obtenir les informations d’erreur du fournisseur, appelez la méthode [IMAPISession::GetLastError.](imapisession-getlasterror.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-180">To get the error information from the provider, call the [IMAPISession::GetLastError](imapisession-getlasterror.md) method.</span></span> 
    
## <a name="remarks"></a><span data-ttu-id="82f9d-181">Remarques</span><span class="sxs-lookup"><span data-stu-id="82f9d-181">Remarks</span></span>

<span data-ttu-id="82f9d-182">MAPI appelle la **méthode IMSProvider::Logon** pour faire la majorité du traitement nécessaire pour obtenir l’accès à une magasin de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-182">MAPI calls the **IMSProvider::Logon** method to do the majority of processing necessary to obtain access to a message store.</span></span> <span data-ttu-id="82f9d-183">Les fournisseurs de banque de messages valident les informations d’identification de l’utilisateur nécessaires pour accéder à une banque particulière et retournent un objet de banque de messages dans le paramètre  _lppMDB_ à qui lepooler MAPI et les applications clientes peuvent se connecter.</span><span class="sxs-lookup"><span data-stu-id="82f9d-183">Message store providers validate any user credentials necessary to access a particular store and return a message store object in the  _lppMDB_ parameter that the MAPI spooler and client applications can log on to.</span></span> 
  
<span data-ttu-id="82f9d-184">Outre l’objet de magasin de messages renvoyé pour l’utilisation du client et dupooler MAPI, le fournisseur renvoie également un objet d’ouverture de la boutique de messages que MAPI utilisera dans le contrôle de la boutique ouverte.</span><span class="sxs-lookup"><span data-stu-id="82f9d-184">In addition to the returned message store object for client and MAPI spooler use, the provider also returns a message store logon object for MAPI to use in controlling the opened store.</span></span> <span data-ttu-id="82f9d-185">L’objet d’ouverture de la boutique de messages et l’objet de la boutique de messages doivent être étroitement liés à l’intérieur du fournisseur de la boutique de messages afin que chacun puisse affecter l’autre.</span><span class="sxs-lookup"><span data-stu-id="82f9d-185">The message store logon object and the message store object should be tightly linked inside the message store provider so each can affect the other.</span></span> <span data-ttu-id="82f9d-186">L’utilisation de l’objet store et de l’objet d’ouverture de connecté doit être identique ; il doit y avoir une correspondance un-à-un entre l’objet d’ouverture de ligne et l’objet store afin que les objets agissent comme s’il s’agit d’un objet qui expose deux interfaces.</span><span class="sxs-lookup"><span data-stu-id="82f9d-186">The use of the store object and the logon object should be identical; there should be a one-to-one correspondence between the logon object and the store object such that the objects act as if they are one object that exposes two interfaces.</span></span> <span data-ttu-id="82f9d-187">Les deux objets doivent également être créés ensemble et libérés ensemble.</span><span class="sxs-lookup"><span data-stu-id="82f9d-187">The two objects should also be created together and freed together.</span></span> 
  
<span data-ttu-id="82f9d-188">L’objet de prise en charge MAPI, créé par MAPI et transmis au fournisseur dans le paramètre  _lpMAPISup,_ fournit l’accès aux fonctions dans MAPI dont le fournisseur a besoin.</span><span class="sxs-lookup"><span data-stu-id="82f9d-188">The MAPI support object, created by MAPI and passed to the provider in the  _lpMAPISup_ parameter, provides access to functions in MAPI that the provider requires.</span></span> <span data-ttu-id="82f9d-189">Il s’agit notamment des fonctions qui enregistrent et récupèrent des informations de profil, des carnets d’adresses d’accès, etc.</span><span class="sxs-lookup"><span data-stu-id="82f9d-189">These include functions that save and retrieve profile information, access address books, and so on.</span></span> <span data-ttu-id="82f9d-190">Le  _pointeur lpMAPISup_ peut être différent pour chaque magasin ouvert.</span><span class="sxs-lookup"><span data-stu-id="82f9d-190">The  _lpMAPISup_ pointer can be different for each store that is opened.</span></span> <span data-ttu-id="82f9d-191">Lors du traitement des appels pour une magasin de messages après l’ouverture de la boutique, le fournisseur de la boutique doit utiliser la variable  _lpMAPISup_ spécifique à cette boutique.</span><span class="sxs-lookup"><span data-stu-id="82f9d-191">While processing calls for a message store after logon, the store provider should use the  _lpMAPISup_ variable that is specific to that store.</span></span> <span data-ttu-id="82f9d-192">Pour  tout appel d’ouverture de conférence qui ouvre une magasin de messages et parvient à créer un objet d’ouverture de conférence de la boutique de messages, le fournisseur doit enregistrer un pointeur vers l’objet de support MAPI dans l’objet d’ouverture de conférence de la boutique et appeler la méthode [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) pour ajouter une référence à l’objet de support.</span><span class="sxs-lookup"><span data-stu-id="82f9d-192">For any **Logon** call that opens a message store and succeeds in creating a message store logon object, the provider must save a pointer to the MAPI support object in the store logon object and must call the [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) method to add a reference for the support object.</span></span> 
  
<span data-ttu-id="82f9d-193">Le _paramètre ulUIParam_ doit être utilisé si le fournisseur présente des boîtes de dialogue pendant l’appel **d’accès.**</span><span class="sxs-lookup"><span data-stu-id="82f9d-193">The  _ulUIParam_ parameter should be used if the provider presents dialog boxes during the **Logon** call.</span></span> <span data-ttu-id="82f9d-194">Toutefois, les boîtes de dialogue ne doivent pas être présentées si  _ulFlags_ contient MDB_NO_DIALOG indicateur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-194">However, dialog boxes should not be presented if  _ulFlags_ contains the MDB_NO_DIALOG flag.</span></span> <span data-ttu-id="82f9d-195">Si une interface utilisateur doit être appelée mais  _que ulFlags_ ne l’autorise pas, ou si, pour une autre raison, une interface utilisateur ne peut pas être affichée, le fournisseur doit renvoyer MAPI_E_LOGON_FAILED.</span><span class="sxs-lookup"><span data-stu-id="82f9d-195">If a user interface needs to be called but  _ulFlags_ does not allow it, or if for some other reason a user interface cannot be displayed, the provider should return MAPI_E_LOGON_FAILED.</span></span> <span data-ttu-id="82f9d-196">Si **l’utilisateur** affiche une boîte de dialogue et que l’utilisateur l’annule, généralement en cliquant sur le bouton Annuler de la boîte de dialogue, le fournisseur doit MAPI_E_USER_CANCEL. </span><span class="sxs-lookup"><span data-stu-id="82f9d-196">If **Logon** displays a dialog box and the user cancels the logon, typically by clicking the dialog box's **Cancel** button, the provider should return MAPI_E_USER_CANCEL.</span></span> 
  
<span data-ttu-id="82f9d-197">Le  _paramètre lpEntryID_ peut être **null** ou pointer vers un identificateur d’entrée de magasin non veloppé précédemment créé par cette magasin de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-197">The  _lpEntryID_ parameter can either be **null** or point to an unwrapped store entry identifier that this message store previously created.</span></span> <span data-ttu-id="82f9d-198">Si  _lpEntryID_ pointe vers un identificateur d’entrée non veloppé, cet identificateur d’entrée peut se trouver dans l’un des endroits ci-après :</span><span class="sxs-lookup"><span data-stu-id="82f9d-198">If  _lpEntryID_ points to an unwrapped entry identifier, that entry identifier can come from one of several places:</span></span> 
  
- <span data-ttu-id="82f9d-199">Il peut s’agit d’un identificateur d’entrée que le fournisseur de magasin **a** précédemment enveloppé et écrit dans la section de profil sous la PR_ENTRYID ([PidTagEntryId](pidtagentryid-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="82f9d-199">It can be an entry identifier that the store provider previously wrapped and wrote to the profile section as a **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) property.</span></span>
    
- <span data-ttu-id="82f9d-200">Il peut s’agit d’un identificateur d’entrée que le fournisseur a précédemment enveloppé et renvoyé à un client appelant en tant que **propriété PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="82f9d-200">It can be an entry identifier that the provider previously wrapped and returned to a calling client as a **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) property.</span></span> 
    
- <span data-ttu-id="82f9d-201">Il peut s’agit d’un identificateur d’entrée  que le fournisseur a précédemment wrapped et renvoyé à un client appelant en tant que propriété PR_ENTRYID d’un objet de magasin de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-201">It can be an entry identifier that the provider previously wrapped and returned to a calling client as the **PR_ENTRYID** property of a message store object.</span></span> 
    
<span data-ttu-id="82f9d-202">Dans tous ces cas, il est possible que l’identificateur d’entrée a été créé sur un autre ordinateur que celui actuellement utilisé.</span><span class="sxs-lookup"><span data-stu-id="82f9d-202">In any of these cases, it is possible that the entry identifier was created on a different computer than the one currently being used.</span></span>
  
<span data-ttu-id="82f9d-203">Lorsque  _lpEntryID_ n’est pas **null,** il doit contenir toutes les informations nécessaires pour identifier et localiser la magasin de messages.</span><span class="sxs-lookup"><span data-stu-id="82f9d-203">When  _lpEntryID_ is not **null**, it should contain all of the information needed to identify and locate the message store.</span></span> <span data-ttu-id="82f9d-204">Ces informations peuvent inclure des noms de volume réseau, des numéros de téléphone, des noms de comptes d’utilisateurs, etc.</span><span class="sxs-lookup"><span data-stu-id="82f9d-204">This information can include network volume names, phone numbers, user account names, and so on.</span></span> <span data-ttu-id="82f9d-205">Si la connexion à la boutique ne peut pas être réalisée à l’aide des données de l’identificateur d’entrée, le fournisseur de magasin doit afficher une boîte de dialogue qui permet à l’utilisateur de sélectionner le magasin à ouvrir.</span><span class="sxs-lookup"><span data-stu-id="82f9d-205">If the connection to the store cannot be made by using the data in the entry identifier, the store provider should display a dialog box that enables the user to select the store to be opened.</span></span> <span data-ttu-id="82f9d-206">Une boîte de dialogue peut être requise, par exemple, si un serveur a été renommé, si un nom de compte a changé ou si des parties du réseau ne sont pas disponibles.</span><span class="sxs-lookup"><span data-stu-id="82f9d-206">A dialog box might be required, for example, if a server has been renamed, an account name has changed, or portions of the network are not available.</span></span>
  
<span data-ttu-id="82f9d-207">Lorsque  _lpEntryID_ est **null,** la boutique de messages à utiliser n’a pas encore été sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="82f9d-207">When  _lpEntryID_ is **null**, the message store to use has not yet been selected.</span></span> <span data-ttu-id="82f9d-208">Le fournisseur peut toujours accéder à un magasin sans afficher de boîte de dialogue s’il prend en charge d’autres méthodes pour spécifier le magasin.</span><span class="sxs-lookup"><span data-stu-id="82f9d-208">The provider can still access a store without displaying a dialog box if it supports further methods to specify the store.</span></span> <span data-ttu-id="82f9d-209">Par exemple, le fournisseur peut vérifier son fichier d’initialisation ou rechercher des propriétés supplémentaires qui ont été placées dans sa section de profil ou dans la section de profil de son service de messagerie lors de la configuration.</span><span class="sxs-lookup"><span data-stu-id="82f9d-209">For example, the provider can check its initialization file, or it can look for additional properties that were placed in its or its message service's profile section at configuration.</span></span>
  
<span data-ttu-id="82f9d-210">Si un fournisseur trouve que toutes les informations requises ne se trouvent pas dans le profil, il doit renvoyer MAPI_E_UNCONFIGURED.</span><span class="sxs-lookup"><span data-stu-id="82f9d-210">If a provider finds that all the required information is not in the profile, it should return MAPI_E_UNCONFIGURED.</span></span> <span data-ttu-id="82f9d-211">MAPI appelle ensuite la fonction de point d’entrée du service de messagerie du fournisseur pour permettre à l’utilisateur de sélectionner une banque, voire d’en créer une, et d’entrer un nom de compte et un mot de passe, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="82f9d-211">MAPI will then call the provider's message service entry point function to enable the user to select a store, or even to create one, and to enter an account name and password, as needed.</span></span> <span data-ttu-id="82f9d-212">MAPI crée automatiquement une section de profil pour une nouvelle boutique . Cette nouvelle section de profil peut être temporaire ou permanente, en fonction de la façon dont elle a été ajoutée.</span><span class="sxs-lookup"><span data-stu-id="82f9d-212">MAPI automatically creates a new profile section for a new store; this new profile section can be temporary or permanent, depending on how it has been added.</span></span> <span data-ttu-id="82f9d-213">Si le fournisseur de magasin appelle la méthode **IMAPISupport::ModifyProfile,** la nouvelle section de profil devient permanente et le magasin est ajouté à la liste des magasins de messages renvoyé par la méthode [IMAPISession::GetMsgStoresTable.](imapisession-getmsgstorestable.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-213">If the store provider calls the **IMAPISupport::ModifyProfile** method, the new profile section becomes permanent and the store is added to the list of message stores returned by the [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) method.</span></span> 
  
<span data-ttu-id="82f9d-214">Le  _paramètre lpInterface_ spécifie l’IID de l’interface requise pour l’objet store nouvellement ouvert.</span><span class="sxs-lookup"><span data-stu-id="82f9d-214">The  _lpInterface_ parameter specifies the IID of the interface required for the newly opened store object.</span></span> <span data-ttu-id="82f9d-215">La **transmission de la** valeur null dans  _lpInterface_ spécifie que l’interface de magasin de messages MAPI, **IMsgStore**, est requise.</span><span class="sxs-lookup"><span data-stu-id="82f9d-215">Passing **null** in  _lpInterface_ specifies that the MAPI message store interface, **IMsgStore**, is required.</span></span> <span data-ttu-id="82f9d-216">La transmission de l’objet de IID_IMsgStore, spécifie également que **IMsgStore** est requis.</span><span class="sxs-lookup"><span data-stu-id="82f9d-216">Passing the message store object, IID_IMsgStore, also specifies that **IMsgStore** is required.</span></span> <span data-ttu-id="82f9d-217">Si IID_IUnknown est transmis dans  _lpInterface,_ le fournisseur doit ouvrir le magasin à l’aide de n’importe quelle interface dérivée de [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) est la meilleure pour le fournisseur (là encore, il s’agit généralement **de IMsgStore**).</span><span class="sxs-lookup"><span data-stu-id="82f9d-217">If IID_IUnknown is passed in  _lpInterface_, the provider should open the store by using whatever interface derived from [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) is best for the provider (again, this is typically **IMsgStore**).</span></span> <span data-ttu-id="82f9d-218">Lorsque IID_IUnknown est passé, l’implémentation d’appel utilise la méthode [IUnknown::QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) pour sélectionner une interface après la réussite de l’opération d’ouverture de la boutique.</span><span class="sxs-lookup"><span data-stu-id="82f9d-218">When IID_IUnknown is passed, the calling implementation uses the [IUnknown::QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) method to select an interface after the store open operation succeeds.</span></span> 
  
<span data-ttu-id="82f9d-219">L’appel **IMSProvider::Logon** doit renvoyer suffisamment d’informations, telles qu’un chemin d’accès au magasin et des informations d’identification pour accéder au magasin, pour permettre aupooler MAPI de se connecter à la même boutique que le fournisseur de magasin sans présenter de boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="82f9d-219">The **IMSProvider::Logon** call should return sufficient information, such as a path to the store and credentials for accessing the store, to allow the MAPI spooler to log on to the same store that the store provider does without presenting a dialog box.</span></span> <span data-ttu-id="82f9d-220">Les  _paramètres lpcbSpoolSecurity_ et  _lppbSpoolSecurity_ sont utilisés pour renvoyer ces informations.</span><span class="sxs-lookup"><span data-stu-id="82f9d-220">The  _lpcbSpoolSecurity_ and  _lppbSpoolSecurity_ parameters are used to return this information.</span></span> <span data-ttu-id="82f9d-221">Le fournisseur alloue la mémoire pour ces données en passant un pointeur vers une mémoire tampon dans le paramètre _lpfAllocateBuffer_ de la fonction [MSProviderInit](msproviderinit.md) ; le fournisseur place la taille de cette mémoire tampon dans _lpcbSpoolSecurity_.</span><span class="sxs-lookup"><span data-stu-id="82f9d-221">The provider allocates the memory for this data by passing a pointer to a buffer in the [MSProviderInit](msproviderinit.md) function's  _lpfAllocateBuffer_ parameter; the provider places the size of this buffer in  _lpcbSpoolSecurity_.</span></span> 
  
<span data-ttu-id="82f9d-222">MAPI libère cette mémoire tampon, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="82f9d-222">MAPI frees this buffer when appropriate.</span></span> <span data-ttu-id="82f9d-223">Si l’ouverture de page du spouleur MAPI dans le magasin peut être accomplie à partir des informations de la section profil uniquement, le fournisseur peut renvoyer null dans  _lppbSpoolSecurity_ et 0 pour la taille des informations dans  _lpcbSpoolSecurity_.</span><span class="sxs-lookup"><span data-stu-id="82f9d-223">If the MAPI spooler's logon to the store can be accomplished from the information in the profile section alone, the provider can return null in  _lppbSpoolSecurity_ and 0 for the information's size in  _lpcbSpoolSecurity_.</span></span> <span data-ttu-id="82f9d-224">L’ouverture de logo dupooler MAPI se produit dans le cadre d’un processus différent de celui de l’ouverture de la boutique . Étant donné que la mémoire tampon qui contient les informations transmises est copiée entre les processus, il se peut qu’elle ne se trouve pas en mémoire au même emplacement pour le processus dupooler MAPI que pour le processus du fournisseur de magasins.</span><span class="sxs-lookup"><span data-stu-id="82f9d-224">The MAPI spooler logon occurs as part of a different process than the store logon; because the buffer that contains the passed information gets copied between processes, it might not be in memory at the same location for the MAPI spooler process as for the store provider process.</span></span> <span data-ttu-id="82f9d-225">Par conséquent, un fournisseur ne doit pas placer d’adresses dans cette mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="82f9d-225">Therefore, a provider shouldn't put addresses into this buffer.</span></span> <span data-ttu-id="82f9d-226">Pour plus d’informations sur l’accès aupooler MAPI, voir la méthode [IMSProvider::SpoolerLogon.](imsprovider-spoolerlogon.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-226">For more information about MAPI spooler logon, see the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method.</span></span> 
  
<span data-ttu-id="82f9d-227">La plupart des fournisseurs de magasins utilisent la méthode [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) de l’objet de support transmis dans le paramètre  _lpMAPISup_ pour enregistrer et récupérer les informations d’identification et les options de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-227">Most store providers use the [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) method of the support object passed in the  _lpMAPISup_ parameter for saving and retrieving user credentials and options.</span></span> <span data-ttu-id="82f9d-228">**OpenProfileSection** permet à un fournisseur de magasin d’enregistrer des informations arbitraires supplémentaires dans une section de profil et de les associer à une ressource particulière.</span><span class="sxs-lookup"><span data-stu-id="82f9d-228">**OpenProfileSection** enables a store provider to save additional arbitrary information in a profile section and associate it with a particular resource.</span></span> <span data-ttu-id="82f9d-229">Par exemple, un fournisseur de magasins peut enregistrer le nom du compte d’utilisateur et le mot de passe associés à une ressource, ainsi que les chemins d’accès ou autres informations nécessaires pour accéder à cette ressource.</span><span class="sxs-lookup"><span data-stu-id="82f9d-229">For example, a store provider can save the user account name and password associated with a resource and any paths or other information needed to access that resource.</span></span> 
  
<span data-ttu-id="82f9d-230">Les propriétés avec identificateurs de 0x6600 via 0x67FF sont des propriétés sécurisées disponibles pour le fournisseur pour son propre usage afin de stocker des données privées dans des sections de profil.</span><span class="sxs-lookup"><span data-stu-id="82f9d-230">Properties with property identifiers 0x6600 through 0x67FF are secure properties available to the provider for its own use to store private data in profile sections.</span></span> <span data-ttu-id="82f9d-231">Pour plus d’informations sur les utilisations des propriétés dans les objets de section de profil, voir la méthode [IProfSect : IMAPIProp.](iprofsectimapiprop.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-231">For more information about the uses of properties in profile section objects, see the [IProfSect : IMAPIProp](iprofsectimapiprop.md) method.</span></span> 
  
<span data-ttu-id="82f9d-232">En plus des données privées dans les propriétés avec des identificateurs 0x6600 via 0x67FF, le fournisseur de banque doit fournir des informations pour la propriété **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) dans sa section de profil.</span><span class="sxs-lookup"><span data-stu-id="82f9d-232">In addition to any private data in properties with identifiers 0x6600 through 0x67FF, the store provider should provide information for the **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in its profile section.</span></span> <span data-ttu-id="82f9d-233">Il doit placer dans **PR_DISPLAY_NAME** le nom complet du fournisseur lui-même , une chaîne d’identification (par exemple, « Microsoft Personal Information Store ») qui s’affiche pour les utilisateurs afin qu’ils peuvent distinguer ce magasin de messages des autres personnes à qui ils ont peut-être accès.</span><span class="sxs-lookup"><span data-stu-id="82f9d-233">It should put in **PR_DISPLAY_NAME** the display name of the provider itself — an identifying string (for example, "Microsoft Personal Information Store") that is displayed to users so they can distinguish this message store from others they might have access to.</span></span> <span data-ttu-id="82f9d-234">**PR_DISPLAY_NAME** contient généralement un nom de serveur, un nom de compte d’utilisateur ou un chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="82f9d-234">**PR_DISPLAY_NAME** commonly contains a server name, user account name, or path.</span></span> 
  
<span data-ttu-id="82f9d-235">Certaines propriétés de section de profil sont visibles dans la table de la boutique de messages . d’autres sont visibles pendant l’installation, l’installation et la configuration du sous-système MAPI.</span><span class="sxs-lookup"><span data-stu-id="82f9d-235">Some profile section properties are visible in the message store table; others are visible during setup, installation, and configuration of the MAPI subsystem.</span></span> <span data-ttu-id="82f9d-236">Le fournisseur fournit généralement des informations pour ces propriétés visibles à la fois pour une nouvelle section de profil, qui n’inclut pas encore les informations d’identification enregistrées ou les informations privées, et lorsqu’il trouve que les informations de propriété ont changé.</span><span class="sxs-lookup"><span data-stu-id="82f9d-236">The provider typically provides information for these visible properties both for a new profile section, which does not yet include saved credentials or private information, and when it finds that property information has changed.</span></span> <span data-ttu-id="82f9d-237">Pour plus d’informations sur les sections de profil, voir [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span><span class="sxs-lookup"><span data-stu-id="82f9d-237">For more information about profile sections, see [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span></span>
  
<span data-ttu-id="82f9d-238">Après avoir correctement journalé un utilisateur et avant de revenir à MAPI, le fournisseur de magasins doit créer le tableau des propriétés de la ligne d’état de la ressource et appeler la méthode [IMAPISupport::ModifyStatusRow.](imapisupport-modifystatusrow.md)</span><span class="sxs-lookup"><span data-stu-id="82f9d-238">After successfully logging on a user, and before returning to MAPI, the store provider should create the array of properties for the status row for the resource and call the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> 
  
 <span data-ttu-id="82f9d-239">**Les appels d’ouverture** de session qui ouvrent des messages stockent déjà ouverts pour la session MAPI actuelle ignorent une grande partie du traitement décrit précédemment.</span><span class="sxs-lookup"><span data-stu-id="82f9d-239">**Logon** calls that open message stores that are already open for the current MAPI session skip much of the processing previously described.</span></span> <span data-ttu-id="82f9d-240">Ces appels ne créent pas de lignes d’état, ne retournent pas d’objets d’ouverture de conférence de la boutique de messages, appellent **AddRef** pour l’objet de support MAPI ou ne retournent pas de données pour l’ouverture de conférence dupooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="82f9d-240">These calls do not create status rows, return message store logon objects, call **AddRef** for the MAPI support object, or return data for MAPI spooler logon.</span></span> <span data-ttu-id="82f9d-241">Ces appels ne retournent pas S_OK et retournent un objet de magasin de messages avec l’interface demandée.</span><span class="sxs-lookup"><span data-stu-id="82f9d-241">These calls do return S_OK and return a message store object with the requested interface.</span></span> 
  
<span data-ttu-id="82f9d-242">Pour détecter ces appels, le fournisseur doit conserver une liste dans l’objet fournisseur de la boutique de messages des magasins déjà ouverts pour cet objet fournisseur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-242">To detect such calls, the provider should maintain a list in the message store provider object of stores already open for this provider object.</span></span> <span data-ttu-id="82f9d-243">Lors du traitement **d’un** appel d’ouverture de session, le fournisseur doit analyser cette liste de magasins ouverts et déterminer si la boutique à ouvrir est déjà ouverte.</span><span class="sxs-lookup"><span data-stu-id="82f9d-243">When processing a **Logon** call, the provider should scan this list of open stores and determine whether the store to be logged on to is already open.</span></span> <span data-ttu-id="82f9d-244">Si c’est le cas, les informations d’identification de l’utilisateur n’ont pas besoin d’être cochées et l’affichage d’une boîte de dialogue doit être évité, si possible.</span><span class="sxs-lookup"><span data-stu-id="82f9d-244">If it is, user credentials do not need to be checked and the display of a dialog box should be avoided, if possible.</span></span> <span data-ttu-id="82f9d-245">Si des boîtes de dialogue doivent être affichées, le fournisseur doit vérifier les informations renvoyées pour voir si un magasin a été ouvert une deuxième fois.</span><span class="sxs-lookup"><span data-stu-id="82f9d-245">If dialog boxes must be displayed, the provider should check returned information to see whether a store has been opened a second time.</span></span> <span data-ttu-id="82f9d-246">En outre, le fournisseur doit vérifier les ouvertures en double à l’aide de  _lpEntryID_ au début du traitement des appels **d’ouverture** de conférence.</span><span class="sxs-lookup"><span data-stu-id="82f9d-246">In addition, the provider should check for duplicate openings by using  _lpEntryID_ at the beginning of **Logon** call processing.</span></span> 
  
<span data-ttu-id="82f9d-247">Le traitement standard d’un appel **d’ouverture** de conférence qui accède à une boutique ouverte est le suivant :</span><span class="sxs-lookup"><span data-stu-id="82f9d-247">Standard processing for a **Logon** call that accesses an open store is as follows:</span></span> 
  
1. <span data-ttu-id="82f9d-248">Le fournisseur de magasin appelle **AddRef** pour l’objet store existant si la nouvelle interface demandée est identique à l’interface du magasin existant.</span><span class="sxs-lookup"><span data-stu-id="82f9d-248">The store provider calls **AddRef** for the existing store object if the new interface being requested is the same as the interface for the existing store.</span></span> <span data-ttu-id="82f9d-249">Sinon, il appelle **QueryInterface** pour obtenir la nouvelle interface.</span><span class="sxs-lookup"><span data-stu-id="82f9d-249">Otherwise, it calls **QueryInterface** to get the new interface.</span></span> <span data-ttu-id="82f9d-250">Si le magasin ne prend pas en charge la nouvelle interface, le fournisseur doit renvoyer la valeur d’erreur MAPI_E_INTERFACE_NOT_SUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="82f9d-250">If the store does not support the new interface, the provider should return the error value MAPI_E_INTERFACE_NOT_SUPPORTED.</span></span> 
    
2. <span data-ttu-id="82f9d-251">Le fournisseur renvoie un pointeur vers l’interface requise de l’objet store existant dans  _lppMDB_.</span><span class="sxs-lookup"><span data-stu-id="82f9d-251">The provider returns a pointer to the required interface of the existing store object in  _lppMDB_.</span></span>
    
3. <span data-ttu-id="82f9d-252">Le fournisseur renvoie **la valeur null** dans  _lppMSLogon_.</span><span class="sxs-lookup"><span data-stu-id="82f9d-252">The provider returns **null** in  _lppMSLogon_.</span></span>
    
4. <span data-ttu-id="82f9d-253">Le fournisseur ne doit pas ouvrir le profil de l’objet de support transmis dans l’appel.</span><span class="sxs-lookup"><span data-stu-id="82f9d-253">The provider should not open the profile for the support object passed in the call.</span></span> <span data-ttu-id="82f9d-254">En outre, il ne doit pas inscrire un identificateur unique de fournisseur, inscrire une ligne d’état ou renvoyer des données d’accès aupooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="82f9d-254">In addition, it should not register a provider unique identifier, register a status row, or return MAPI spooler logon data.</span></span>
    
5. <span data-ttu-id="82f9d-255">Le fournisseur ne doit pas **appeler AddRef** pour l’objet de support, car il ne nécessite pas de pointeur vers l’objet.</span><span class="sxs-lookup"><span data-stu-id="82f9d-255">The provider should not call **AddRef** for the support object, because it does not require a pointer to the object.</span></span> 
    
<span data-ttu-id="82f9d-256">Dans la mesure du possible, les  fournisseurs doivent renvoyer les chaînes d’erreur et d’avertissement appropriées pour les appels d’accès, car cela permet aux utilisateurs de déterminer pourquoi quelque chose n’a pas fonctionné.</span><span class="sxs-lookup"><span data-stu-id="82f9d-256">Whenever possible, providers should return appropriate error and warning strings for **Logon** calls, because doing so greatly eases the burden of users in determining why something did not work.</span></span> <span data-ttu-id="82f9d-257">Pour renvoyer ces chaînes, un fournisseur définit les membres de la structure **MAPIERROR.**</span><span class="sxs-lookup"><span data-stu-id="82f9d-257">To return these strings, a provider sets the members in the **MAPIERROR** structure.</span></span> <span data-ttu-id="82f9d-258">MAPI recherche, utilise et libère la structure **MAPIERROR** si elle est renvoyée par un fournisseur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-258">MAPI looks for, uses, and releases the **MAPIERROR** structure if it is returned by a provider.</span></span> 
  
<span data-ttu-id="82f9d-259">La mémoire de cette structure **MAPIERROR** doit être allouée à l’aide de la mémoire tampon transmise dans _lpfAllocateBuffer_ lors de l’appel **MSProviderInit.**</span><span class="sxs-lookup"><span data-stu-id="82f9d-259">Memory for this **MAPIERROR** structure should be allocated by using the buffer passed in  _lpfAllocateBuffer_ on the **MSProviderInit** call.</span></span> <span data-ttu-id="82f9d-260">Toutes les chaînes d’erreur contenues dans la structure renvoyée doivent être au format Unicode si MAPI_UNICODE est définie dans les _ulFlags_ **logon** ; sinon, elles doivent être dans le jeu de caractères ANSI.</span><span class="sxs-lookup"><span data-stu-id="82f9d-260">Any error strings contained in the returned structure should be in Unicode format if MAPI_UNICODE is set in the **Logon** _ulFlags;_ otherwise, they should be in the ANSI character set.</span></span> 
  
<span data-ttu-id="82f9d-261">Pour la plupart des valeurs d’erreur renvoyées par la propriété **Logon,** MAPI désactive les services de messagerie à laquelle appartient le fournisseur défaillant.</span><span class="sxs-lookup"><span data-stu-id="82f9d-261">For most error values returned from **Logon**, MAPI disables the message services to which the failing provider belongs.</span></span> <span data-ttu-id="82f9d-262">MAPI n’appellera pas les fournisseurs qui appartiennent à ces services pendant toute la durée de vie de la session MAPI.</span><span class="sxs-lookup"><span data-stu-id="82f9d-262">MAPI will not call any providers that belong to those services for the life of the MAPI session.</span></span> <span data-ttu-id="82f9d-263">En revanche, lorsque **Logon** renvoie la valeur d’erreur MAPI_E_FAILONEPROVIDER à partir de sa logon, MAPI ne désactive pas le service de messagerie auquel appartient le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="82f9d-263">In contrast, when **Logon** returns the MAPI_E_FAILONEPROVIDER error value from its logon, MAPI does not disable the message service to which the provider belongs.</span></span> <span data-ttu-id="82f9d-264">**L’ouverture** de session MAPI_E_FAILONEPROVIDER si elle rencontre une erreur qui ne justifie pas la désactivation de l’intégralité du service pendant toute la durée de la session.</span><span class="sxs-lookup"><span data-stu-id="82f9d-264">**Logon** should return MAPI_E_FAILONEPROVIDER if it encounters an error that does not warrant disabling the entire service for the life of the session.</span></span> <span data-ttu-id="82f9d-265">Par exemple, un fournisseur peut renvoyer cette erreur lorsqu’il n’autorise pas l’affichage d’une interface utilisateur et qu’un mot de passe requis n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="82f9d-265">For example, a provider might return this error when it does not allow the display of a user interface and a required password is unavailable.</span></span> 
  
<span data-ttu-id="82f9d-266">Si un fournisseur renvoie MAPI_E_UNCONFIGURED à partir de sa logon, MAPI appelle la fonction d’entrée de service de messagerie du fournisseur, puis réessaye d’y revenir.</span><span class="sxs-lookup"><span data-stu-id="82f9d-266">If a provider returns MAPI_E_UNCONFIGURED from its logon, MAPI will call the provider's message service entry function and then retry the logon.</span></span> <span data-ttu-id="82f9d-267">MAPI passe MSG_SERVICE_CONFIGURE comme contexte pour donner au service la possibilité de se configurer lui-même.</span><span class="sxs-lookup"><span data-stu-id="82f9d-267">MAPI passes MSG_SERVICE_CONFIGURE as the context to give the service a chance to configure itself.</span></span> <span data-ttu-id="82f9d-268">Si le client a choisi d’autoriser une interface utilisateur sur la logon, le service peut présenter sa feuille de propriétés de configuration afin que l’utilisateur puisse entrer des informations de configuration.</span><span class="sxs-lookup"><span data-stu-id="82f9d-268">If the client has chosen to allow a user interface on the logon, the service can present its configuration property sheet so the user can enter configuration information.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="82f9d-269">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="82f9d-269">See also</span></span>



[<span data-ttu-id="82f9d-270">IMAPISession::GetMsgStoresTable</span><span class="sxs-lookup"><span data-stu-id="82f9d-270">IMAPISession::GetMsgStoresTable</span></span>](imapisession-getmsgstorestable.md)
  
[<span data-ttu-id="82f9d-271">IMAPISession::OpenMsgStore</span><span class="sxs-lookup"><span data-stu-id="82f9d-271">IMAPISession::OpenMsgStore</span></span>](imapisession-openmsgstore.md)
  
[<span data-ttu-id="82f9d-272">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="82f9d-272">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md)
  
[<span data-ttu-id="82f9d-273">IMAPISupport::ModifyProfile</span><span class="sxs-lookup"><span data-stu-id="82f9d-273">IMAPISupport::ModifyProfile</span></span>](imapisupport-modifyprofile.md)
  
[<span data-ttu-id="82f9d-274">IMAPISupport::ModifyStatusRow</span><span class="sxs-lookup"><span data-stu-id="82f9d-274">IMAPISupport::ModifyStatusRow</span></span>](imapisupport-modifystatusrow.md)
  
[<span data-ttu-id="82f9d-275">IMsgStore : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="82f9d-275">IMsgStore : IMAPIProp</span></span>](imsgstoreimapiprop.md)
  
[<span data-ttu-id="82f9d-276">IMSProvider::SpoolerLogon</span><span class="sxs-lookup"><span data-stu-id="82f9d-276">IMSProvider::SpoolerLogon</span></span>](imsprovider-spoolerlogon.md)
  
[<span data-ttu-id="82f9d-277">IProfSect : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="82f9d-277">IProfSect : IMAPIProp</span></span>](iprofsectimapiprop.md)
  
[<span data-ttu-id="82f9d-278">MAPIERROR</span><span class="sxs-lookup"><span data-stu-id="82f9d-278">MAPIERROR</span></span>](mapierror.md)
  
[<span data-ttu-id="82f9d-279">MSProviderInit</span><span class="sxs-lookup"><span data-stu-id="82f9d-279">MSProviderInit</span></span>](msproviderinit.md)
  
[<span data-ttu-id="82f9d-280">IMSProvider : IUnknown</span><span class="sxs-lookup"><span data-stu-id="82f9d-280">IMSProvider : IUnknown</span></span>](imsprovideriunknown.md)

