---
title: Envoyer ou recevoir un message à la demande
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 479404c5-4926-402a-aa12-75dd23276d75
description: 'Derni�re modification�: samedi 23 juillet 2011'
ms.openlocfilehash: ece5340497f83862b711f076c8c6346e14ec9355
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/11/2018
ms.locfileid: "19787121"
---
# <a name="sending-or-receiving-a-message-on-demand"></a><span data-ttu-id="de38a-103">Envoyer ou recevoir un message à la demande</span><span class="sxs-lookup"><span data-stu-id="de38a-103">Sending or receiving a message on demand</span></span>
  
<span data-ttu-id="de38a-104">**S’applique à**: Outlook</span><span class="sxs-lookup"><span data-stu-id="de38a-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="de38a-105">Clients comptent généralement sur le sous-système MAPI — le spouleur MAPI et les fournisseurs de services — pour gérer la synchronisation de la transmission de message et de réception.</span><span class="sxs-lookup"><span data-stu-id="de38a-105">Clients typically rely on the MAPI subsystem — the MAPI spooler and the service providers — to handle the timing of message transmission and reception.</span></span> <span data-ttu-id="de38a-106">Toutefois, vous pouvez modifier ce délai à l’aide de l’objet d’état d’un fournisseur de transport ou le spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="de38a-106">However, you can alter this timing by using the status object of either the MAPI spooler or a transport provider.</span></span>
  
<span data-ttu-id="de38a-107">La méthode [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) supprime tous les messages des files d’attente entrant ou sortant un ou plusieurs du fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="de38a-107">The [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) method removes all messages from one or more transport provider's incoming or outgoing queues.</span></span> <span data-ttu-id="de38a-108">Les procédures suivantes décrivent les deux techniques pour envoyer ou recevoir de messages à la demande.</span><span class="sxs-lookup"><span data-stu-id="de38a-108">The following procedures describe two techniques for sending or receiving messages on demand.</span></span> <span data-ttu-id="de38a-109">La première procédure utilise un objet de l’état du spouleur MAPI pour vider les files d’attente de chaque fournisseur de transport dans le profil ; la seconde procédure vide la file d’attente d’un fournisseur de transport unique.</span><span class="sxs-lookup"><span data-stu-id="de38a-109">The first procedure uses the MAPI spooler's status object to flush the queues of every transport provider in the profile; the second procedure flushes the queue of a single transport provider.</span></span> 
  
### <a name="to-flush-all-incoming-or-outgoing-queues-in-a-single-operation"></a><span data-ttu-id="de38a-110">Pour vider toutes les files entrants ou sortants en une seule opération</span><span class="sxs-lookup"><span data-stu-id="de38a-110">To flush all incoming or outgoing queues in a single operation</span></span>
  
1. <span data-ttu-id="de38a-111">Appelez [IMAPISession::GetStatusTable](imapisession-getstatustable.md) pour accéder à la table d’état.</span><span class="sxs-lookup"><span data-stu-id="de38a-111">Call [IMAPISession::GetStatusTable](imapisession-getstatustable.md) to access the status table.</span></span> 
    
2. <span data-ttu-id="de38a-112">Appelez la méthode de [IMAPITable::SetColumns](imapitable-setcolumns.md) de la table d’état pour limiter la colonne valeur **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) et **PR_RESOURCE_TYPE** ([PidTagResourceType](pidtagresourcetype-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="de38a-112">Call the status table's [IMAPITable::SetColumns](imapitable-setcolumns.md) method to limit the column set to **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) and **PR_RESOURCE_TYPE** ([PidTagResourceType](pidtagresourcetype-canonical-property.md)).</span></span>
    
3. <span data-ttu-id="de38a-113">Créer une restriction de propriété à l’aide d’une structure [SPropertyRestriction](spropertyrestriction.md) pour la correspondance de **PR_RESOURCE_TYPE** avec MAPI_SPOOLER.</span><span class="sxs-lookup"><span data-stu-id="de38a-113">Build a property restriction using an [SPropertyRestriction](spropertyrestriction.md) structure to match **PR_RESOURCE_TYPE** with MAPI_SPOOLER.</span></span> 
    
4. <span data-ttu-id="de38a-114">Appelez [HrQueryAllRows](hrqueryallrows.md), en passant la structure **SPropertyRestriction** , pour récupérer la ligne qui représente l’état du spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="de38a-114">Call [HrQueryAllRows](hrqueryallrows.md), passing in the **SPropertyRestriction** structure, to retrieve the row that represents the status of the MAPI spooler.</span></span> 
    
5. <span data-ttu-id="de38a-115">Passez la colonne **PR_ENTRYID** à [IMAPISession::OpenEntry](imapisession-openentry.md) pour ouvrir statut objet du spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="de38a-115">Pass the **PR_ENTRYID** column to [IMAPISession::OpenEntry](imapisession-openentry.md) to open the MAPI spooler's status object.</span></span> 
    
6. <span data-ttu-id="de38a-116">Appelez [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) méthode du spouleur MAPI, en passant l’indicateur FLUSH_NO_UI pour supprimer l’interface utilisateur et indicateur FLUSH_UPLOAD ou FLUSH_DOWNLOAD pour vider les files d’attente entrants ou sortants.</span><span class="sxs-lookup"><span data-stu-id="de38a-116">Call the MAPI spooler's [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) method, passing the FLUSH_NO_UI flag to suppress the user interface and either the FLUSH_DOWNLOAD or FLUSH_UPLOAD flag to flush the outgoing or incoming queues.</span></span> 
    
7. <span data-ttu-id="de38a-117">Version de l’objet de l’état et la table d’état, ainsi que la structure [SRowSet](srowset.md) qui est allouée à la table.</span><span class="sxs-lookup"><span data-stu-id="de38a-117">Release the status object and the status table, as well as the [SRowSet](srowset.md) structure that is allocated for the table.</span></span> 
    
### <a name="to-flush-incoming-or-outgoing-queues-individually-by-transport-provider"></a><span data-ttu-id="de38a-118">Pour vider les files d’attente entrants ou sortants individuellement par le fournisseur de transport</span><span class="sxs-lookup"><span data-stu-id="de38a-118">To flush incoming or outgoing queues individually by transport provider</span></span>
  
1. <span data-ttu-id="de38a-119">Appelez [IMAPISession::GetStatusTable](imapisession-getstatustable.md) pour accéder à la table d’état.</span><span class="sxs-lookup"><span data-stu-id="de38a-119">Call [IMAPISession::GetStatusTable](imapisession-getstatustable.md) to access the status table.</span></span> 
    
2. <span data-ttu-id="de38a-120">Appeler la méthode de [IMAPITable::SetColumns](imapitable-setcolumns.md) de la table d’état pour limiter la colonne valeur **PR_ENTRYID** et **PR_RESOURCE_TYPE**.</span><span class="sxs-lookup"><span data-stu-id="de38a-120">Call the status table's [IMAPITable::SetColumns](imapitable-setcolumns.md) method to limit the column set to **PR_ENTRYID** and **PR_RESOURCE_TYPE**.</span></span>
    
3. <span data-ttu-id="de38a-121">Créer une restriction de propriété à l’aide d’une structure [SPropertyRestriction](spropertyrestriction.md) pour la correspondance de **PR_RESOURCE_TYPE** avec MAPI_TRANSPORT_PROVIDER.</span><span class="sxs-lookup"><span data-stu-id="de38a-121">Build a property restriction using an [SPropertyRestriction](spropertyrestriction.md) structure to match **PR_RESOURCE_TYPE** with MAPI_TRANSPORT_PROVIDER.</span></span> 
    
4. <span data-ttu-id="de38a-122">Appelez [HrQueryAllRows](hrqueryallrows.md), en passant la structure **SPropertyRestriction** , pour récupérer les lignes qui sont fournis par des fournisseurs de transport.</span><span class="sxs-lookup"><span data-stu-id="de38a-122">Call [HrQueryAllRows](hrqueryallrows.md), passing in the **SPropertyRestriction** structure, to retrieve the rows that are supplied by transport providers.</span></span> 
    
5. <span data-ttu-id="de38a-123">Pour chaque ligne renvoyée par **HrQueryAllRows**:</span><span class="sxs-lookup"><span data-stu-id="de38a-123">For each row returned from **HrQueryAllRows**:</span></span>
    
    1. <span data-ttu-id="de38a-124">Passez la colonne **PR_ENTRYID** à [IMAPISession::OpenEntry](imapisession-openentry.md) pour ouvrir l’objet de l’état du fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="de38a-124">Pass the **PR_ENTRYID** column to [IMAPISession::OpenEntry](imapisession-openentry.md) to open the transport provider's status object.</span></span> 
        
    2. <span data-ttu-id="de38a-125">Vérifiez que l’objet d’état de transport prend en charge la méthode **FlushQueues** en vérifiant que sa propriété **PR_RESOURCE_METHODS** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)) a la STATUS_FLUSH_QUEUES l’indicateur est défini.</span><span class="sxs-lookup"><span data-stu-id="de38a-125">Check that the transport status object supports the **FlushQueues** method by checking that its **PR_RESOURCE_METHODS** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)) property has the STATUS_FLUSH_QUEUES flag set.</span></span> 
        
    3. <span data-ttu-id="de38a-126">Si prise en charge, appelez [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md).</span><span class="sxs-lookup"><span data-stu-id="de38a-126">If supported, call [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md).</span></span> <span data-ttu-id="de38a-127">Si non pris en charge, appelez **IMAPIStatus::FlushQueues** méthode du spouleur MAPI, en passant l’identificateur d’entrée du transport dans le paramètre _lpTargetTransport_ .</span><span class="sxs-lookup"><span data-stu-id="de38a-127">If unsupported, call the MAPI spooler's **IMAPIStatus::FlushQueues** method, passing the entry identifier of the transport in the  _lpTargetTransport_ parameter.</span></span> <span data-ttu-id="de38a-128">Voir la procédure précédente pour obtenir des instructions sur l’accès aux objet d’état du spouleur MAPI.</span><span class="sxs-lookup"><span data-stu-id="de38a-128">See the preceding procedure for instructions on accessing the MAPI spooler's status object.</span></span> <span data-ttu-id="de38a-129">Définir l’indicateur FLUSH_DOWNLOAD pour vider les files d’attente sortantes ou le FLUSH_UPLOAD à vider les files d’attente entrants.</span><span class="sxs-lookup"><span data-stu-id="de38a-129">Set the FLUSH_DOWNLOAD flag to flush the outgoing queues or the FLUSH_UPLOAD flag to flush the incoming queues.</span></span> 
        
    4. <span data-ttu-id="de38a-130">Version de l’objet de l’état et la table d’état, ainsi que la structure [SRowSet](srowset.md) qui est allouée à la table.</span><span class="sxs-lookup"><span data-stu-id="de38a-130">Release the status object and the status table, as well as the [SRowSet](srowset.md) structure that is allocated for the table.</span></span> 
    
<span data-ttu-id="de38a-131">Le spouleur MAPI respecte l’indicateur FLUSH_NO_UI comme la plupart des fournisseurs de transport du réseau local.</span><span class="sxs-lookup"><span data-stu-id="de38a-131">The MAPI spooler honors the FLUSH_NO_UI flag as do most LAN transport providers.</span></span> <span data-ttu-id="de38a-132">Toutefois, tous les fournisseurs de transport Honorer cet indicateur, notamment celles qui utilisent un modem explicitement et le Service d’accès à distance (RAS).</span><span class="sxs-lookup"><span data-stu-id="de38a-132">However, not all transport providers honor this flag, particularly those that use a modem explicitly and the Remote Access Service (RAS).</span></span> <span data-ttu-id="de38a-133">RAS n’a pas été conçu pour permettre aux clients supprimer l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="de38a-133">RAS was not designed to allow clients to suppress the user interface.</span></span> <span data-ttu-id="de38a-134">Il est possible pour un client à configurer afin qu’il peut se connecter sans nécessiter l’interaction d’un utilisateur, mais il est difficile et nécessite une connaissance approfondie des services de message du client.</span><span class="sxs-lookup"><span data-stu-id="de38a-134">It is possible for a client to be configured so that it can connect without requiring the interaction of a user, but it is difficult and requires intimate knowledge of the client's message services.</span></span>
  

